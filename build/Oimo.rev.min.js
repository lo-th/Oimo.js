'use strict';var OIMO={REVISION:"REV.1.0.0",SHAPE_NULL:0,SHAPE_SPHERE:1,SHAPE_BOX:2,SHAPE_CYLINDER:3,MAX_BODIES:16384,WORLD_MAX_SHAPES:32768,MAX_CONTACTS:65536,MAX_JOINTS:16384};OIMO.MAX_CONSTRAINTS=OIMO.MAX_CONTACTS+OIMO.MAX_JOINTS;OIMO.MAX_SHAPES=64;OIMO.BODY_DYNAMIC=0;OIMO.BODY_STATIC=1;OIMO.WORLD_SCALE=100;OIMO.INV_SCALE=0.01;OIMO.TO_RAD=Math.PI/180;OIMO.nextID=0;OIMO.World=function(a,c,b){c=c||2;this.timeStep=a||1/60;this.iteration=b||8;this.rigidBodies=[];this.rigidBodies.length=OIMO.MAX_BODIES;this.numRigidBodies=0;this.shapes=[];this.shapes.length=OIMO.WORLD_MAX_SHAPES;this.numShapes=0;this.prevContacts=this.contacts=null;this.contactPool1=[];this.contactPool2=[];this.contactPool1.length=OIMO.MAX_CONTACTS;this.contactPool2.length=OIMO.MAX_CONTACTS;this.numPrevContacts2=this.numPrevContacts1=this.numContacts=0;this.joints=[];this.joints.length=OIMO.MAX_JOINTS;
this.numIslands=this.numJoints=0;this.constraints=[];this.constraints.length=OIMO.MAX_CONSTRAINTS;this.numConstraints=0;this.collisionResult=new OIMO.CollisionResult(OIMO.MAX_CONTACTS);this.islandStack=[];this.islandStack.length=OIMO.MAX_BODIES;this.islandRigidBodies=[];this.islandRigidBodies.length=OIMO.MAX_BODIES;this.islandNumRigidBodies=0;this.islandConstraints=[];this.islandConstraints.length=OIMO.MAX_CONSTRAINTS;this.islandNumConstraints=0;switch(c){case 1:this.broadPhase=new OIMO.BruteForceBroadPhase;
break;default:this.broadPhase=new OIMO.SweepAndPruneBroadPhase}this.gravity=new OIMO.Vec3(0,-9.80665,0);this.performance=new OIMO.Performance;this.detectors=[];this.detectors.length=4;for(a=0;4>a;a++)this.detectors[a]=[],this.detectors[a].length=4;this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_SPHERE]=new OIMO.SphereSphereCollisionDetector;this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_BOX]=new OIMO.SphereBoxCollisionDetector(!1);this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_CYLINDER]=new OIMO.SphereCylinderCollisionDetector(!1);
this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_SPHERE]=new OIMO.SphereBoxCollisionDetector(!0);this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_BOX]=new OIMO.BoxBoxCollisionDetector;this.detectors[OIMO.SHAPE_CYLINDER][OIMO.SHAPE_SPHERE]=new OIMO.SphereCylinderCollisionDetector(!0);this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_CYLINDER]=new OIMO.BoxCylinderCollisionDetector(!1);this.detectors[OIMO.SHAPE_CYLINDER][OIMO.SHAPE_BOX]=new OIMO.BoxCylinderCollisionDetector(!0);this.detectors[OIMO.SHAPE_CYLINDER][OIMO.SHAPE_CYLINDER]=
new OIMO.CylinderCylinderCollisionDetector;this.contacts=this.contactPool1;this.prevContacts=this.contactPool2;this.randX=65535;this.randA=98765;this.randB=123456789};
OIMO.World.prototype={constructor:OIMO.World,clear:function(){this.randX=65535;var a;a=this.numRigidBodies;for(a-=1;0<=a;a--)this.removeRigidBody(this.rigidBodies[a]);a=this.numJoints;for(a-=1;0<=a;a--)this.removeJoint(this.joints[a])},addRigidBody:function(a){if(this.numRigidBodies==OIMO.MAX_BODIES)throw Error("It is not possible to add a rigid body to the world any more");if(a.parent)throw Error("It is not possible to be added to more than one world one of the rigid body");a.awake();for(var c=a.numShapes,
b=0;b<c;b++)this.addShape(a.shapes[b]);this.rigidBodies[this.numRigidBodies++]=a;a.parent=this},removeRigidBody:function(a){for(var c=null,b=0;b<this.numRigidBodies;b++)if(this.rigidBodies[b]==a){c=a;this.rigidBodies[b]=this.rigidBodies[--this.numRigidBodies];this.rigidBodies[this.numRigidBodies]=null;break}if(null!=c){c.awake();for(b=c.jointList;null!=b;)a=b.parent,b=b.next,this.removeJoint(a);a=c.numShapes;for(b=0;b<a;b++)this.removeShape(c.shapes[b]);c.parent=null}},addShape:function(a){if(this.numShapes==
OIMO.WORLD_MAX_SHAPES)throw Error("It is not possible to add a shape to the world any more");if(!a.parent)throw Error("It is not possible to be added alone to shape world");if(a.parent.parent)throw Error("It is not possible to be added to multiple world the shape of one");this.broadPhase.addProxy(a.proxy);this.shapes[this.numShapes++]=a},removeShape:function(a){for(var c=null,b=0;b<this.numShapes;b++)if(this.shapes[b]==a){c=a;this.shapes[b]=this.shapes[--this.numShapes];this.shapes[this.numShapes]=
null;break}null!=c&&this.broadPhase.removeProxy(c.proxy)},addJoint:function(a){if(this.numJoints==OIMO.World.MAX_JOINTS)throw Error("It is not possible to add a joint to the world any more");if(a.parent)throw Error("It is not possible to be added to more than one world one of the joint");var c=a.body1,b=a.connection1;c.awake();c.numJoints++;b.next=c.jointList;null!=c.jointList&&(c.jointList.prev=b);c.jointList=b;c=a.body2;b=a.connection2;c.awake();c.numJoints++;b.next=c.jointList;null!=c.jointList&&
(c.jointList.prev=b);c.jointList=b;this.joints[this.numJoints++]=a;a.parent=this},removeJoint:function(a){for(var c=null,b=0;b<this.numJoints;b++)if(this.joints[b]==a){c=a;this.joints[b]=this.joints[--this.numJoints];this.joints[this.numJoints]=null;break}null!=c&&(c.body1.awake(),c.body1.numJoints--,c.body2.awake(),c.body2.numJoints--,a=c.connection1,null!=a.prev&&(a.prev.next=a.next,a.prev=null),null!=a.next&&(a.next.prev=a.prev,a.next=null),a=c.connection2,null!=a.prev&&(a.prev.next=a.next,a.prev=
null),null!=a.next&&(a.next.prev=a.prev,a.next=null),c.parent=null)},getByName:function(a){var c=null,b,d;b=this.numRigidBodies;for(b-=1;0<=b;b--)d=this.rigidBodies[b],""!==d.name&&d.name===a&&(c=d);b=this.numJoints;for(b-=1;0<=b;b--)d=this.joints[b],""!==d.name&&d.name===a&&(c=d);return c},step:function(){var a=Date.now(),c=this.contacts;this.contacts=this.prevContacts;this.prevContacts=c;for(c=this.numRigidBodies;c--;){var b=this.rigidBodies[c];if(b.sleeping){var d=b.linearVelocity,e=b.linearVelocity,
f=b.position,g=b.sleepPosition,k=b.orientation,h=b.sleepOrientation;0==d.x&&0==d.y&&0==d.z&&0==e.x&&0==e.y&&0==e.z&&f.x==g.x&&f.y==g.y&&f.z==g.z&&k.s==h.s&&k.x==h.x&&k.y==h.y&&k.z==h.z||b.awake()}}this.detectCollisions();this.updateIslands();c=Date.now();c-1E3>this.performance.time_prev&&(this.performance.time_prev=c,this.performance.fpsint=this.performance.fps,this.performance.fps=0);this.performance.fps++;this.performance.solvingTime=c-this.performance.solvingTime;this.performance.totalTime=c-a},
detectCollisions:function(){this.collectContactInfos();this.setupContacts()},collectContactInfos:function(){var a=Date.now();this.broadPhase.detectPairs();var c=Date.now();this.performance.broadPhaseTime=c-a;this.collisionResult.numContactInfos=0;for(var a=this.broadPhase.pairs,b=this.broadPhase.numPairs,d=0;d<b;d++){var e=a[d],f=e.shape1,e=e.shape2,g=this.detectors[f.type][e.type];if(g&&(g.detectCollision(f,e,this.collisionResult),this.collisionResult.numContactInfos==OIMO.MAX_CONTACTS))return}a=
Date.now();this.performance.narrowPhaseTime=a-c;this.performance.updatingTime=a},setupContacts:function(){this.numPrevContacts2=this.numPrevContacts1;this.numPrevContacts1=this.numContacts;for(var a=0,c=0;c<this.numPrevContacts1;c++){var b=this.prevContacts[c];b.sleeping&&(this.prevContacts[c]=this.contacts[a],this.contacts[a++]=b)}var d=this.collisionResult.contactInfos;this.numContacts=a+this.collisionResult.numContactInfos;for(c=a;c<this.numContacts;c++){this.contacts[c]||(this.contacts[c]=new OIMO.Contact);
b=this.contacts[c];b.setupFromContactInfo(d[c-a]);for(var e=b.shape1,f=b.shape2,e=e.numContacts<f.numContacts?e.contactList:f.contactList;null!=e;){f=e.parent;if((f.shape1==b.shape1&&f.shape2==b.shape2||f.shape1==b.shape2&&f.shape2==b.shape1)&&f.id.equals(b.id)){b.normalImpulse=f.normalImpulse;b.tangentImpulse=f.tangentImpulse;b.binormalImpulse=f.binormalImpulse;b.warmStarted=!0;break}e=e.next}}for(c=this.numContacts;c<this.numPrevContacts2;c++)this.contacts[c].removeReferences()},updateIslands:function(){for(var a=
1/this.timeStep,c,b,d=0;d<this.numShapes;d++)b=this.shapes[d],b.contactList=null,b.numContacts=0;for(d=0;d<this.numRigidBodies;d++)b=this.rigidBodies[d],b.contactList=null,b.addedToIsland=!1;for(d=this.numConstraints=0;d<this.numContacts;d++){var e=this.contacts[d];e.addedToIsland=!1;var f=e.shapeConnection1;b=e.shape1;f.prev=null;f.next=b.contactList;null!=b.contactList&&(b.contactList.prev=f);b.contactList=f;b.numContacts++;f=e.shapeConnection2;b=e.shape2;f.prev=null;f.next=b.contactList;null!=
b.contactList&&(b.contactList.prev=f);b.contactList=f;b.numContacts++;f=e.bodyConnection1;b=e.body1;f.prev=null;f.next=b.contactList;null!=b.contactList&&(b.contactList.prev=f);b.contactList=f;f=e.bodyConnection2;b=e.body2;f.prev=null;f.next=b.contactList;null!=b.contactList&&(b.contactList.prev=f);b.contactList=f;this.constraints[this.numConstraints++]=e}for(d=0;d<this.numJoints;d++)c=this.joints[d],c.addedToIsland=!1,this.constraints[this.numConstraints++]=c;for(d=1;d<this.numConstraints;d++)b=
(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*d|0,c=this.constraints[d],this.constraints[d]=this.constraints[b],this.constraints[b]=c;d=Date.now();this.performance.updatingTime=d-this.performance.updatingTime;this.performance.solvingTime=d;for(d=this.numIslands=0;d<this.numRigidBodies;d++)if(b=this.rigidBodies[d],!b.addedToIsland&&b.type!=OIMO.BODY_STATIC&&!b.sleeping){this.islandNumConstraints=this.islandNumRigidBodies=0;e=1;this.islandStack[0]=b;for(b.addedToIsland=!0;0<e;){b=
this.islandStack[--e];b.sleeping=!1;this.islandRigidBodies[this.islandNumRigidBodies++]=b;for(f=b.contactList;null!=f;)c=f.parent,c.addedToIsland||(this.islandConstraints[this.islandNumConstraints++]=c,c.addedToIsland=!0,c.sleeping=!1,c=f.connectedBody,c.addedToIsland||c.type==OIMO.BODY_STATIC||(this.islandStack[e++]=c,c.addedToIsland=!0)),f=f.next;for(b=b.jointList;null!=b;)c=b.parent,c.addedToIsland||(this.islandConstraints[this.islandNumConstraints++]=c,c.addedToIsland=!0,c.sleeping=!1,c=b.connected,
c.addedToIsland||c.type==OIMO.BODY_STATIC||(this.islandStack[e++]=c,c.addedToIsland=!0)),b=b.next}for(f=0;f<this.islandNumRigidBodies;f++)b=this.islandRigidBodies[f],b.updateVelocity(this.timeStep,this.gravity);for(f=0;f<this.islandNumConstraints;f++)this.islandConstraints[f].preSolve(this.timeStep,a);for(f=0;f<this.iteration;f++)for(b=0;b<this.islandNumConstraints;b++)this.islandConstraints[b].solve();for(f=0;f<this.islandNumConstraints;f++)this.islandConstraints[f].postSolve();e=1E3;for(f=0;f<this.islandNumRigidBodies;f++)if(b=
this.islandRigidBodies[f],b.allowSleep){c=b.linearVelocity.x;var g=b.linearVelocity.y,k=b.linearVelocity.z;0.01<c*c+g*g+k*k?e=b.sleepTime=0:(c=b.angularVelocity.x,g=b.angularVelocity.y,k=b.angularVelocity.z,0.04<c*c+g*g+k*k?e=b.sleepTime=0:(b.sleepTime+=this.timeStep,b.sleepTime<e&&(e=b.sleepTime)))}else e=b.sleepTime=0;if(0.5<e){for(f=0;f<this.islandNumRigidBodies;f++)b=this.islandRigidBodies[f],b.linearVelocity.init(),b.angularVelocity.init(),b.sleepPosition.copy(b.position),b.sleepOrientation.copy(b.orientation),
b.sleepTime=0,b.sleeping=!0;for(f=0;f<this.islandNumConstraints;f++)this.islandConstraints[f].sleeping=!0}else for(f=0;f<this.islandNumRigidBodies;f++)this.islandRigidBodies[f].updatePosition(this.timeStep);this.numIslands++}}};OIMO.RigidBody=function(a,c,b,d){a=a||0;c=c||0;b=b||0;d=d||0;this.name="";this.type=0;this.position=null;this.invertMass=this.mass=NaN;this.shapes=[];this.shapes.length=OIMO.MAX_SHAPES;this.numShapes=0;this.jointList=this.contactList=this.parent=null;this.numJoints=0;this.sleeping=this.addedToIsland=!1;var e=c*c+b*b+d*d;this.position=new OIMO.Vec3;0<e&&(e=1/Math.sqrt(e),c*=e,b*=e,d*=e);e=Math.sin(0.5*a);a=Math.cos(0.5*a);this.orientation=new OIMO.Quat(a,e*c,e*b,e*d);this.linearVelocity=new OIMO.Vec3;
this.angularVelocity=new OIMO.Vec3;this.sleepPosition=new OIMO.Vec3;this.sleepOrientation=new OIMO.Quat;this.rotation=new OIMO.Mat33;this.invertInertia=new OIMO.Mat33;this.localInertia=new OIMO.Mat33;this.invertLocalInertia=new OIMO.Mat33;this.matrix=new OIMO.Mat44;this.allowSleep=!0;this.sleepTime=0};
OIMO.RigidBody.prototype={constructor:OIMO.RigidBody,addShape:function(a){if(this.numShapes==OIMO.MAX_SHAPES)throw Error("It is not possible to add more shape to the rigid");if(a.parent)throw Error("It is not possible that you add to the multi-rigid body the shape of one");this.shapes[this.numShapes++]=a;a.parent=this;this.parent&&this.parent.addShape(a)},removeShape:function(a,c){2>arguments.length&&(c=-1);if(0>c){for(var b=0;b<this.numShapes;b++)if(a==this.shapes[b]){c=b;break}if(-1==c)return}else if(c>=
this.numShapes)throw Error("The index of the shape you want to delete is out of range");b=this.shapes[c];b.parent=null;this.parent&&this.parent.removeShape(b);this.numShapes--;for(b=c;b<this.numShapes;b++)this.shapes[b]=this.shapes[b+1];this.shapes[this.numShapes]=null},setupMass:function(a){this.type=a||OIMO.BODY_DYNAMIC;this.position.init();this.mass=0;this.localInertia.init(0,0,0,0,0,0,0,0,0);var c=this.localInertia.elements,b=new OIMO.Mat33;b.transpose(this.rotation);for(var d=new OIMO.Mat33,
e=new OIMO.Vec3,f=0,g=0;g<this.numShapes;g++){var k=this.shapes[g];k.relativeRotation.mul(b,k.rotation);this.position.add(this.position,e.scale(k.position,k.mass));f+=k.mass;this.mass+=k.mass;d.mul(k.relativeRotation,d.mul(k.localInertia,d.transpose(k.relativeRotation)));this.localInertia.add(this.localInertia,d)}this.position.scale(this.position,1/f);this.invertMass=1/this.mass;for(g=f=e=d=0;g<this.numShapes;g++){var k=this.shapes[g],h=k.localRelativePosition;h.sub(k.position,this.position).mulMat(b,
h);k.updateProxy();c[0]+=k.mass*(h.y*h.y+h.z*h.z);c[4]+=k.mass*(h.x*h.x+h.z*h.z);c[8]+=k.mass*(h.x*h.x+h.y*h.y);d-=k.mass*h.x*h.y;e-=k.mass*h.y*h.z;f-=k.mass*h.z*h.x}c[1]=d;c[3]=d;c[2]=f;c[6]=f;c[5]=e;c[7]=e;this.invertLocalInertia.invert(this.localInertia);a==OIMO.BODY_STATIC&&(this.invertMass=0,this.invertLocalInertia.init(0,0,0,0,0,0,0,0,0));var h=this.rotation.elements,m=this.invertLocalInertia.elements;a=h[0];var c=h[1],b=h[2],k=h[3],d=h[4],e=h[5],f=h[6],g=h[7],h=h[8],l=m[0],p=m[1],x=m[2],q=
m[3],t=m[4],v=m[5],r=m[6],s=m[7],G=m[8],m=a*l+c*q+b*r,z=a*p+c*t+b*s,H=a*x+c*v+b*G,K=k*l+d*q+e*r,J=k*p+d*t+e*s,I=k*x+d*v+e*G,l=f*l+g*q+h*r,p=f*p+g*t+h*s,x=f*x+g*v+h*G,v=this.invertInertia.elements;v[0]=m*a+z*c+H*b;v[1]=m*k+z*d+H*e;v[2]=m*f+z*g+H*h;v[3]=K*a+J*c+I*b;v[4]=K*k+J*d+I*e;v[5]=K*f+J*g+I*h;v[6]=l*a+p*c+x*b;v[7]=l*k+p*d+x*e;v[8]=l*f+p*g+x*h;this.syncShapes();this.awake()},awake:function(){if(this.allowSleep){this.sleepTime=0;if(this.sleeping){for(var a=this.contactList;null!=a;)a.connectedBody.sleepTime=
0,a.connectedBody.sleeping=!1,a.parent.sleeping=!1,a=a.next;for(a=this.jointList;null!=a;)a.connected.sleepTime=0,a.connected.sleeping=!1,a.parent.sleeping=!1,a=a.next}this.sleeping=!1}},sleep:function(){this.allowSleep&&(this.linearVelocity.init(),this.angularVelocity.init(),this.sleepPosition.copy(this.position),this.sleepOrientation.copy(this.orientation),this.sleepTime=0,this.sleeping=!0)},updateVelocity:function(a,c){this.type==OIMO.BODY_DYNAMIC&&(this.linearVelocity.x+=c.x*a,this.linearVelocity.y+=
c.y*a,this.linearVelocity.z+=c.z*a)},updatePosition:function(a){this.allowSleep||(this.sleepTime=0);if(this.type==OIMO.BODY_STATIC)this.linearVelocity.x=0,this.linearVelocity.y=0,this.linearVelocity.z=0,this.angularVelocity.x=0,this.angularVelocity.y=0,this.angularVelocity.z=0;else if(this.type==OIMO.BODY_DYNAMIC){var c=this.linearVelocity.x,b=this.linearVelocity.y,d=this.linearVelocity.z;0.01<c*c+b*b+d*d&&(this.sleepTime=0);this.position.x+=c*a;this.position.y+=b*a;this.position.z+=d*a;c=this.angularVelocity.x;
b=this.angularVelocity.y;d=this.angularVelocity.z;0.025<c*c+b*b+d*d&&(this.sleepTime=0);var e=this.orientation.s,f=this.orientation.x,g=this.orientation.y,k=this.orientation.z;a*=0.5;var h=(c*e+b*k-d*g)*a,m=(-c*k+b*e+d*f)*a,l=(c*g-b*f+d*e)*a,e=e+(-c*f-b*g-d*k)*a,f=f+h,g=g+m,k=k+l;a=1/Math.sqrt(e*e+f*f+g*g+k*k);this.orientation.s=e*a;this.orientation.x=f*a;this.orientation.y=g*a;this.orientation.z=k*a}else throw Error("The type of rigid body of undefined");this.syncShapes()},syncShapes:function(){var a=
this.orientation.s,c=this.orientation.x,b=this.orientation.y,d=this.orientation.z,e=2*c,f=2*b,g=2*d,k=c*e,h=b*f,d=d*g,m=c*f,b=b*g,c=c*g,l=a*e,p=a*f,a=a*g,f=this.rotation.elements,e=this.invertLocalInertia.elements;f[0]=1-h-d;f[1]=m-a;f[2]=c+p;f[3]=m+a;f[4]=1-k-d;f[5]=b-l;f[6]=c-p;f[7]=b+l;f[8]=1-k-h;var k=f[0],h=f[1],d=f[2],m=f[3],b=f[4],a=f[5],g=f[6],c=f[7],f=f[8],x=e[0],q=e[1],t=e[2],v=e[3],r=e[4],s=e[5],G=e[6],z=e[7],H=e[8],e=k*x+h*v+d*G,l=k*q+h*r+d*z,p=k*t+h*s+d*H,K=m*x+b*v+a*G,J=m*q+b*r+a*z,
I=m*t+b*s+a*H,x=g*x+c*v+f*G,r=g*q+c*r+f*z,z=g*t+c*s+f*H,t=this.invertInertia.elements;t[0]=e*k+l*h+p*d;t[1]=e*m+l*b+p*a;t[2]=e*g+l*c+p*f;t[3]=K*k+J*h+I*d;t[4]=K*m+J*b+I*a;t[5]=K*g+J*c+I*f;t[6]=x*k+r*h+z*d;t[7]=x*m+r*b+z*a;t[8]=x*g+r*c+z*f;for(t=0;t<this.numShapes;t++)s=this.shapes[t],e=s.relativePosition,K=s.localRelativePosition,z=s.relativeRotation.elements,q=s.rotation.elements,l=K.x,p=K.y,K=K.z,e.x=l*k+p*h+K*d,e.y=l*m+p*b+K*a,e.z=l*g+p*c+K*f,s.position.x=this.position.x+e.x,s.position.y=this.position.y+
e.y,s.position.z=this.position.z+e.z,e=z[0],l=z[1],p=z[2],K=z[3],J=z[4],I=z[5],x=z[6],r=z[7],z=z[8],q[0]=k*e+h*K+d*x,q[1]=k*l+h*J+d*r,q[2]=k*p+h*I+d*z,q[3]=m*e+b*K+a*x,q[4]=m*l+b*J+a*r,q[5]=m*p+b*I+a*z,q[6]=g*e+c*K+f*x,q[7]=g*l+c*J+f*r,q[8]=g*p+c*I+f*z,s.updateProxy()},applyImpulse:function(a,c){this.linearVelocity.x+=c.x*this.invertMass;this.linearVelocity.y+=c.y*this.invertMass;this.linearVelocity.z+=c.z*this.invertMass;var b=new OIMO.Vec3;b.sub(a,this.position).cross(b,c).mulMat(this.invertInertia,
b);this.angularVelocity.x+=b.x;this.angularVelocity.y+=b.y;this.angularVelocity.z+=b.z},setPosition:function(a,c,b){this.position.init(a*OIMO.INV_SCALE,c*OIMO.INV_SCALE,b*OIMO.INV_SCALE);this.linearVelocity.init();this.angularVelocity.init()},setRotation:function(a,c,b){},getMatrix:function(){var a=this.matrix.elements,c;this.sleeping?a[15]=1:(c=this.rotation.elements,a[0]=c[0],a[1]=c[3],a[2]=c[6],a[3]=0,a[4]=c[1],a[5]=c[4],a[6]=c[7],a[7]=0,a[8]=c[2],a[9]=c[5],a[10]=c[8],a[11]=0,c=this.position,a[12]=
c.x*OIMO.WORLD_SCALE,a[13]=c.y*OIMO.WORLD_SCALE,a[14]=c.z*OIMO.WORLD_SCALE,a[15]=0);return a}};OIMO.Body=function(a){a=a||{};if(a.world){this.name=a.name||"";for(var c=a.move||!1,b=a.noSleep||!1,d=a.pos||[0,0,0],d=d.map(function(a){return a*OIMO.INV_SCALE}),e=a.size||[1,1,1],e=e.map(function(a){return a*OIMO.INV_SCALE}),f=a.rot||[0,0,0],f=f.map(function(a){return a*OIMO.TO_RAD}),g=[],k=0;k<f.length/3;k++){var h=OIMO.EulerToAxis(f[k+0],f[k+1],f[k+2]);g.push(h[0]);g.push(h[1]);g.push(h[2]);g.push(h[3])}f=a.sc||new OIMO.ShapeConfig;a.config&&(f.density=a.config[0]||1,f.friction=a.config[1]||0.5,
f.restitution=a.config[2]||0.5);f.position.init(d[0],d[1],d[2]);this.body=new OIMO.RigidBody(g[0],g[1],g[2],g[3]);g=[];h=a.type||"box";"string"===typeof h&&(h=[h]);for(var m,k=0;k<h.length;k++){m=3*k;switch(h[k]){case "sphere":g[k]=new OIMO.SphereShape(f,e[m+0]);break;case "cylinder":g[k]=new OIMO.CylinderShape(f,e[m+0],e[m+1]);break;case "box":g[k]=new OIMO.BoxShape(f,e[m+0],e[m+1],e[m+2])}this.body.addShape(g[k]);0<k&&g[k].position.init(d[0]+d[m+0],d[1]+d[m+1],d[2]+d[m+2])}c?(this.body.setupMass(OIMO.BODY_DYNAMIC),
this.body.allowSleep=b?!1:!0):this.body.setupMass(OIMO.BODY_STATIC);this.body.name=this.name;a.world.addRigidBody(this.body)}};OIMO.Link=function(a){a=a||{};if(a.world){this.name=a.name||"";var c=a.type||"jointHinge",b=a.axe1||[1,0,0],d=a.axe2||[1,0,0],e=a.pos1||[0,0,0],f=a.pos2||[0,0,0],e=e.map(function(a){return a*OIMO.INV_SCALE}),f=f.map(function(a){return a*OIMO.INV_SCALE}),g=a.max||10,g=g*OIMO.INV_SCALE,k=new OIMO.JointConfig;k.allowCollision=a.collision||!1;k.localAxis1.init(b[0],b[1],b[2]);k.localAxis2.init(d[0],d[1],d[2]);k.localRelativeAnchorPosition1.init(e[0],e[1],e[2]);k.localRelativeAnchorPosition2.init(f[0],
f[1],f[2]);if("string"==typeof a.body1||a.body1 instanceof String)a.body1=a.world.getByName(a.body1);if("string"==typeof a.body2||a.body2 instanceof String)a.body2=a.world.getByName(a.body2);switch(c){case "jointBall":this.joint=new OIMO.BallJoint(k,a.body1,a.body2);break;case "jointDistance":this.joint=new OIMO.DistanceJoint(k,a.body1,a.body2,g);break;case "jointHinge":this.joint=new OIMO.HingeJoint(k,a.body1,a.body2);break;case "jointHinge2":this.joint=new OIMO.Hinge2Joint(k,a.body1,a.body2)}this.joint.name=
this.name;a.world.addJoint(this.joint)}};OIMO.Performance=function(){this.totalTime=this.updatingTime=this.solvingTime=this.narrowPhaseTime=this.broadPhaseTime=this.fps=this.fpsint=this.time_prev=0};OIMO.Mat44=function(a,c,b,d,e,f,g,k,h,m,l,p,x,q,t,v){var r=this.elements=new Float32Array(16);r[0]=void 0!==a?a:1;r[4]=c||0;r[8]=b||0;r[12]=d||0;r[1]=e||0;r[5]=void 0!==f?f:1;r[9]=g||0;r[13]=k||0;r[2]=h||0;r[6]=m||0;r[10]=void 0!==l?l:1;r[14]=p||0;r[3]=x||0;r[7]=q||0;r[11]=t||0;r[15]=void 0!==v?v:1};
OIMO.Mat44.prototype={constructor:OIMO.Mat44,set:function(a,c,b,d,e,f,g,k,h,m,l,p,x,q,t,v){var r=this.elements;r[0]=a;r[4]=c;r[8]=b;r[12]=d;r[1]=e;r[5]=f;r[9]=g;r[13]=k;r[2]=h;r[6]=m;r[10]=l;r[14]=p;r[3]=x;r[7]=q;r[11]=t;r[15]=v;return this}};OIMO.Mat33=function(a,c,b,d,e,f,g,k,h){this.elements=new Float32Array(9);this.init(void 0!==a?a:1,c||0,b||0,d||0,void 0!==e?e:1,f||0,g||0,k||0,void 0!==h?h:1)};
OIMO.Mat33.prototype={constructor:OIMO.Mat33,init:function(a,c,b,d,e,f,g,k,h){var m=this.elements;m[0]=void 0!==a?a:1;m[1]=c||0;m[2]=b||0;m[3]=d||0;m[4]=void 0!==e?e:1;m[5]=f||0;m[6]=g||0;m[7]=k||0;m[8]=void 0!==h?h:1;return this},add:function(a,c){var b=this.elements,d=a.elements,e=c.elements;b[0]=d[0]+e[0];b[1]=d[1]+e[1];b[2]=d[2]+e[2];b[3]=d[3]+e[3];b[4]=d[4]+e[4];b[5]=d[5]+e[5];b[6]=d[6]+e[6];b[7]=d[7]+e[7];b[8]=d[8]+e[8];return this},addEqual:function(a){var c=this.elements;a=a.elements;c[0]+=
a[0];c[1]+=a[1];c[2]+=a[2];c[3]+=a[3];c[4]+=a[4];c[5]+=a[5];c[6]+=a[6];c[7]+=a[7];c[8]+=a[8];return this},sub:function(a,c){var b=this.elements,d=a.elements,e=c.elements;b[0]=d[0]-e[0];b[1]=d[1]-e[1];b[2]=d[2]-e[2];b[3]=d[3]-e[3];b[4]=d[4]-e[4];b[5]=d[5]-e[5];b[6]=d[6]-e[6];b[7]=d[7]-e[7];b[8]=d[8]-e[8];return this},subEqual:function(a){var c=this.elements;a=a.elements;c[0]-=a[0];c[1]-=a[1];c[2]-=a[2];c[3]-=a[3];c[4]-=a[4];c[5]-=a[5];c[6]-=a[6];c[7]-=a[7];c[8]-=a[8];return this},scale:function(a,
c){var b=this.elements,d=a.elements;b[0]=d[0]*c;b[1]=d[1]*c;b[2]=d[2]*c;b[3]=d[3]*c;b[4]=d[4]*c;b[5]=d[5]*c;b[6]=d[6]*c;b[7]=d[7]*c;b[8]=d[8]*c;return this},scaleEqual:function(a){var c=this.elements;c[0]*=a;c[1]*=a;c[2]*=a;c[3]*=a;c[4]*=a;c[5]*=a;c[6]*=a;c[7]*=a;c[8]*=a;return this},mul:function(a,c){var b=this.elements,d=a.elements,e=c.elements,f=d[0],g=d[3],k=d[6],h=d[1],m=d[4],l=d[7],p=d[2],x=d[5],d=d[8],q=e[0],t=e[3],v=e[6],r=e[1],s=e[4],G=e[7],z=e[2],H=e[5],e=e[8];b[0]=f*q+h*t+p*v;b[1]=f*r+
h*s+p*G;b[2]=f*z+h*H+p*e;b[3]=g*q+m*t+x*v;b[4]=g*r+m*s+x*G;b[5]=g*z+m*H+x*e;b[6]=k*q+l*t+d*v;b[7]=k*r+l*s+d*G;b[8]=k*z+l*H+d*e;return this},mulScale:function(a,c,b,d,e){var f=this.elements;a=a.elements;e?(f[0]=c*a[0],f[1]=c*a[1],f[2]=c*a[2],f[3]=b*a[3],f[4]=b*a[4],f[5]=b*a[5],f[6]=d*a[6],f[7]=d*a[7],f[8]=d*a[8]):(f[0]=a[0]*c,f[1]=a[1]*b,f[2]=a[2]*d,f[3]=a[3]*c,f[4]=a[4]*b,f[5]=a[5]*d,f[6]=a[6]*c,f[7]=a[7]*b,f[8]=a[8]*d);return this},mulRotate:function(a,c,b,d,e,f){f=f||!1;var g=Math.sin(c),k=Math.cos(c),
h=1-k;c=b*b*h+k;var m=b*d*h-e*g,l=b*e*h+d*g,p=d*b*h+e*g,x=d*d*h+k,q=d*e*h-b*g,t=e*b*h-d*g;b=e*d*h+b*g;e=e*e*h+k;var v=a.elements;a=v[0];d=v[3];var g=v[6],k=v[1],h=v[4],r=v[7],s=v[2],G=v[5],v=v[8],z=this.elements;f?(z[0]=c*a+m*d+l*g,z[1]=c*k+m*h+l*r,z[2]=c*s+m*G+l*v,z[3]=p*a+x*d+q*g,z[4]=p*k+x*h+q*r,z[5]=p*s+x*G+q*v,z[6]=t*a+b*d+e*g,z[7]=t*k+b*h+e*r,z[8]=t*s+b*G+e*v):(z[0]=a*c+k*p+s*t,z[1]=a*m+k*x+s*b,z[2]=a*l+k*q+s*e,z[3]=d*c+h*p+G*t,z[4]=d*m+h*x+G*b,z[5]=d*l+h*q+G*e,z[6]=g*c+r*p+v*t,z[7]=g*m+r*x+
v*b,z[8]=g*l+r*q+v*e);return this},transpose:function(a){var c=this.elements;a=a.elements;c[0]=a[0];c[1]=a[3];c[2]=a[6];c[3]=a[1];c[4]=a[4];c[5]=a[7];c[6]=a[2];c[7]=a[5];c[8]=a[8];return this},setQuat:function(a){var c=2*a.x,b=2*a.y,d=2*a.z,e=a.x*c,f=a.y*b,g=a.z*d,k=a.x*b,h=a.y*d,m=a.x*d,c=a.s*c,b=a.s*b;a=a.s*d;d=this.elements;d[0]=1-f-g;d[1]=k-a;d[2]=m+b;d[3]=k+a;d[4]=1-e-g;d[5]=h-c;d[6]=m-b;d[7]=h+c;d[8]=1-e-f;return this},invert:function(a){var c=this.elements,b=a.elements;a=b[0];var d=b[3],e=
b[6],f=b[1],g=b[4],k=b[7],h=b[2],m=b[5],b=b[8],l=a*(g*b-k*m)+d*(k*h-f*b)+e*(f*m-g*h);0!==l&&(l=1/l);c[0]=l*(g*b-m*k);c[1]=l*(h*k-f*b);c[2]=l*(f*m-h*g);c[3]=l*(m*e-d*b);c[4]=l*(a*b-h*e);c[5]=l*(h*d-a*m);c[6]=l*(d*k-g*e);c[7]=l*(f*e-a*k);c[8]=l*(a*g-f*d);return this},copy:function(a){var c=this.elements;a=a.elements;c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return this},toEuler:function(){var a=this.elements,c=a[0],b=a[3],d=a[6],e=a[4],f=a[7],g=a[5],a=
a[8],k=new OIMO.Vec3;new OIMO.Quat;k.y=Math.asin(Math.min(Math.max(d,-1),1));0.99999>Math.abs(d)?(k.x=Math.atan2(-f,a),k.z=Math.atan2(-b,c)):(k.x=Math.atan2(g,e),k.z=0);return k},clone:function(){var a=this.elements;return new OIMO.Mat33(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},toString:function(){var a=this.elements;return"Mat33|"+a[0].toFixed(4)+", "+a[1].toFixed(4)+", "+a[2].toFixed(4)+"|\n     |"+a[3].toFixed(4)+", "+a[4].toFixed(4)+", "+a[5].toFixed(4)+"|\n     |"+a[6].toFixed(4)+", "+
a[7].toFixed(4)+", "+a[8].toFixed(4)+"|"}};OIMO.Quat=function(a,c,b,d){this.s=void 0!==a?a:1;this.x=c||0;this.y=b||0;this.z=d||0};
OIMO.Quat.prototype={constructor:OIMO.Quat,init:function(a,c,b,d){this.s=void 0!==a?a:1;this.x=c||0;this.y=b||0;this.z=d||0;return this},add:function(a,c){this.s=a.s+c.s;this.x=a.x+c.x;this.y=a.y+c.y;this.z=a.z+c.z;return this},sub:function(a,c){this.s=a.s-c.s;this.x=a.x-c.x;this.y=a.y-c.y;this.z=a.z-c.z;return this},scale:function(a,c){this.s=a.s*c;this.x=a.x*c;this.y=a.y*c;this.z=a.z*c;return this},mul:function(a,c){var b=a.s*c.x+a.x*c.s+a.y*c.z-a.z*c.y,d=a.s*c.y-a.x*c.z+a.y*c.s+a.z*c.x,e=a.s*c.z+
a.x*c.y-a.y*c.x+a.z*c.s;this.s=a.s*c.s-a.x*c.x-a.y*c.y-a.z*c.z;this.x=b;this.y=d;this.z=e;return this},normalize:function(a){var c=Math.sqrt(a.s*a.s+a.x*a.x+a.y*a.y+a.z*a.z);0<c&&(c=1/c);this.s=a.s*c;this.x=a.x*c;this.y=a.y*c;this.z=a.z*c;return this},invert:function(a){this.s=-a.s;this.x=-a.x;this.y=-a.y;this.z=-a.z;return this},length:function(){return Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(a){this.s=a.s;this.x=a.x;this.y=a.y;this.z=a.z;return this},clone:function(a){return new OIMO.Quat(this.s,
this.x,this.y,this.z)},toString:function(){return"Quat["+this.s.toFixed(4)+", ("+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+")]"}};OIMO.Vec3=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0};
OIMO.Vec3.prototype={constructor:OIMO.Vec3,init:function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0;return this},add:function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;this.z=a.z+c.z;return this},sub:function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;this.z=a.z-c.z;return this},scale:function(a,c){this.x=a.x*c;this.y=a.y*c;this.z=a.z*c;return this},scaleEqual:function(a){this.x*=a;this.y*=a;this.z*=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a,c){var b=a.z*c.x-a.x*c.z,
d=a.x*c.y-a.y*c.x;this.x=a.y*c.z-a.z*c.y;this.y=b;this.z=d;return this},mulMat:function(a,c){var b=a.elements,d=b[3]*c.x+b[4]*c.y+b[5]*c.z,e=b[6]*c.x+b[7]*c.y+b[8]*c.z;this.x=b[0]*c.x+b[1]*c.y+b[2]*c.z;this.y=d;this.z=e;return this},normalize:function(a){var c=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);0<c&&(c=1/c);this.x=a.x*c;this.y=a.y*c;this.z=a.z*c;return this},invert:function(a){this.x=-a.x;this.y=-a.y;this.z=-a.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},
copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},clone:function(){return new OIMO.Vec3(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"}};OIMO.EulerToAxis=function(a,c,b){var d=Math.cos(0.5*c);c=Math.sin(0.5*c);var e=Math.cos(0.5*b),f=Math.sin(0.5*b),g=Math.cos(0.5*a),k=Math.sin(0.5*a),h=d*e,m=c*f;a=h*k+m*g;b=c*e*g+d*f*k;d=d*f*g-c*e*k;c=2*Math.acos(h*g-m*k);e=a*a+b*b+d*d;0.001>e?(a=1,b=d=0):(e=Math.sqrt(e),a/=e,b/=e,d/=e);return[c,a,b,d]};
OIMO.EulerToMatrix=function(a,c,b){var d=Math.cos(c);c=Math.sin(c);var e=Math.cos(b);b=Math.sin(b);var f=Math.cos(a);a=Math.sin(a);var g=new OIMO.Mat33,k=g.elements;k[0]=d*e;k[1]=c*a-d*b*f;k[2]=d*b*a+c*f;k[3]=b;k[4]=e*f;k[5]=-e*a;k[6]=-c*e;k[7]=c*b*f+d*a;k[8]=-c*b*a+d*f;return g};
OIMO.MatrixToEuler=function(a){var c=a.elements,b;0.998<c[3]?(b=Math.atan2(c[2],c[8]),c=Math.PI/2,a=0):-0.998>c[3]?(b=Math.atan2(c[2],c[8]),c=-Math.PI/2,a=0):(b=Math.atan2(-c[6],c[0]),a=Math.atan2(-c[5],c[4]),c=Math.asin(c[3]));return[a,b,c]};OIMO.Distance3d=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2];return Math.sqrt(b*b+d*d+e*e)};OIMO.Constraint=function(){this.body2=this.body1=this.parent=null;this.sleeping=this.addedToIsland=!1};OIMO.Constraint.prototype={constructor:OIMO.Constraint,preSolve:function(a,c){throw Error("preSolve Method is not inherited");},solve:function(){throw Error("solve Method is not inherited");},postSolve:function(){throw Error("postSolve Method is not inherited");}};OIMO.Joint=function(){OIMO.Constraint.call(this);this.JOINT_NULL=0;this.JOINT_DISTANCE=1;this.JOINT_BALL=2;this.JOINT_HINGE=3;this.JOINT_HINGE2=4;this.name="";this.type=0;this.allowCollision=!1;this.localRelativeAnchorPosition1=new OIMO.Vec3;this.localRelativeAnchorPosition2=new OIMO.Vec3;this.relativeAnchorPosition1=new OIMO.Vec3;this.relativeAnchorPosition2=new OIMO.Vec3;this.anchorPosition1=new OIMO.Vec3;this.anchorPosition2=new OIMO.Vec3;this.connection1=new OIMO.JointConnection(this);this.connection2=
new OIMO.JointConnection(this);this.matrix=new OIMO.Mat44};OIMO.Joint.prototype=Object.create(OIMO.Constraint.prototype);OIMO.Joint.prototype.preSolve=function(a,c){};OIMO.Joint.prototype.solve=function(){};OIMO.Joint.prototype.postSolve=function(){};
OIMO.Joint.prototype.getMatrix=function(){var a=this.matrix.elements,c=this.anchorPosition1,b=this.anchorPosition2;a[0]=c.x*OIMO.WORLD_SCALE;a[1]=c.y*OIMO.WORLD_SCALE;a[2]=c.z*OIMO.WORLD_SCALE;a[3]=0;a[4]=b.x*OIMO.WORLD_SCALE;a[5]=b.y*OIMO.WORLD_SCALE;a[6]=b.z*OIMO.WORLD_SCALE;a[7]=0;return a};OIMO.JointConfig=function(){this.localRelativeAnchorPosition1=new OIMO.Vec3;this.localRelativeAnchorPosition2=new OIMO.Vec3;this.localAxis1=new OIMO.Vec3;this.localAxis2=new OIMO.Vec3;this.allowCollision=!1};OIMO.JointConnection=function(a){this.connected=this.next=this.prev=null;this.parent=a};OIMO.BallJoint=function(a,c,b){OIMO.Joint.call(this);this.targetVelZ=this.targetVelY=this.targetVelX=this.d22=this.d21=this.d20=this.d12=this.d11=this.d10=this.d02=this.d01=this.d00=this.invI2e22=this.invI2e21=this.invI2e20=this.invI2e12=this.invI2e11=this.invI2e10=this.invI2e02=this.invI2e01=this.invI2e00=this.invI1e22=this.invI1e21=this.invI1e20=this.invI1e12=this.invI1e11=this.invI1e10=this.invI1e02=this.invI1e01=this.invI1e00=this.zTorqueUnit2Z=this.zTorqueUnit2Y=this.zTorqueUnit2X=this.zTorqueUnit1Z=
this.zTorqueUnit1Y=this.zTorqueUnit1X=this.yTorqueUnit2Z=this.yTorqueUnit2Y=this.yTorqueUnit2X=this.yTorqueUnit1Z=this.yTorqueUnit1Y=this.yTorqueUnit1X=this.xTorqueUnit2Z=this.xTorqueUnit2Y=this.xTorqueUnit2X=this.xTorqueUnit1Z=this.xTorqueUnit1Y=this.xTorqueUnit1X=this.relPos2Z=this.relPos2Y=this.relPos2X=this.relPos1Z=this.relPos1Y=this.relPos1X=NaN;this.type=this.JOINT_BALL;this.body1=c;this.body2=b;this.connection1.connected=b;this.connection2.connected=c;this.allowCollision=a.allowCollision;
this.localRelativeAnchorPosition1.copy(a.localRelativeAnchorPosition1);this.localRelativeAnchorPosition2.copy(a.localRelativeAnchorPosition2);this.lVel1=this.body1.linearVelocity;this.lVel2=this.body2.linearVelocity;this.aVel1=this.body1.angularVelocity;this.aVel2=this.body2.angularVelocity;this.invM1=this.body1.invertMass;this.invM2=this.body2.invertMass;this.impulse=new OIMO.Vec3;this.impulseZ=this.impulseY=this.impulseX=0};OIMO.BallJoint.prototype=Object.create(OIMO.Joint.prototype);
OIMO.BallJoint.prototype.preSolve=function(a,c){var b,d,e,f,g,k,h,m,l,p,x,q,t,v,r;b=this.body1.rotation.elements;d=this.localRelativeAnchorPosition1.x;e=this.localRelativeAnchorPosition1.y;f=this.localRelativeAnchorPosition1.z;this.relPos1X=this.relativeAnchorPosition1.x=d*b[0]+e*b[1]+f*b[2];this.relPos1Y=this.relativeAnchorPosition1.y=d*b[3]+e*b[4]+f*b[5];this.relPos1Z=this.relativeAnchorPosition1.z=d*b[6]+e*b[7]+f*b[8];b=this.body2.rotation.elements;d=this.localRelativeAnchorPosition2.x;e=this.localRelativeAnchorPosition2.y;
f=this.localRelativeAnchorPosition2.z;this.relPos2X=this.relativeAnchorPosition2.x=d*b[0]+e*b[1]+f*b[2];this.relPos2Y=this.relativeAnchorPosition2.y=d*b[3]+e*b[4]+f*b[5];this.relPos2Z=this.relativeAnchorPosition2.z=d*b[6]+e*b[7]+f*b[8];this.anchorPosition1.x=this.relPos1X+this.body1.position.x;this.anchorPosition1.y=this.relPos1Y+this.body1.position.y;this.anchorPosition1.z=this.relPos1Z+this.body1.position.z;this.anchorPosition2.x=this.relPos2X+this.body2.position.x;this.anchorPosition2.y=this.relPos2Y+
this.body2.position.y;this.anchorPosition2.z=this.relPos2Z+this.body2.position.z;b=this.body1.invertInertia.elements;this.invI1e00=b[0];this.invI1e01=b[1];this.invI1e02=b[2];this.invI1e10=b[3];this.invI1e11=b[4];this.invI1e12=b[5];this.invI1e20=b[6];this.invI1e21=b[7];this.invI1e22=b[8];b=this.body2.invertInertia.elements;this.invI2e00=b[0];this.invI2e01=b[1];this.invI2e02=b[2];this.invI2e10=b[3];this.invI2e11=b[4];this.invI2e12=b[5];this.invI2e20=b[6];this.invI2e21=b[7];this.invI2e22=b[8];this.xTorqueUnit1X=
this.relPos1Z*this.invI1e01-this.relPos1Y*this.invI1e02;this.xTorqueUnit1Y=this.relPos1Z*this.invI1e11-this.relPos1Y*this.invI1e12;this.xTorqueUnit1Z=this.relPos1Z*this.invI1e21-this.relPos1Y*this.invI1e22;this.xTorqueUnit2X=this.relPos2Z*this.invI2e01-this.relPos2Y*this.invI2e02;this.xTorqueUnit2Y=this.relPos2Z*this.invI2e11-this.relPos2Y*this.invI2e12;this.xTorqueUnit2Z=this.relPos2Z*this.invI2e21-this.relPos2Y*this.invI2e22;this.yTorqueUnit1X=-this.relPos1Z*this.invI1e00+this.relPos1X*this.invI1e02;
this.yTorqueUnit1Y=-this.relPos1Z*this.invI1e10+this.relPos1X*this.invI1e12;this.yTorqueUnit1Z=-this.relPos1Z*this.invI1e20+this.relPos1X*this.invI1e22;this.yTorqueUnit2X=-this.relPos2Z*this.invI2e00+this.relPos2X*this.invI2e02;this.yTorqueUnit2Y=-this.relPos2Z*this.invI2e10+this.relPos2X*this.invI2e12;this.yTorqueUnit2Z=-this.relPos2Z*this.invI2e20+this.relPos2X*this.invI2e22;this.zTorqueUnit1X=this.relPos1Y*this.invI1e00-this.relPos1X*this.invI1e01;this.zTorqueUnit1Y=this.relPos1Y*this.invI1e10-
this.relPos1X*this.invI1e11;this.zTorqueUnit1Z=this.relPos1Y*this.invI1e20-this.relPos1X*this.invI1e21;this.zTorqueUnit2X=this.relPos2Y*this.invI2e00-this.relPos2X*this.invI2e01;this.zTorqueUnit2Y=this.relPos2Y*this.invI2e10-this.relPos2X*this.invI2e11;this.zTorqueUnit2Z=this.relPos2Y*this.invI2e20-this.relPos2X*this.invI2e21;this.d00=this.invM1+this.invM2;this.d10=this.d02=this.d01=0;this.d11=this.d00;this.d21=this.d20=this.d12=0;this.d22=this.d00;b=-this.relPos1Z;e=this.relPos1Y;f=this.relPos1Z;
h=-this.relPos1X;m=-this.relPos1Y;l=this.relPos1X;d=this.invI1e01*f+this.invI1e02*m;g=this.invI1e00*b+this.invI1e02*l;k=this.invI1e00*e+this.invI1e01*h;p=this.invI1e11*f+this.invI1e12*m;x=this.invI1e10*b+this.invI1e12*l;q=this.invI1e10*e+this.invI1e11*h;t=this.invI1e21*f+this.invI1e22*m;v=this.invI1e20*b+this.invI1e22*l;r=this.invI1e20*e+this.invI1e21*h;this.d00-=b*p+e*t;this.d01-=b*x+e*v;this.d02-=b*q+e*r;this.d10-=f*d+h*t;this.d11-=f*g+h*v;this.d12-=f*k+h*r;this.d20-=m*d+l*p;this.d21-=m*g+l*x;this.d22-=
m*k+l*q;b=-this.relPos2Z;e=this.relPos2Y;f=this.relPos2Z;h=-this.relPos2X;m=-this.relPos2Y;l=this.relPos2X;d=this.invI2e01*f+this.invI2e02*m;g=this.invI2e00*b+this.invI2e02*l;k=this.invI2e00*e+this.invI2e01*h;p=this.invI2e11*f+this.invI2e12*m;x=this.invI2e10*b+this.invI2e12*l;q=this.invI2e10*e+this.invI2e11*h;t=this.invI2e21*f+this.invI2e22*m;v=this.invI2e20*b+this.invI2e22*l;r=this.invI2e20*e+this.invI2e21*h;this.d00-=b*p+e*t;this.d01-=b*x+e*v;this.d02-=b*q+e*r;this.d10-=f*d+h*t;this.d11-=f*g+h*
v;this.d12-=f*k+h*r;this.d20-=m*d+l*p;this.d21-=m*g+l*x;this.d22-=m*k+l*q;d=1/(this.d00*(this.d11*this.d22-this.d21*this.d12)+this.d10*(this.d21*this.d02-this.d01*this.d22)+this.d20*(this.d01*this.d12-this.d11*this.d02));g=(this.d11*this.d22-this.d12*this.d21)*d;b=(this.d02*this.d21-this.d01*this.d22)*d;e=(this.d01*this.d12-this.d02*this.d11)*d;f=(this.d12*this.d20-this.d10*this.d22)*d;k=(this.d00*this.d22-this.d02*this.d20)*d;h=(this.d02*this.d10-this.d00*this.d12)*d;m=(this.d10*this.d21-this.d11*
this.d20)*d;l=(this.d01*this.d20-this.d00*this.d21)*d;d*=this.d00*this.d11-this.d01*this.d10;this.d00=g;this.d01=b;this.d02=e;this.d10=f;this.d11=k;this.d12=h;this.d20=m;this.d21=l;this.d22=d;this.lVel1.x+=this.impulseX*this.invM1;this.lVel1.y+=this.impulseY*this.invM1;this.lVel1.z+=this.impulseZ*this.invM1;this.aVel1.x+=this.xTorqueUnit1X*this.impulseX+this.yTorqueUnit1X*this.impulseY+this.zTorqueUnit1X*this.impulseZ;this.aVel1.y+=this.xTorqueUnit1Y*this.impulseX+this.yTorqueUnit1Y*this.impulseY+
this.zTorqueUnit1Y*this.impulseZ;this.aVel1.z+=this.xTorqueUnit1Z*this.impulseX+this.yTorqueUnit1Z*this.impulseY+this.zTorqueUnit1Z*this.impulseZ;this.lVel2.x-=this.impulseX*this.invM2;this.lVel2.y-=this.impulseY*this.invM2;this.lVel2.z-=this.impulseZ*this.invM2;this.aVel2.x-=this.xTorqueUnit2X*this.impulseX+this.yTorqueUnit2X*this.impulseY+this.zTorqueUnit2X*this.impulseZ;this.aVel2.y-=this.xTorqueUnit2Y*this.impulseX+this.yTorqueUnit2Y*this.impulseY+this.zTorqueUnit2Y*this.impulseZ;this.aVel2.z-=
this.xTorqueUnit2Z*this.impulseX+this.yTorqueUnit2Z*this.impulseY+this.zTorqueUnit2Z*this.impulseZ;this.targetVelX=this.anchorPosition2.x-this.anchorPosition1.x;this.targetVelY=this.anchorPosition2.y-this.anchorPosition1.y;this.targetVelZ=this.anchorPosition2.z-this.anchorPosition1.z;d=Math.sqrt(this.targetVelX*this.targetVelX+this.targetVelY*this.targetVelY+this.targetVelZ*this.targetVelZ);0.005>d?this.targetVelZ=this.targetVelY=this.targetVelX=0:(d=(0.005-d)/d*c*0.05,this.targetVelX*=d,this.targetVelY*=
d,this.targetVelZ*=d)};
OIMO.BallJoint.prototype.solve=function(){var a,c,b,d,e;a=this.lVel2.x-this.lVel1.x+this.aVel2.y*this.relPos2Z-this.aVel2.z*this.relPos2Y-this.aVel1.y*this.relPos1Z+this.aVel1.z*this.relPos1Y-this.targetVelX;c=this.lVel2.y-this.lVel1.y+this.aVel2.z*this.relPos2X-this.aVel2.x*this.relPos2Z-this.aVel1.z*this.relPos1X+this.aVel1.x*this.relPos1Z-this.targetVelY;b=this.lVel2.z-this.lVel1.z+this.aVel2.x*this.relPos2Y-this.aVel2.y*this.relPos2X-this.aVel1.x*this.relPos1Y+this.aVel1.y*this.relPos1X-this.targetVelZ;
d=a*this.d00+c*this.d01+b*this.d02;e=a*this.d10+c*this.d11+b*this.d12;a=a*this.d20+c*this.d21+b*this.d22;this.impulseX+=d;this.impulseY+=e;this.impulseZ+=a;this.lVel1.x+=d*this.invM1;this.lVel1.y+=e*this.invM1;this.lVel1.z+=a*this.invM1;this.aVel1.x+=this.xTorqueUnit1X*d+this.yTorqueUnit1X*e+this.zTorqueUnit1X*a;this.aVel1.y+=this.xTorqueUnit1Y*d+this.yTorqueUnit1Y*e+this.zTorqueUnit1Y*a;this.aVel1.z+=this.xTorqueUnit1Z*d+this.yTorqueUnit1Z*e+this.zTorqueUnit1Z*a;this.lVel2.x-=d*this.invM2;this.lVel2.y-=
e*this.invM2;this.lVel2.z-=a*this.invM2;this.aVel2.x-=this.xTorqueUnit2X*d+this.yTorqueUnit2X*e+this.zTorqueUnit2X*a;this.aVel2.y-=this.xTorqueUnit2Y*d+this.yTorqueUnit2Y*e+this.zTorqueUnit2Y*a;this.aVel2.z-=this.xTorqueUnit2Z*d+this.yTorqueUnit2Z*e+this.zTorqueUnit2Z*a};OIMO.BallJoint.prototype.postSolve=function(){this.impulse.x=this.impulseX;this.impulse.y=this.impulseY;this.impulse.z=this.impulseZ};OIMO.DistanceJoint=function(a,c,b,d){OIMO.Joint.call(this);this.targetNormalVelocity=this.normalDenominator=this.invI2e22=this.invI2e21=this.invI2e20=this.invI2e12=this.invI2e11=this.invI2e10=this.invI2e02=this.invI2e01=this.invI2e00=this.invI1e22=this.invI1e21=this.invI1e20=this.invI1e12=this.invI1e11=this.invI1e10=this.invI1e02=this.invI1e01=this.invI1e00=this.norTorqueUnit2Z=this.norTorqueUnit2Y=this.norTorqueUnit2X=this.norTorqueUnit1Z=this.norTorqueUnit1Y=this.norTorqueUnit1X=this.norTorque2Z=
this.norTorque2Y=this.norTorque2X=this.norTorque1Z=this.norTorque1Y=this.norTorque1X=this.relPos2Z=this.relPos2Y=this.relPos2X=this.relPos1Z=this.relPos1Y=this.relPos1X=this.norZ=this.norY=this.norX=this.posError=NaN;this.body1=c;this.body2=b;this.connection1.connected=b;this.connection2.connected=c;this.distance=d;this.allowCollision=a.allowCollision;this.localRelativeAnchorPosition1.copy(a.localRelativeAnchorPosition1);this.localRelativeAnchorPosition2.copy(a.localRelativeAnchorPosition2);this.type=
this.JOINT_DISTANCE;this.lVel1=this.body1.linearVelocity;this.lVel2=this.body2.linearVelocity;this.aVel1=this.body1.angularVelocity;this.aVel2=this.body2.angularVelocity;this.invM1=this.body1.invertMass;this.invM2=this.body2.invertMass;this.impulse=0};OIMO.DistanceJoint.prototype=Object.create(OIMO.Joint.prototype);
OIMO.DistanceJoint.prototype.preSolve=function(a,c){var b,d,e,f,g,k;b=this.body1.rotation.elements;d=this.localRelativeAnchorPosition1.x;e=this.localRelativeAnchorPosition1.y;f=this.localRelativeAnchorPosition1.z;this.relPos1X=this.relativeAnchorPosition1.x=d*b[0]+e*b[1]+f*b[2];this.relPos1Y=this.relativeAnchorPosition1.y=d*b[3]+e*b[4]+f*b[5];this.relPos1Z=this.relativeAnchorPosition1.z=d*b[6]+e*b[7]+f*b[8];b=this.body2.rotation.elements;d=this.localRelativeAnchorPosition2.x;e=this.localRelativeAnchorPosition2.y;
f=this.localRelativeAnchorPosition2.z;this.relPos2X=this.relativeAnchorPosition2.x=d*b[0]+e*b[1]+f*b[2];this.relPos2Y=this.relativeAnchorPosition2.y=d*b[3]+e*b[4]+f*b[5];this.relPos2Z=this.relativeAnchorPosition2.z=d*b[6]+e*b[7]+f*b[8];this.norX=(this.anchorPosition2.x=this.relPos2X+this.body2.position.x)-(this.anchorPosition1.x=this.relPos1X+this.body1.position.x);this.norY=(this.anchorPosition2.y=this.relPos2Y+this.body2.position.y)-(this.anchorPosition1.y=this.relPos1Y+this.body1.position.y);this.norZ=
(this.anchorPosition2.z=this.relPos2Z+this.body2.position.z)-(this.anchorPosition1.z=this.relPos1Z+this.body1.position.z);d=Math.sqrt(this.norX*this.norX+this.norY*this.norY+this.norZ*this.norZ);this.posError=this.distance-d;0<d&&(d=1/d);this.norX*=d;this.norY*=d;this.norZ*=d;b=this.body1.invertInertia.elements;this.invI1e00=b[0];this.invI1e01=b[1];this.invI1e02=b[2];this.invI1e10=b[3];this.invI1e11=b[4];this.invI1e12=b[5];this.invI1e20=b[6];this.invI1e21=b[7];this.invI1e22=b[8];b=this.body2.invertInertia.elements;
this.invI2e00=b[0];this.invI2e01=b[1];this.invI2e02=b[2];this.invI2e10=b[3];this.invI2e11=b[4];this.invI2e12=b[5];this.invI2e20=b[6];this.invI2e21=b[7];this.invI2e22=b[8];this.norTorque1X=this.relPos1Y*this.norZ-this.relPos1Z*this.norY;this.norTorque1Y=this.relPos1Z*this.norX-this.relPos1X*this.norZ;this.norTorque1Z=this.relPos1X*this.norY-this.relPos1Y*this.norX;this.norTorque2X=this.relPos2Y*this.norZ-this.relPos2Z*this.norY;this.norTorque2Y=this.relPos2Z*this.norX-this.relPos2X*this.norZ;this.norTorque2Z=
this.relPos2X*this.norY-this.relPos2Y*this.norX;this.norTorqueUnit1X=this.norTorque1X*this.invI1e00+this.norTorque1Y*this.invI1e01+this.norTorque1Z*this.invI1e02;this.norTorqueUnit1Y=this.norTorque1X*this.invI1e10+this.norTorque1Y*this.invI1e11+this.norTorque1Z*this.invI1e12;this.norTorqueUnit1Z=this.norTorque1X*this.invI1e20+this.norTorque1Y*this.invI1e21+this.norTorque1Z*this.invI1e22;this.norTorqueUnit2X=this.norTorque2X*this.invI2e00+this.norTorque2Y*this.invI2e01+this.norTorque2Z*this.invI2e02;
this.norTorqueUnit2Y=this.norTorque2X*this.invI2e10+this.norTorque2Y*this.invI2e11+this.norTorque2Z*this.invI2e12;this.norTorqueUnit2Z=this.norTorque2X*this.invI2e20+this.norTorque2Y*this.invI2e21+this.norTorque2Z*this.invI2e22;d=this.norTorque1X*this.invI1e00+this.norTorque1Y*this.invI1e01+this.norTorque1Z*this.invI1e02;e=this.norTorque1X*this.invI1e10+this.norTorque1Y*this.invI1e11+this.norTorque1Z*this.invI1e12;f=this.norTorque1X*this.invI1e20+this.norTorque1Y*this.invI1e21+this.norTorque1Z*this.invI1e22;
b=e*this.relPos1Z-f*this.relPos1Y;g=f*this.relPos1X-d*this.relPos1Z;k=d*this.relPos1Y-e*this.relPos1X;d=this.norTorque2X*this.invI2e00+this.norTorque2Y*this.invI2e01+this.norTorque2Z*this.invI2e02;e=this.norTorque2X*this.invI2e10+this.norTorque2Y*this.invI2e11+this.norTorque2Z*this.invI2e12;f=this.norTorque2X*this.invI2e20+this.norTorque2Y*this.invI2e21+this.norTorque2Z*this.invI2e22;b+=e*this.relPos2Z-f*this.relPos2Y;g+=f*this.relPos2X-d*this.relPos2Z;k+=d*this.relPos2Y-e*this.relPos2X;this.normalDenominator=
1/(this.invM1+this.invM2+this.norX*b+this.norY*g+this.norZ*k);d=this.norX*this.impulse;e=this.norY*this.impulse;f=this.norZ*this.impulse;this.lVel1.x+=d*this.invM1;this.lVel1.y+=e*this.invM1;this.lVel1.z+=f*this.invM1;this.aVel1.x+=this.norTorqueUnit1X*this.impulse;this.aVel1.y+=this.norTorqueUnit1Y*this.impulse;this.aVel1.z+=this.norTorqueUnit1Z*this.impulse;this.lVel2.x-=d*this.invM2;this.lVel2.y-=e*this.invM2;this.lVel2.z-=f*this.invM2;this.aVel2.x-=this.norTorqueUnit2X*this.impulse;this.aVel2.y-=
this.norTorqueUnit2Y*this.impulse;this.aVel2.z-=this.norTorqueUnit2Z*this.impulse;this.posError=-0.005>this.posError?this.posError+0.005:0.005<this.posError?this.posError-0.005:0;this.targetNormalVelocity=this.posError*c*0.05};
OIMO.DistanceJoint.prototype.solve=function(){var a,c,b,d;a=((this.lVel2.x-this.lVel1.x)*this.norX+(this.lVel2.y-this.lVel1.y)*this.norY+(this.lVel2.z-this.lVel1.z)*this.norZ+this.aVel2.x*this.norTorque2X+this.aVel2.y*this.norTorque2Y+this.aVel2.z*this.norTorque2Z-this.aVel1.x*this.norTorque1X-this.aVel1.y*this.norTorque1Y-this.aVel1.z*this.norTorque1Z-this.targetNormalVelocity)*this.normalDenominator;this.impulse+=a;c=this.norX*a;b=this.norY*a;d=this.norZ*a;this.lVel1.x+=c*this.invM1;this.lVel1.y+=
b*this.invM1;this.lVel1.z+=d*this.invM1;this.aVel1.x+=this.norTorqueUnit1X*a;this.aVel1.y+=this.norTorqueUnit1Y*a;this.aVel1.z+=this.norTorqueUnit1Z*a;this.lVel2.x-=c*this.invM2;this.lVel2.y-=b*this.invM2;this.lVel2.z-=d*this.invM2;this.aVel2.x-=this.norTorqueUnit2X*a;this.aVel2.y-=this.norTorqueUnit2Y*a;this.aVel2.z-=this.norTorqueUnit2Z*a};OIMO.DistanceJoint.prototype.postSolve=function(){};OIMO.HingeJoint=function(a,c,b){OIMO.Joint.call(this);this.enableLimits=!1;this.upperLimit=this.lowerLimit=NaN;this.limitSign=0;this.enableMotor=!1;this.targetAngVelBin=this.targetAngVelTan=this.targetAngVelNor=this.targetVelZ=this.targetVelY=this.targetVelX=this.invNorDenominator=this.binDenominator=this.tanDenominator=this.norDenominator=this.d22=this.d21=this.d20=this.d12=this.d11=this.d10=this.d02=this.d01=this.d00=this.invI2e22=this.invI2e21=this.invI2e20=this.invI2e12=this.invI2e11=this.invI2e10=
this.invI2e02=this.invI2e01=this.invI2e00=this.invI1e22=this.invI1e21=this.invI1e20=this.invI1e12=this.invI1e11=this.invI1e10=this.invI1e02=this.invI1e01=this.invI1e00=this.zTorqueUnit2Z=this.zTorqueUnit2Y=this.zTorqueUnit2X=this.zTorqueUnit1Z=this.zTorqueUnit1Y=this.zTorqueUnit1X=this.yTorqueUnit2Z=this.yTorqueUnit2Y=this.yTorqueUnit2X=this.yTorqueUnit1Z=this.yTorqueUnit1Y=this.yTorqueUnit1X=this.xTorqueUnit2Z=this.xTorqueUnit2Y=this.xTorqueUnit2X=this.xTorqueUnit1Z=this.xTorqueUnit1Y=this.xTorqueUnit1X=
this.relPos2Z=this.relPos2Y=this.relPos2X=this.relPos1Z=this.relPos1Y=this.relPos1X=this.hingeAngle=this.binZ=this.binY=this.binX=this.tanZ=this.tanY=this.tanX=this.norZ=this.norY=this.norX=this.angAxis2Z=this.angAxis2Y=this.angAxis2X=this.angAxis1Z=this.angAxis1Y=this.angAxis1X=this.axis2Z=this.axis2Y=this.axis2X=this.axis1Z=this.axis1Y=this.axis1X=this.stepMotorTorque=this.maxMotorTorque=this.motorSpeed=NaN;this.body1=c;this.body2=b;this.connection1.connected=b;this.connection2.connected=c;this.localAxis1=
new OIMO.Vec3;this.localAxis2=new OIMO.Vec3;this.localAxis1.normalize(a.localAxis1);this.localAxis2.normalize(a.localAxis2);this.localAxis1X=this.localAxis1.x;this.localAxis1Y=this.localAxis1.y;this.localAxis1Z=this.localAxis1.z;this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z;this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X;this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y;c=1/Math.sqrt(this.localAngAxis1X*
this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z);this.localAngAxis1X*=c;this.localAngAxis1Y*=c;this.localAngAxis1Z*=c;this.localAxis2X=this.localAxis2.x;this.localAxis2Y=this.localAxis2.y;this.localAxis2Z=this.localAxis2.z;this.localAngAxis2X=this.localAxis2Y*this.localAxis2X-this.localAxis2Z*this.localAxis2Z;this.localAngAxis2Y=-this.localAxis2Z*this.localAxis2Y-this.localAxis2X*this.localAxis2X;this.localAngAxis2Z=this.localAxis2X*this.localAxis2Z+
this.localAxis2Y*this.localAxis2Y;c=1/Math.sqrt(this.localAngAxis2X*this.localAngAxis2X+this.localAngAxis2Y*this.localAngAxis2Y+this.localAngAxis2Z*this.localAngAxis2Z);this.localAngAxis2X*=c;this.localAngAxis2Y*=c;this.localAngAxis2Z*=c;this.allowCollision=a.allowCollision;this.localRelativeAnchorPosition1.copy(a.localRelativeAnchorPosition1);this.localRelativeAnchorPosition2.copy(a.localRelativeAnchorPosition2);this.type=this.JOINT_HINGE;this.lVel1=this.body1.linearVelocity;this.lVel2=this.body2.linearVelocity;
this.aVel1=this.body1.angularVelocity;this.aVel2=this.body2.angularVelocity;this.invM1=this.body1.invertMass;this.invM2=this.body2.invertMass;this.impulse=new OIMO.Vec3;this.torque=new OIMO.Vec3;this.torqueBin=this.torqueTan=this.torqueZ=this.torqueY=this.torqueX=this.motorTorque=this.limitTorque=this.impulseZ=this.impulseY=this.impulseX=0};OIMO.HingeJoint.prototype=Object.create(OIMO.Joint.prototype);
OIMO.HingeJoint.prototype.preSolve=function(a,c){var b,d,e,f,g,k,h,m,l,p,x,q,t,v,r;b=this.body1.rotation.elements;this.axis1X=this.localAxis1X*b[0]+this.localAxis1Y*b[1]+this.localAxis1Z*b[2];this.axis1Y=this.localAxis1X*b[3]+this.localAxis1Y*b[4]+this.localAxis1Z*b[5];this.axis1Z=this.localAxis1X*b[6]+this.localAxis1Y*b[7]+this.localAxis1Z*b[8];this.angAxis1X=this.localAngAxis1X*b[0]+this.localAngAxis1Y*b[1]+this.localAngAxis1Z*b[2];this.angAxis1Y=this.localAngAxis1X*b[3]+this.localAngAxis1Y*b[4]+
this.localAngAxis1Z*b[5];this.angAxis1Z=this.localAngAxis1X*b[6]+this.localAngAxis1Y*b[7]+this.localAngAxis1Z*b[8];d=this.localRelativeAnchorPosition1.x;e=this.localRelativeAnchorPosition1.y;f=this.localRelativeAnchorPosition1.z;this.relPos1X=this.relativeAnchorPosition1.x=d*b[0]+e*b[1]+f*b[2];this.relPos1Y=this.relativeAnchorPosition1.y=d*b[3]+e*b[4]+f*b[5];this.relPos1Z=this.relativeAnchorPosition1.z=d*b[6]+e*b[7]+f*b[8];b=this.body2.rotation.elements;this.axis2X=this.localAxis2X*b[0]+this.localAxis2Y*
b[1]+this.localAxis2Z*b[2];this.axis2Y=this.localAxis2X*b[3]+this.localAxis2Y*b[4]+this.localAxis2Z*b[5];this.axis2Z=this.localAxis2X*b[6]+this.localAxis2Y*b[7]+this.localAxis2Z*b[8];this.angAxis2X=this.localAngAxis2X*b[0]+this.localAngAxis2Y*b[1]+this.localAngAxis2Z*b[2];this.angAxis2Y=this.localAngAxis2X*b[3]+this.localAngAxis2Y*b[4]+this.localAngAxis2Z*b[5];this.angAxis2Z=this.localAngAxis2X*b[6]+this.localAngAxis2Y*b[7]+this.localAngAxis2Z*b[8];d=this.localRelativeAnchorPosition2.x;e=this.localRelativeAnchorPosition2.y;
f=this.localRelativeAnchorPosition2.z;this.relPos2X=this.relativeAnchorPosition2.x=d*b[0]+e*b[1]+f*b[2];this.relPos2Y=this.relativeAnchorPosition2.y=d*b[3]+e*b[4]+f*b[5];this.relPos2Z=this.relativeAnchorPosition2.z=d*b[6]+e*b[7]+f*b[8];this.anchorPosition1.x=this.relPos1X+this.body1.position.x;this.anchorPosition1.y=this.relPos1Y+this.body1.position.y;this.anchorPosition1.z=this.relPos1Z+this.body1.position.z;this.anchorPosition2.x=this.relPos2X+this.body2.position.x;this.anchorPosition2.y=this.relPos2Y+
this.body2.position.y;this.anchorPosition2.z=this.relPos2Z+this.body2.position.z;d=1/(this.invM1+this.invM2);this.norX=(this.axis1X*this.invM1+this.axis2X*this.invM2)*d;this.norY=(this.axis1Y*this.invM1+this.axis2Y*this.invM2)*d;this.norZ=(this.axis1Z*this.invM1+this.axis2Z*this.invM2)*d;d=Math.sqrt(this.norX*this.norX+this.norY*this.norY+this.norZ*this.norZ);0<d&&(d=1/d);this.norX*=d;this.norY*=d;this.norZ*=d;this.tanX=this.norY*this.norX-this.norZ*this.norZ;this.tanY=-this.norZ*this.norY-this.norX*
this.norX;this.tanZ=this.norX*this.norZ+this.norY*this.norY;d=1/Math.sqrt(this.tanX*this.tanX+this.tanY*this.tanY+this.tanZ*this.tanZ);this.tanX*=d;this.tanY*=d;this.tanZ*=d;this.binX=this.norY*this.tanZ-this.norZ*this.tanY;this.binY=this.norZ*this.tanX-this.norX*this.tanZ;this.binZ=this.norX*this.tanY-this.norY*this.tanX;this.hingeAngle=0>this.norX*(this.angAxis1Y*this.angAxis2Z-this.angAxis1Z*this.angAxis2Y)+this.norY*(this.angAxis1Z*this.angAxis2X-this.angAxis1X*this.angAxis2Z)+this.norZ*(this.angAxis1X*
this.angAxis2Y-this.angAxis1Y*this.angAxis2X)?-Math.acos(this.angAxis1X*this.angAxis2X+this.angAxis1Y*this.angAxis2Y+this.angAxis1Z*this.angAxis2Z):Math.acos(this.angAxis1X*this.angAxis2X+this.angAxis1Y*this.angAxis2Y+this.angAxis1Z*this.angAxis2Z);b=this.body1.invertInertia.elements;this.invI1e00=b[0];this.invI1e01=b[1];this.invI1e02=b[2];this.invI1e10=b[3];this.invI1e11=b[4];this.invI1e12=b[5];this.invI1e20=b[6];this.invI1e21=b[7];this.invI1e22=b[8];b=this.body2.invertInertia.elements;this.invI2e00=
b[0];this.invI2e01=b[1];this.invI2e02=b[2];this.invI2e10=b[3];this.invI2e11=b[4];this.invI2e12=b[5];this.invI2e20=b[6];this.invI2e21=b[7];this.invI2e22=b[8];this.xTorqueUnit1X=this.relPos1Z*this.invI1e01-this.relPos1Y*this.invI1e02;this.xTorqueUnit1Y=this.relPos1Z*this.invI1e11-this.relPos1Y*this.invI1e12;this.xTorqueUnit1Z=this.relPos1Z*this.invI1e21-this.relPos1Y*this.invI1e22;this.xTorqueUnit2X=this.relPos2Z*this.invI2e01-this.relPos2Y*this.invI2e02;this.xTorqueUnit2Y=this.relPos2Z*this.invI2e11-
this.relPos2Y*this.invI2e12;this.xTorqueUnit2Z=this.relPos2Z*this.invI2e21-this.relPos2Y*this.invI2e22;this.yTorqueUnit1X=-this.relPos1Z*this.invI1e00+this.relPos1X*this.invI1e02;this.yTorqueUnit1Y=-this.relPos1Z*this.invI1e10+this.relPos1X*this.invI1e12;this.yTorqueUnit1Z=-this.relPos1Z*this.invI1e20+this.relPos1X*this.invI1e22;this.yTorqueUnit2X=-this.relPos2Z*this.invI2e00+this.relPos2X*this.invI2e02;this.yTorqueUnit2Y=-this.relPos2Z*this.invI2e10+this.relPos2X*this.invI2e12;this.yTorqueUnit2Z=
-this.relPos2Z*this.invI2e20+this.relPos2X*this.invI2e22;this.zTorqueUnit1X=this.relPos1Y*this.invI1e00-this.relPos1X*this.invI1e01;this.zTorqueUnit1Y=this.relPos1Y*this.invI1e10-this.relPos1X*this.invI1e11;this.zTorqueUnit1Z=this.relPos1Y*this.invI1e20-this.relPos1X*this.invI1e21;this.zTorqueUnit2X=this.relPos2Y*this.invI2e00-this.relPos2X*this.invI2e01;this.zTorqueUnit2Y=this.relPos2Y*this.invI2e10-this.relPos2X*this.invI2e11;this.zTorqueUnit2Z=this.relPos2Y*this.invI2e20-this.relPos2X*this.invI2e21;
this.d00=this.invM1+this.invM2;this.d10=this.d02=this.d01=0;this.d11=this.d00;this.d21=this.d20=this.d12=0;this.d22=this.d00;b=-this.relPos1Z;e=this.relPos1Y;f=this.relPos1Z;h=-this.relPos1X;m=-this.relPos1Y;l=this.relPos1X;d=this.invI1e01*f+this.invI1e02*m;g=this.invI1e00*b+this.invI1e02*l;k=this.invI1e00*e+this.invI1e01*h;p=this.invI1e11*f+this.invI1e12*m;x=this.invI1e10*b+this.invI1e12*l;q=this.invI1e10*e+this.invI1e11*h;t=this.invI1e21*f+this.invI1e22*m;v=this.invI1e20*b+this.invI1e22*l;r=this.invI1e20*
e+this.invI1e21*h;this.d00-=b*p+e*t;this.d01-=b*x+e*v;this.d02-=b*q+e*r;this.d10-=f*d+h*t;this.d11-=f*g+h*v;this.d12-=f*k+h*r;this.d20-=m*d+l*p;this.d21-=m*g+l*x;this.d22-=m*k+l*q;b=-this.relPos2Z;e=this.relPos2Y;f=this.relPos2Z;h=-this.relPos2X;m=-this.relPos2Y;l=this.relPos2X;d=this.invI2e01*f+this.invI2e02*m;g=this.invI2e00*b+this.invI2e02*l;k=this.invI2e00*e+this.invI2e01*h;p=this.invI2e11*f+this.invI2e12*m;x=this.invI2e10*b+this.invI2e12*l;q=this.invI2e10*e+this.invI2e11*h;t=this.invI2e21*f+
this.invI2e22*m;v=this.invI2e20*b+this.invI2e22*l;r=this.invI2e20*e+this.invI2e21*h;this.d00-=b*p+e*t;this.d01-=b*x+e*v;this.d02-=b*q+e*r;this.d10-=f*d+h*t;this.d11-=f*g+h*v;this.d12-=f*k+h*r;this.d20-=m*d+l*p;this.d21-=m*g+l*x;this.d22-=m*k+l*q;d=1/(this.d00*(this.d11*this.d22-this.d21*this.d12)+this.d10*(this.d21*this.d02-this.d01*this.d22)+this.d20*(this.d01*this.d12-this.d11*this.d02));g=(this.d11*this.d22-this.d12*this.d21)*d;b=(this.d02*this.d21-this.d01*this.d22)*d;e=(this.d01*this.d12-this.d02*
this.d11)*d;f=(this.d12*this.d20-this.d10*this.d22)*d;k=(this.d00*this.d22-this.d02*this.d20)*d;h=(this.d02*this.d10-this.d00*this.d12)*d;m=(this.d10*this.d21-this.d11*this.d20)*d;l=(this.d01*this.d20-this.d00*this.d21)*d;d*=this.d00*this.d11-this.d01*this.d10;this.d00=g;this.d01=b;this.d02=e;this.d10=f;this.d11=k;this.d12=h;this.d20=m;this.d21=l;this.d22=d;g=this.invI1e00+this.invI2e00;b=this.invI1e01+this.invI2e01;e=this.invI1e02+this.invI2e02;f=this.invI1e10+this.invI2e10;k=this.invI1e11+this.invI2e11;
h=this.invI1e12+this.invI2e12;m=this.invI1e20+this.invI2e20;l=this.invI1e21+this.invI2e21;d=this.invI1e22+this.invI2e22;this.invNorDenominator=this.norX*(this.norX*g+this.norY*b+this.norZ*e)+this.norY*(this.norX*f+this.norY*k+this.norZ*h)+this.norZ*(this.norX*m+this.norY*l+this.norZ*d);this.norDenominator=1/this.invNorDenominator;this.tanDenominator=1/(this.tanX*(this.tanX*g+this.tanY*b+this.tanZ*e)+this.tanY*(this.tanX*f+this.tanY*k+this.tanZ*h)+this.tanZ*(this.tanX*m+this.tanY*l+this.tanZ*d));this.binDenominator=
1/(this.binX*(this.binX*g+this.binY*b+this.binZ*e)+this.binY*(this.binX*f+this.binY*k+this.binZ*h)+this.binZ*(this.binX*m+this.binY*l+this.binZ*d));this.enableLimits?this.hingeAngle<this.lowerLimit?(-1!=this.limitSign&&(this.limitTorque=0),this.limitSign=-1):this.hingeAngle>this.upperLimit?(1!=this.limitSign&&(this.limitTorque=0),this.limitSign=1):this.limitTorque=this.limitSign=0:this.limitTorque=this.limitSign=0;this.enableMotor&&(this.stepMotorTorque=a*this.maxMotorTorque);this.torqueTan*=0.95;
this.torqueBin*=0.95;this.motorTorque*=0.95;this.limitTorque*=0.95;d=this.limitTorque+this.motorTorque;this.torqueX=d*this.norX+this.torqueTan*this.tanX+this.torqueBin*this.binX;this.torqueY=d*this.norY+this.torqueTan*this.tanY+this.torqueBin*this.binY;this.torqueZ=d*this.norZ+this.torqueTan*this.tanZ+this.torqueBin*this.binZ;this.lVel1.x+=this.impulseX*this.invM1;this.lVel1.y+=this.impulseY*this.invM1;this.lVel1.z+=this.impulseZ*this.invM1;this.aVel1.x+=this.xTorqueUnit1X*this.impulseX+this.yTorqueUnit1X*
this.impulseY+this.zTorqueUnit1X*this.impulseZ+this.torqueX*this.invI1e00+this.torqueY*this.invI1e01+this.torqueZ*this.invI1e02;this.aVel1.y+=this.xTorqueUnit1Y*this.impulseX+this.yTorqueUnit1Y*this.impulseY+this.zTorqueUnit1Y*this.impulseZ+this.torqueX*this.invI1e10+this.torqueY*this.invI1e11+this.torqueZ*this.invI1e12;this.aVel1.z+=this.xTorqueUnit1Z*this.impulseX+this.yTorqueUnit1Z*this.impulseY+this.zTorqueUnit1Z*this.impulseZ+this.torqueX*this.invI1e20+this.torqueY*this.invI1e21+this.torqueZ*
this.invI1e22;this.lVel2.x-=this.impulseX*this.invM2;this.lVel2.y-=this.impulseY*this.invM2;this.lVel2.z-=this.impulseZ*this.invM2;this.aVel2.x-=this.xTorqueUnit2X*this.impulseX+this.yTorqueUnit2X*this.impulseY+this.zTorqueUnit2X*this.impulseZ+this.torqueX*this.invI2e00+this.torqueY*this.invI2e01+this.torqueZ*this.invI2e02;this.aVel2.y-=this.xTorqueUnit2Y*this.impulseX+this.yTorqueUnit2Y*this.impulseY+this.zTorqueUnit2Y*this.impulseZ+this.torqueX*this.invI2e10+this.torqueY*this.invI2e11+this.torqueZ*
this.invI2e12;this.aVel2.z-=this.xTorqueUnit2Z*this.impulseX+this.yTorqueUnit2Z*this.impulseY+this.zTorqueUnit2Z*this.impulseZ+this.torqueX*this.invI2e20+this.torqueY*this.invI2e21+this.torqueZ*this.invI2e22;this.targetVelX=this.anchorPosition2.x-this.anchorPosition1.x;this.targetVelY=this.anchorPosition2.y-this.anchorPosition1.y;this.targetVelZ=this.anchorPosition2.z-this.anchorPosition1.z;d=Math.sqrt(this.targetVelX*this.targetVelX+this.targetVelY*this.targetVelY+this.targetVelZ*this.targetVelZ);
0.005>d?this.targetVelZ=this.targetVelY=this.targetVelX=0:(d=(0.005-d)/d*c*0.05,this.targetVelX*=d,this.targetVelY*=d,this.targetVelZ*=d);d=this.axis2Y*this.axis1Z-this.axis2Z*this.axis1Y;e=this.axis2Z*this.axis1X-this.axis2X*this.axis1Z;f=this.axis2X*this.axis1Y-this.axis2Y*this.axis1X;this.targetAngVelTan=this.tanX*d+this.tanY*e+this.tanZ*f;this.targetAngVelTan=0.02<this.targetAngVelTan?(this.targetAngVelTan-0.02)*c*0.05:-0.02>this.targetAngVelTan?(this.targetAngVelTan+0.02)*c*0.05:0;this.targetAngVelBin=
this.binX*d+this.binY*e+this.binZ*f;this.targetAngVelBin=0.02<this.targetAngVelBin?(this.targetAngVelBin-0.02)*c*0.05:-0.02>this.targetAngVelBin?(this.targetAngVelBin+0.02)*c*0.05:0;-1==this.limitSign?(this.targetAngVelNor=this.lowerLimit-this.hingeAngle,this.targetAngVelNor=0.02>this.targetAngVelNor?0:(this.targetAngVelNor-0.02)*c*0.05):1==this.limitSign?(this.targetAngVelNor=this.upperLimit-this.hingeAngle,this.targetAngVelNor=-0.02<this.targetAngVelNor?0:(this.targetAngVelNor+0.02)*c*0.05):this.targetAngVelNor=
0};
OIMO.HingeJoint.prototype.solve=function(){var a,c,b,d,e,f,g;a=this.lVel2.x-this.lVel1.x+this.aVel2.y*this.relPos2Z-this.aVel2.z*this.relPos2Y-this.aVel1.y*this.relPos1Z+this.aVel1.z*this.relPos1Y-this.targetVelX;c=this.lVel2.y-this.lVel1.y+this.aVel2.z*this.relPos2X-this.aVel2.x*this.relPos2Z-this.aVel1.z*this.relPos1X+this.aVel1.x*this.relPos1Z-this.targetVelY;b=this.lVel2.z-this.lVel1.z+this.aVel2.x*this.relPos2Y-this.aVel2.y*this.relPos2X-this.aVel1.x*this.relPos1Y+this.aVel1.y*this.relPos1X-this.targetVelZ;
e=a*this.d00+c*this.d01+b*this.d02;f=a*this.d10+c*this.d11+b*this.d12;a=a*this.d20+c*this.d21+b*this.d22;this.impulseX+=e;this.impulseY+=f;this.impulseZ+=a;this.lVel1.x+=e*this.invM1;this.lVel1.y+=f*this.invM1;this.lVel1.z+=a*this.invM1;this.aVel1.x+=this.xTorqueUnit1X*e+this.yTorqueUnit1X*f+this.zTorqueUnit1X*a;this.aVel1.y+=this.xTorqueUnit1Y*e+this.yTorqueUnit1Y*f+this.zTorqueUnit1Y*a;this.aVel1.z+=this.xTorqueUnit1Z*e+this.yTorqueUnit1Z*f+this.zTorqueUnit1Z*a;this.lVel2.x-=e*this.invM2;this.lVel2.y-=
f*this.invM2;this.lVel2.z-=a*this.invM2;this.aVel2.x-=this.xTorqueUnit2X*e+this.yTorqueUnit2X*f+this.zTorqueUnit2X*a;this.aVel2.y-=this.xTorqueUnit2Y*e+this.yTorqueUnit2Y*f+this.zTorqueUnit2Y*a;this.aVel2.z-=this.xTorqueUnit2Z*e+this.yTorqueUnit2Z*f+this.zTorqueUnit2Z*a;a=this.aVel2.x-this.aVel1.x;c=this.aVel2.y-this.aVel1.y;b=this.aVel2.z-this.aVel1.z;d=a*this.norX+c*this.norY+b*this.norZ;this.enableMotor?(e=(d-this.motorSpeed)*this.norDenominator,f=this.motorTorque,this.motorTorque+=e,this.motorTorque>
this.stepMotorTorque?this.motorTorque=this.stepMotorTorque:this.motorTorque<-this.stepMotorTorque&&(this.motorTorque=-this.stepMotorTorque),e=this.motorTorque-f,d-=e*this.invNorDenominator):e=0;0!=this.limitSign?(f=(d-this.targetAngVelNor)*this.norDenominator,d=this.limitTorque,this.limitTorque+=f,0>this.limitTorque*this.limitSign&&(this.limitTorque=0),f=this.limitTorque-d):f=0;d=e+f;g=(a*this.tanX+c*this.tanY+b*this.tanZ-this.targetAngVelTan)*this.tanDenominator;a=(a*this.binX+c*this.binY+b*this.binZ-
this.targetAngVelBin)*this.binDenominator;this.torqueTan+=g;this.torqueBin+=a;e=d*this.norX+g*this.tanX+a*this.binX;f=d*this.norY+g*this.tanY+a*this.binY;a=d*this.norZ+g*this.tanZ+a*this.binZ;this.aVel1.x+=this.invI1e00*e+this.invI1e01*f+this.invI1e02*a;this.aVel1.y+=this.invI1e10*e+this.invI1e11*f+this.invI1e12*a;this.aVel1.z+=this.invI1e20*e+this.invI1e21*f+this.invI1e22*a;this.aVel2.x-=this.invI2e00*e+this.invI2e01*f+this.invI2e02*a;this.aVel2.y-=this.invI2e10*e+this.invI2e11*f+this.invI2e12*a;
this.aVel2.z-=this.invI2e20*e+this.invI2e21*f+this.invI2e22*a};OIMO.HingeJoint.prototype.postSolve=function(){this.impulse.x=this.impulseX;this.impulse.y=this.impulseY;this.impulse.z=this.impulseZ;this.torque.x=this.torqueX;this.torque.y=this.torqueY;this.torque.z=this.torqueZ};OIMO.HingeJoint.prototype.acosClamp=function(a){return 1<a?0:-1>a?Math.PI:Math.acos(a)};OIMO.Hinge2Joint=function(a,c,b){OIMO.Joint.call(this);this.motorTorque2=this.limitTorque2=this.motorTorque1=this.limitTorque1=NaN;this.enableLimits1=!1;this.upperLimit1=this.lowerLimit1=NaN;this.limitSign1=0;this.enableLimits2=!1;this.upperLimit2=this.lowerLimit2=NaN;this.limitSign2=0;this.enableMotor1=!1;this.stepMotorTorque1=this.maxMotorTorque1=this.motorSpeed1=NaN;this.enableMotor2=!1;this.targetAngVelBin=this.targetAngVelTan=this.targetAngVelNor=this.targetVelZ=this.targetVelY=this.targetVelX=
this.invBinDenominator=this.invTanDenominator=this.binDenominator=this.tanDenominator=this.norDenominator=this.d22=this.d21=this.d20=this.d12=this.d11=this.d10=this.d02=this.d01=this.d00=this.invI2e22=this.invI2e21=this.invI2e20=this.invI2e12=this.invI2e11=this.invI2e10=this.invI2e02=this.invI2e01=this.invI2e00=this.invI1e22=this.invI1e21=this.invI1e20=this.invI1e12=this.invI1e11=this.invI1e10=this.invI1e02=this.invI1e01=this.invI1e00=this.zTorqueUnit2Z=this.zTorqueUnit2Y=this.zTorqueUnit2X=this.zTorqueUnit1Z=
this.zTorqueUnit1Y=this.zTorqueUnit1X=this.yTorqueUnit2Z=this.yTorqueUnit2Y=this.yTorqueUnit2X=this.yTorqueUnit1Z=this.yTorqueUnit1Y=this.yTorqueUnit1X=this.xTorqueUnit2Z=this.xTorqueUnit2Y=this.xTorqueUnit2X=this.xTorqueUnit1Z=this.xTorqueUnit1Y=this.xTorqueUnit1X=this.relPos2Z=this.relPos2Y=this.relPos2X=this.relPos1Z=this.relPos1Y=this.relPos1X=this.angle2=this.angle1=this.norZ=this.norY=this.norX=this.angAxis2Z=this.angAxis2Y=this.angAxis2X=this.angAxis1Z=this.angAxis1Y=this.angAxis1X=this.binZ=
this.binY=this.binX=this.tanZ=this.tanY=this.tanX=this.stepMotorTorque2=this.maxMotorTorque2=this.motorSpeed2=NaN;this.body1=c;this.body2=b;this.connection1.connected=b;this.connection2.connected=c;this.localAxis1=new OIMO.Vec3;this.localAxis2=new OIMO.Vec3;this.localAxis1.normalize(a.localAxis1);this.localAxis2.normalize(a.localAxis2);this.localAxis1X=this.localAxis1.x;this.localAxis1Y=this.localAxis1.y;this.localAxis1Z=this.localAxis1.z;this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*
this.localAxis1Z;this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X;this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y;c=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z);this.localAngAxis1X*=c;this.localAngAxis1Y*=c;this.localAngAxis1Z*=c;this.localAxis2X=this.localAxis2.x;this.localAxis2Y=this.localAxis2.y;this.localAxis2Z=this.localAxis2.z;
this.localAngAxis2X=this.localAxis2Y*this.localAxis2X-this.localAxis2Z*this.localAxis2Z;this.localAngAxis2Y=-this.localAxis2Z*this.localAxis2Y-this.localAxis2X*this.localAxis2X;this.localAngAxis2Z=this.localAxis2X*this.localAxis2Z+this.localAxis2Y*this.localAxis2Y;c=1/Math.sqrt(this.localAngAxis2X*this.localAngAxis2X+this.localAngAxis2Y*this.localAngAxis2Y+this.localAngAxis2Z*this.localAngAxis2Z);this.localAngAxis2X*=c;this.localAngAxis2Y*=c;this.localAngAxis2Z*=c;this.allowCollision=a.allowCollision;
this.localRelativeAnchorPosition1.copy(a.localRelativeAnchorPosition1);this.localRelativeAnchorPosition2.copy(a.localRelativeAnchorPosition2);this.type=this.JOINT_HINGE2;this.lVel1=this.body1.linearVelocity;this.lVel2=this.body2.linearVelocity;this.aVel1=this.body1.angularVelocity;this.aVel2=this.body2.angularVelocity;this.invM1=this.body1.invertMass;this.invM2=this.body2.invertMass;this.impulse=new OIMO.Vec3;this.torque=new OIMO.Vec3;this.torqueNor=this.torqueZ=this.torqueY=this.torqueX=this.motorTorque2=
this.limitTorque2=this.motorTorque1=this.limitTorque1=this.impulseZ=this.impulseY=this.impulseX=0};OIMO.Hinge2Joint.prototype=Object.create(OIMO.Joint.prototype);
OIMO.Hinge2Joint.prototype.preSolve=function(a,c){var b,d,e,f,g,k,h,m,l,p,x,q,t,v,r;b=this.body1.rotation.elements;this.tanX=this.localAxis1X*b[0]+this.localAxis1Y*b[1]+this.localAxis1Z*b[2];this.tanY=this.localAxis1X*b[3]+this.localAxis1Y*b[4]+this.localAxis1Z*b[5];this.tanZ=this.localAxis1X*b[6]+this.localAxis1Y*b[7]+this.localAxis1Z*b[8];this.angAxis1X=this.localAngAxis1X*b[0]+this.localAngAxis1Y*b[1]+this.localAngAxis1Z*b[2];this.angAxis1Y=this.localAngAxis1X*b[3]+this.localAngAxis1Y*b[4]+this.localAngAxis1Z*
b[5];this.angAxis1Z=this.localAngAxis1X*b[6]+this.localAngAxis1Y*b[7]+this.localAngAxis1Z*b[8];d=this.localRelativeAnchorPosition1.x;e=this.localRelativeAnchorPosition1.y;f=this.localRelativeAnchorPosition1.z;this.relPos1X=this.relativeAnchorPosition1.x=d*b[0]+e*b[1]+f*b[2];this.relPos1Y=this.relativeAnchorPosition1.y=d*b[3]+e*b[4]+f*b[5];this.relPos1Z=this.relativeAnchorPosition1.z=d*b[6]+e*b[7]+f*b[8];b=this.body2.rotation.elements;this.binX=this.localAxis2X*b[0]+this.localAxis2Y*b[1]+this.localAxis2Z*
b[2];this.binY=this.localAxis2X*b[3]+this.localAxis2Y*b[4]+this.localAxis2Z*b[5];this.binZ=this.localAxis2X*b[6]+this.localAxis2Y*b[7]+this.localAxis2Z*b[8];this.angAxis2X=this.localAngAxis2X*b[0]+this.localAngAxis2Y*b[1]+this.localAngAxis2Z*b[2];this.angAxis2Y=this.localAngAxis2X*b[3]+this.localAngAxis2Y*b[4]+this.localAngAxis2Z*b[5];this.angAxis2Z=this.localAngAxis2X*b[6]+this.localAngAxis2Y*b[7]+this.localAngAxis2Z*b[8];d=this.localRelativeAnchorPosition2.x;e=this.localRelativeAnchorPosition2.y;
f=this.localRelativeAnchorPosition2.z;this.relPos2X=this.relativeAnchorPosition2.x=d*b[0]+e*b[1]+f*b[2];this.relPos2Y=this.relativeAnchorPosition2.y=d*b[3]+e*b[4]+f*b[5];this.relPos2Z=this.relativeAnchorPosition2.z=d*b[6]+e*b[7]+f*b[8];this.anchorPosition1.x=this.relPos1X+this.body1.position.x;this.anchorPosition1.y=this.relPos1Y+this.body1.position.y;this.anchorPosition1.z=this.relPos1Z+this.body1.position.z;this.anchorPosition2.x=this.relPos2X+this.body2.position.x;this.anchorPosition2.y=this.relPos2Y+
this.body2.position.y;this.anchorPosition2.z=this.relPos2Z+this.body2.position.z;this.norX=this.binY*this.tanZ-this.binZ*this.tanY;this.norY=this.binZ*this.tanX-this.binX*this.tanZ;this.norZ=this.binX*this.tanY-this.binY*this.tanX;d=Math.sqrt(this.norX*this.norX+this.norY*this.norY+this.norZ*this.norZ);0<d&&(d=1/d);this.norX*=d;this.norY*=d;this.norZ*=d;this.angle1=0>this.tanX*(this.angAxis1Y*this.binZ-this.angAxis1Z*this.binY)+this.tanY*(this.angAxis1Z*this.binX-this.angAxis1X*this.binZ)+this.tanZ*
(this.angAxis1X*this.binY-this.angAxis1Y*this.binX)?-Math.acos(this.angAxis1X*this.binX+this.angAxis1Y*this.binY+this.angAxis1Z*this.binZ):Math.acos(this.angAxis1X*this.binX+this.angAxis1Y*this.binY+this.angAxis1Z*this.binZ);this.angle2=0>this.binX*(this.angAxis2Y*this.tanZ-this.angAxis2Z*this.tanY)+this.binY*(this.angAxis2Z*this.tanX-this.angAxis2X*this.tanZ)+this.binZ*(this.angAxis2X*this.tanY-this.angAxis2Y*this.tanX)?Math.acos(this.angAxis2X*this.tanX+this.angAxis2Y*this.tanY+this.angAxis2Z*this.tanZ):
-Math.acos(this.angAxis2X*this.tanX+this.angAxis2Y*this.tanY+this.angAxis2Z*this.tanZ);b=this.body1.invertInertia.elements;this.invI1e00=b[0];this.invI1e01=b[1];this.invI1e02=b[2];this.invI1e10=b[3];this.invI1e11=b[4];this.invI1e12=b[5];this.invI1e20=b[6];this.invI1e21=b[7];this.invI1e22=b[8];b=this.body2.invertInertia.elements;this.invI2e00=b[0];this.invI2e01=b[1];this.invI2e02=b[2];this.invI2e10=b[3];this.invI2e11=b[4];this.invI2e12=b[5];this.invI2e20=b[6];this.invI2e21=b[7];this.invI2e22=b[8];
this.xTorqueUnit1X=this.relPos1Z*this.invI1e01-this.relPos1Y*this.invI1e02;this.xTorqueUnit1Y=this.relPos1Z*this.invI1e11-this.relPos1Y*this.invI1e12;this.xTorqueUnit1Z=this.relPos1Z*this.invI1e21-this.relPos1Y*this.invI1e22;this.xTorqueUnit2X=this.relPos2Z*this.invI2e01-this.relPos2Y*this.invI2e02;this.xTorqueUnit2Y=this.relPos2Z*this.invI2e11-this.relPos2Y*this.invI2e12;this.xTorqueUnit2Z=this.relPos2Z*this.invI2e21-this.relPos2Y*this.invI2e22;this.yTorqueUnit1X=-this.relPos1Z*this.invI1e00+this.relPos1X*
this.invI1e02;this.yTorqueUnit1Y=-this.relPos1Z*this.invI1e10+this.relPos1X*this.invI1e12;this.yTorqueUnit1Z=-this.relPos1Z*this.invI1e20+this.relPos1X*this.invI1e22;this.yTorqueUnit2X=-this.relPos2Z*this.invI2e00+this.relPos2X*this.invI2e02;this.yTorqueUnit2Y=-this.relPos2Z*this.invI2e10+this.relPos2X*this.invI2e12;this.yTorqueUnit2Z=-this.relPos2Z*this.invI2e20+this.relPos2X*this.invI2e22;this.zTorqueUnit1X=this.relPos1Y*this.invI1e00-this.relPos1X*this.invI1e01;this.zTorqueUnit1Y=this.relPos1Y*
this.invI1e10-this.relPos1X*this.invI1e11;this.zTorqueUnit1Z=this.relPos1Y*this.invI1e20-this.relPos1X*this.invI1e21;this.zTorqueUnit2X=this.relPos2Y*this.invI2e00-this.relPos2X*this.invI2e01;this.zTorqueUnit2Y=this.relPos2Y*this.invI2e10-this.relPos2X*this.invI2e11;this.zTorqueUnit2Z=this.relPos2Y*this.invI2e20-this.relPos2X*this.invI2e21;this.d00=this.invM1+this.invM2;this.d10=this.d02=this.d01=0;this.d11=this.d00;this.d21=this.d20=this.d12=0;this.d22=this.d00;b=-this.relPos1Z;e=this.relPos1Y;f=
this.relPos1Z;h=-this.relPos1X;m=-this.relPos1Y;l=this.relPos1X;d=this.invI1e01*f+this.invI1e02*m;g=this.invI1e00*b+this.invI1e02*l;k=this.invI1e00*e+this.invI1e01*h;p=this.invI1e11*f+this.invI1e12*m;x=this.invI1e10*b+this.invI1e12*l;q=this.invI1e10*e+this.invI1e11*h;t=this.invI1e21*f+this.invI1e22*m;v=this.invI1e20*b+this.invI1e22*l;r=this.invI1e20*e+this.invI1e21*h;this.d00-=b*p+e*t;this.d01-=b*x+e*v;this.d02-=b*q+e*r;this.d10-=f*d+h*t;this.d11-=f*g+h*v;this.d12-=f*k+h*r;this.d20-=m*d+l*p;this.d21-=
m*g+l*x;this.d22-=m*k+l*q;b=-this.relPos2Z;e=this.relPos2Y;f=this.relPos2Z;h=-this.relPos2X;m=-this.relPos2Y;l=this.relPos2X;d=this.invI2e01*f+this.invI2e02*m;g=this.invI2e00*b+this.invI2e02*l;k=this.invI2e00*e+this.invI2e01*h;p=this.invI2e11*f+this.invI2e12*m;x=this.invI2e10*b+this.invI2e12*l;q=this.invI2e10*e+this.invI2e11*h;t=this.invI2e21*f+this.invI2e22*m;v=this.invI2e20*b+this.invI2e22*l;r=this.invI2e20*e+this.invI2e21*h;this.d00-=b*p+e*t;this.d01-=b*x+e*v;this.d02-=b*q+e*r;this.d10-=f*d+h*
t;this.d11-=f*g+h*v;this.d12-=f*k+h*r;this.d20-=m*d+l*p;this.d21-=m*g+l*x;this.d22-=m*k+l*q;d=1/(this.d00*(this.d11*this.d22-this.d21*this.d12)+this.d10*(this.d21*this.d02-this.d01*this.d22)+this.d20*(this.d01*this.d12-this.d11*this.d02));g=(this.d11*this.d22-this.d12*this.d21)*d;b=(this.d02*this.d21-this.d01*this.d22)*d;e=(this.d01*this.d12-this.d02*this.d11)*d;f=(this.d12*this.d20-this.d10*this.d22)*d;k=(this.d00*this.d22-this.d02*this.d20)*d;h=(this.d02*this.d10-this.d00*this.d12)*d;m=(this.d10*
this.d21-this.d11*this.d20)*d;l=(this.d01*this.d20-this.d00*this.d21)*d;d*=this.d00*this.d11-this.d01*this.d10;this.d00=g;this.d01=b;this.d02=e;this.d10=f;this.d11=k;this.d12=h;this.d20=m;this.d21=l;this.d22=d;g=this.invI1e00+this.invI2e00;b=this.invI1e01+this.invI2e01;e=this.invI1e02+this.invI2e02;f=this.invI1e10+this.invI2e10;k=this.invI1e11+this.invI2e11;h=this.invI1e12+this.invI2e12;m=this.invI1e20+this.invI2e20;l=this.invI1e21+this.invI2e21;d=this.invI1e22+this.invI2e22;this.norDenominator=1/
(this.norX*(this.norX*g+this.norY*b+this.norZ*e)+this.norY*(this.norX*f+this.norY*k+this.norZ*h)+this.norZ*(this.norX*m+this.norY*l+this.norZ*d));this.invTanDenominator=this.tanX*(this.tanX*g+this.tanY*b+this.tanZ*e)+this.tanY*(this.tanX*f+this.tanY*k+this.tanZ*h)+this.tanZ*(this.tanX*m+this.tanY*l+this.tanZ*d);this.tanDenominator=1/this.invTanDenominator;this.invBinDenominator=this.binX*(this.binX*g+this.binY*b+this.binZ*e)+this.binY*(this.binX*f+this.binY*k+this.binZ*h)+this.binZ*(this.binX*m+this.binY*
l+this.binZ*d);this.binDenominator=1/this.invBinDenominator;this.enableLimits1?this.angle1<this.lowerLimit1?(-1!=this.limitSign1&&(this.limitTorque1=0),this.limitSign1=-1):this.angle1>this.upperLimit1?(1!=this.limitSign1&&(this.limitTorque1=0),this.limitSign1=1):this.limitTorque1=this.limitSign1=0:this.limitTorque1=this.limitSign1=0;this.enableLimits2?this.angle2<this.lowerLimit2?(-1!=this.limitSign2&&(this.limitTorque2=0),this.limitSign2=-1):this.angle2>this.upperLimit2?(1!=this.limitSign2&&(this.limitTorque2=
0),this.limitSign2=1):this.limitTorque2=this.limitSign2=0:this.limitTorque2=this.limitSign2=0;this.enableMotor1&&(this.stepMotorTorque1=a*this.maxMotorTorque1);this.enableMotor2&&(this.stepMotorTorque2=a*this.maxMotorTorque2);this.torqueNor*=0.95;this.motorTorque1*=0.95;this.limitTorque1*=0.95;this.motorTorque2*=0.95;this.limitTorque2*=0.95;d=this.motorTorque1+this.limitTorque1;e=this.motorTorque2+this.limitTorque2;this.torqueX=this.torqueNor*this.norX+d*this.tanX+e*this.binX;this.torqueY=this.torqueNor*
this.norY+d*this.tanY+e*this.binY;this.torqueZ=this.torqueNor*this.norZ+d*this.tanZ+e*this.binZ;this.lVel1.x+=this.impulseX*this.invM1;this.lVel1.y+=this.impulseY*this.invM1;this.lVel1.z+=this.impulseZ*this.invM1;this.aVel1.x+=this.xTorqueUnit1X*this.impulseX+this.yTorqueUnit1X*this.impulseY+this.zTorqueUnit1X*this.impulseZ+this.torqueX*this.invI1e00+this.torqueY*this.invI1e01+this.torqueZ*this.invI1e02;this.aVel1.y+=this.xTorqueUnit1Y*this.impulseX+this.yTorqueUnit1Y*this.impulseY+this.zTorqueUnit1Y*
this.impulseZ+this.torqueX*this.invI1e10+this.torqueY*this.invI1e11+this.torqueZ*this.invI1e12;this.aVel1.z+=this.xTorqueUnit1Z*this.impulseX+this.yTorqueUnit1Z*this.impulseY+this.zTorqueUnit1Z*this.impulseZ+this.torqueX*this.invI1e20+this.torqueY*this.invI1e21+this.torqueZ*this.invI1e22;this.lVel2.x-=this.impulseX*this.invM2;this.lVel2.y-=this.impulseY*this.invM2;this.lVel2.z-=this.impulseZ*this.invM2;this.aVel2.x-=this.xTorqueUnit2X*this.impulseX+this.yTorqueUnit2X*this.impulseY+this.zTorqueUnit2X*
this.impulseZ+this.torqueX*this.invI2e00+this.torqueY*this.invI2e01+this.torqueZ*this.invI2e02;this.aVel2.y-=this.xTorqueUnit2Y*this.impulseX+this.yTorqueUnit2Y*this.impulseY+this.zTorqueUnit2Y*this.impulseZ+this.torqueX*this.invI2e10+this.torqueY*this.invI2e11+this.torqueZ*this.invI2e12;this.aVel2.z-=this.xTorqueUnit2Z*this.impulseX+this.yTorqueUnit2Z*this.impulseY+this.zTorqueUnit2Z*this.impulseZ+this.torqueX*this.invI2e20+this.torqueY*this.invI2e21+this.torqueZ*this.invI2e22;this.targetVelX=this.anchorPosition2.x-
this.anchorPosition1.x;this.targetVelY=this.anchorPosition2.y-this.anchorPosition1.y;this.targetVelZ=this.anchorPosition2.z-this.anchorPosition1.z;d=Math.sqrt(this.targetVelX*this.targetVelX+this.targetVelY*this.targetVelY+this.targetVelZ*this.targetVelZ);0.005>d?this.targetVelZ=this.targetVelY=this.targetVelX=0:(d=(0.005-d)/d*c*0.05,this.targetVelX*=d,this.targetVelY*=d,this.targetVelZ*=d);this.targetAngVelNor=-(this.tanX*this.binX+this.tanY*this.binY+this.tanZ*this.binZ);this.targetAngVelNor=0.02<
this.targetAngVelNor?(this.targetAngVelNor-0.02)*c*0.05:-0.02>this.targetAngVelNor?(this.targetAngVelNor+0.02)*c*0.05:0;-1==this.limitSign1?(this.targetAngVelTan=this.lowerLimit1-this.angle1,this.targetAngVelTan=0.02>this.targetAngVelTan?0:(this.targetAngVelTan-0.02)*c*0.05):1==this.limitSign1?(this.targetAngVelTan=this.upperLimit1-this.angle1,this.targetAngVelTan=-0.02<this.targetAngVelTan?0:(this.targetAngVelTan+0.02)*c*0.05):this.targetAngVelTan=0;-1==this.limitSign2?(this.targetAngVelBin=this.lowerLimit2-
this.angle2,this.targetAngVelBin=0.02>this.targetAngVelBin?0:(this.targetAngVelBin-0.02)*c*0.05):1==this.limitSign2?(this.targetAngVelBin=this.upperLimit2-this.angle2,this.targetAngVelBin=-0.02<this.targetAngVelBin?0:(this.targetAngVelBin+0.02)*c*0.05):this.targetAngVelBin=0};
OIMO.Hinge2Joint.prototype.solve=function(){var a,c,b,d,e,f,g,k;a=this.lVel2.x-this.lVel1.x+this.aVel2.y*this.relPos2Z-this.aVel2.z*this.relPos2Y-this.aVel1.y*this.relPos1Z+this.aVel1.z*this.relPos1Y-this.targetVelX;c=this.lVel2.y-this.lVel1.y+this.aVel2.z*this.relPos2X-this.aVel2.x*this.relPos2Z-this.aVel1.z*this.relPos1X+this.aVel1.x*this.relPos1Z-this.targetVelY;b=this.lVel2.z-this.lVel1.z+this.aVel2.x*this.relPos2Y-this.aVel2.y*this.relPos2X-this.aVel1.x*this.relPos1Y+this.aVel1.y*this.relPos1X-
this.targetVelZ;e=a*this.d00+c*this.d01+b*this.d02;f=a*this.d10+c*this.d11+b*this.d12;a=a*this.d20+c*this.d21+b*this.d22;this.impulseX+=e;this.impulseY+=f;this.impulseZ+=a;this.lVel1.x+=e*this.invM1;this.lVel1.y+=f*this.invM1;this.lVel1.z+=a*this.invM1;this.aVel1.x+=this.xTorqueUnit1X*e+this.yTorqueUnit1X*f+this.zTorqueUnit1X*a;this.aVel1.y+=this.xTorqueUnit1Y*e+this.yTorqueUnit1Y*f+this.zTorqueUnit1Y*a;this.aVel1.z+=this.xTorqueUnit1Z*e+this.yTorqueUnit1Z*f+this.zTorqueUnit1Z*a;this.lVel2.x-=e*this.invM2;
this.lVel2.y-=f*this.invM2;this.lVel2.z-=a*this.invM2;this.aVel2.x-=this.xTorqueUnit2X*e+this.yTorqueUnit2X*f+this.zTorqueUnit2X*a;this.aVel2.y-=this.xTorqueUnit2Y*e+this.yTorqueUnit2Y*f+this.zTorqueUnit2Y*a;this.aVel2.z-=this.xTorqueUnit2Z*e+this.yTorqueUnit2Z*f+this.zTorqueUnit2Z*a;a=this.aVel2.x-this.aVel1.x;c=this.aVel2.y-this.aVel1.y;b=this.aVel2.z-this.aVel1.z;d=a*this.tanX+c*this.tanY+b*this.tanZ;this.enableMotor1?(e=(d-this.motorSpeed1)*this.tanDenominator,f=this.motorTorque1,this.motorTorque1+=
e,this.motorTorque1>this.stepMotorTorque1?this.motorTorque1=this.stepMotorTorque1:this.motorTorque1<-this.stepMotorTorque1&&(this.motorTorque1=-this.stepMotorTorque1),e=this.motorTorque1-f,d-=e*this.invTanDenominator):e=0;0!=this.limitSign1?(f=(d-this.targetAngVelTan)*this.tanDenominator,g=this.limitTorque1,this.limitTorque1+=f,0>this.limitTorque1*this.limitSign1&&(this.limitTorque1=0),f=this.limitTorque1-g):f=0;d=a*this.binX+c*this.binY+b*this.binZ;this.enableMotor2?(g=(d-this.motorSpeed2)*this.binDenominator,
k=this.motorTorque2,this.motorTorque2+=g,this.motorTorque2>this.stepMotorTorque2?this.motorTorque2=this.stepMotorTorque2:this.motorTorque2<-this.stepMotorTorque2&&(this.motorTorque2=-this.stepMotorTorque2),g=this.motorTorque2-k,d-=g*this.invBinDenominator):g=0;0!=this.limitSign2?(d=(d-this.targetAngVelBin)*this.binDenominator,k=this.limitTorque2,this.limitTorque2+=d,0>this.limitTorque2*this.limitSign2&&(this.limitTorque2=0),d=this.limitTorque2-k):d=0;a=(a*this.norX+c*this.norY+b*this.norZ-this.targetAngVelNor)*
this.norDenominator;c=e+f;b=g+d;this.torqueNor+=a;e=a*this.norX+c*this.tanX+b*this.binX;f=a*this.norY+c*this.tanY+b*this.binY;a=a*this.norZ+c*this.tanZ+b*this.binZ;this.aVel1.x+=this.invI1e00*e+this.invI1e01*f+this.invI1e02*a;this.aVel1.y+=this.invI1e10*e+this.invI1e11*f+this.invI1e12*a;this.aVel1.z+=this.invI1e20*e+this.invI1e21*f+this.invI1e22*a;this.aVel2.x-=this.invI2e00*e+this.invI2e01*f+this.invI2e02*a;this.aVel2.y-=this.invI2e10*e+this.invI2e11*f+this.invI2e12*a;this.aVel2.z-=this.invI2e20*
e+this.invI2e21*f+this.invI2e22*a};OIMO.Hinge2Joint.prototype.postSolve=function(){this.impulse.x=this.impulseX;this.impulse.y=this.impulseY;this.impulse.z=this.impulseZ;this.torque.x=this.torqueX;this.torque.y=this.torqueY;this.torque.z=this.torqueZ};OIMO.Contact=function(a){OIMO.Constraint.call(this);this.binormalDenominator=this.tangentDenominator=this.normalDenominator=this.overlap=NaN;this.shape2=this.shape1=null;this.warmStarted=!1;this.aVel2=this.aVel1=this.lVel2=this.lVel1=null;this.restitution=this.friction=this.targetSeparateVelocity=this.targetNormalVelocity=this.invI2e22=this.invI2e21=this.invI2e20=this.invI2e12=this.invI2e11=this.invI2e10=this.invI2e02=this.invI2e01=this.invI2e00=this.invI1e22=this.invI1e21=this.invI1e20=this.invI1e12=
this.invI1e11=this.invI1e10=this.invI1e02=this.invI1e01=this.invI1e00=this.invM2=this.invM1=this.binTorqueUnit2Z=this.binTorqueUnit2Y=this.binTorqueUnit2X=this.binTorqueUnit1Z=this.binTorqueUnit1Y=this.binTorqueUnit1X=this.tanTorqueUnit2Z=this.tanTorqueUnit2Y=this.tanTorqueUnit2X=this.tanTorqueUnit1Z=this.tanTorqueUnit1Y=this.tanTorqueUnit1X=this.norTorqueUnit2Z=this.norTorqueUnit2Y=this.norTorqueUnit2X=this.norTorqueUnit1Z=this.norTorqueUnit1Y=this.norTorqueUnit1X=this.binTorque2Z=this.binTorque2Y=
this.binTorque2X=this.binTorque1Z=this.binTorque1Y=this.binTorque1X=this.tanTorque2Z=this.tanTorque2Y=this.tanTorque2X=this.tanTorque1Z=this.tanTorque1Y=this.tanTorque1X=this.norTorque2Z=this.norTorque2Y=this.norTorque2X=this.norTorque1Z=this.norTorque1Y=this.norTorque1X=this.binZ=this.binY=this.binX=this.tanZ=this.tanY=this.tanX=this.norZ=this.norY=this.norX=this.relVelZ=this.relVelY=this.relVelX=this.relPos2Z=this.relPos2Y=this.relPos2X=this.relPos1Z=this.relPos1Y=this.relPos1X=NaN;this.position=
new OIMO.Vec3;this.relativePosition1=new OIMO.Vec3;this.relativePosition2=new OIMO.Vec3;this.normal=new OIMO.Vec3;this.tangent=new OIMO.Vec3;this.binormal=new OIMO.Vec3;this.shapeConnection1=new OIMO.ContactConnection(this);this.shapeConnection2=new OIMO.ContactConnection(this);this.bodyConnection1=new OIMO.ContactConnection(this);this.bodyConnection2=new OIMO.ContactConnection(this);this.id=new OIMO.ContactID;this.binormalImpulse=this.tangentImpulse=this.normalImpulse=0};OIMO.Contact.prototype=Object.create(OIMO.Constraint.prototype);
OIMO.Contact.prototype.setupFromContactInfo=function(a){this.position.x=a.position.x;this.position.y=a.position.y;this.position.z=a.position.z;this.norX=a.normal.x;this.norY=a.normal.y;this.norZ=a.normal.z;this.overlap=a.overlap;this.shape1=a.shape1;this.shape2=a.shape2;this.body1=this.shape1.parent;this.body2=this.shape2.parent;this.bodyConnection1.connectedBody=this.body2;this.bodyConnection1.connectedShape=this.shape2;this.shapeConnection1.connectedBody=this.body2;this.shapeConnection1.connectedShape=
this.shape2;this.bodyConnection2.connectedBody=this.body1;this.bodyConnection2.connectedShape=this.shape1;this.shapeConnection2.connectedBody=this.body1;this.shapeConnection2.connectedShape=this.shape1;this.relPos1X=this.position.x-this.body1.position.x;this.relPos1Y=this.position.y-this.body1.position.y;this.relPos1Z=this.position.z-this.body1.position.z;this.relPos2X=this.position.x-this.body2.position.x;this.relPos2Y=this.position.y-this.body2.position.y;this.relPos2Z=this.position.z-this.body2.position.z;
this.lVel1=this.body1.linearVelocity;this.lVel2=this.body2.linearVelocity;this.aVel1=this.body1.angularVelocity;this.aVel2=this.body2.angularVelocity;this.invM1=this.body1.invertMass;this.invM2=this.body2.invertMass;var c;c=this.body1.invertInertia.elements;this.invI1e00=c[0];this.invI1e01=c[1];this.invI1e02=c[2];this.invI1e10=c[3];this.invI1e11=c[4];this.invI1e12=c[5];this.invI1e20=c[6];this.invI1e21=c[7];this.invI1e22=c[8];c=this.body2.invertInertia.elements;this.invI2e00=c[0];this.invI2e01=c[1];
this.invI2e02=c[2];this.invI2e10=c[3];this.invI2e11=c[4];this.invI2e12=c[5];this.invI2e20=c[6];this.invI2e21=c[7];this.invI2e22=c[8];this.id.data1=a.id.data1;this.id.data2=a.id.data2;this.id.flip=a.id.flip;this.friction=this.shape1.friction*this.shape2.friction;this.restitution=this.shape1.restitution*this.shape2.restitution;this.overlap=a.overlap;this.binormalImpulse=this.tangentImpulse=this.normalImpulse=0;this.warmStarted=!1};
OIMO.Contact.prototype.removeReferences=function(){this.body2=this.body1=this.shape2=this.shape1=null;this.bodyConnection1.connectedBody=null;this.bodyConnection1.connectedShape=null;this.shapeConnection1.connectedBody=null;this.shapeConnection1.connectedShape=null;this.bodyConnection2.connectedBody=null;this.bodyConnection2.connectedShape=null;this.shapeConnection2.connectedBody=null;this.shapeConnection2.connectedShape=null};
OIMO.Contact.prototype.preSolve=function(a,c){this.relVelX=this.lVel2.x+this.aVel2.y*this.relPos2Z-this.aVel2.z*this.relPos2Y-(this.lVel1.x+this.aVel1.y*this.relPos1Z-this.aVel1.z*this.relPos1Y);this.relVelY=this.lVel2.y+this.aVel2.z*this.relPos2X-this.aVel2.x*this.relPos2Z-(this.lVel1.y+this.aVel1.z*this.relPos1X-this.aVel1.x*this.relPos1Z);this.relVelZ=this.lVel2.z+this.aVel2.x*this.relPos2Y-this.aVel2.y*this.relPos2X-(this.lVel1.z+this.aVel1.x*this.relPos1Y-this.aVel1.y*this.relPos1X);var b=this.norX*
this.relVelX+this.norY*this.relVelY+this.norZ*this.relVelZ;this.tanX=this.relVelX-b*this.norX;this.tanY=this.relVelY-b*this.norY;this.tanZ=this.relVelZ-b*this.norZ;var d=this.tanX*this.tanX+this.tanY*this.tanY+this.tanZ*this.tanZ;0.01<d?d=1/Math.sqrt(d):(this.tanX=this.norY*this.norX-this.norZ*this.norZ,this.tanY=-this.norZ*this.norY-this.norX*this.norX,this.tanZ=this.norX*this.norZ+this.norY*this.norY,d=1/Math.sqrt(this.tanX*this.tanX+this.tanY*this.tanY+this.tanZ*this.tanZ));this.tanX*=d;this.tanY*=
d;this.tanZ*=d;this.binX=this.norY*this.tanZ-this.norZ*this.tanY;this.binY=this.norZ*this.tanX-this.norX*this.tanZ;this.binZ=this.norX*this.tanY-this.norY*this.tanX;this.norTorque1X=this.relPos1Y*this.norZ-this.relPos1Z*this.norY;this.norTorque1Y=this.relPos1Z*this.norX-this.relPos1X*this.norZ;this.norTorque1Z=this.relPos1X*this.norY-this.relPos1Y*this.norX;this.norTorque2X=this.relPos2Y*this.norZ-this.relPos2Z*this.norY;this.norTorque2Y=this.relPos2Z*this.norX-this.relPos2X*this.norZ;this.norTorque2Z=
this.relPos2X*this.norY-this.relPos2Y*this.norX;this.tanTorque1X=this.relPos1Y*this.tanZ-this.relPos1Z*this.tanY;this.tanTorque1Y=this.relPos1Z*this.tanX-this.relPos1X*this.tanZ;this.tanTorque1Z=this.relPos1X*this.tanY-this.relPos1Y*this.tanX;this.tanTorque2X=this.relPos2Y*this.tanZ-this.relPos2Z*this.tanY;this.tanTorque2Y=this.relPos2Z*this.tanX-this.relPos2X*this.tanZ;this.tanTorque2Z=this.relPos2X*this.tanY-this.relPos2Y*this.tanX;this.binTorque1X=this.relPos1Y*this.binZ-this.relPos1Z*this.binY;
this.binTorque1Y=this.relPos1Z*this.binX-this.relPos1X*this.binZ;this.binTorque1Z=this.relPos1X*this.binY-this.relPos1Y*this.binX;this.binTorque2X=this.relPos2Y*this.binZ-this.relPos2Z*this.binY;this.binTorque2Y=this.relPos2Z*this.binX-this.relPos2X*this.binZ;this.binTorque2Z=this.relPos2X*this.binY-this.relPos2Y*this.binX;this.norTorqueUnit1X=this.norTorque1X*this.invI1e00+this.norTorque1Y*this.invI1e01+this.norTorque1Z*this.invI1e02;this.norTorqueUnit1Y=this.norTorque1X*this.invI1e10+this.norTorque1Y*
this.invI1e11+this.norTorque1Z*this.invI1e12;this.norTorqueUnit1Z=this.norTorque1X*this.invI1e20+this.norTorque1Y*this.invI1e21+this.norTorque1Z*this.invI1e22;this.norTorqueUnit2X=this.norTorque2X*this.invI2e00+this.norTorque2Y*this.invI2e01+this.norTorque2Z*this.invI2e02;this.norTorqueUnit2Y=this.norTorque2X*this.invI2e10+this.norTorque2Y*this.invI2e11+this.norTorque2Z*this.invI2e12;this.norTorqueUnit2Z=this.norTorque2X*this.invI2e20+this.norTorque2Y*this.invI2e21+this.norTorque2Z*this.invI2e22;
this.tanTorqueUnit1X=this.tanTorque1X*this.invI1e00+this.tanTorque1Y*this.invI1e01+this.tanTorque1Z*this.invI1e02;this.tanTorqueUnit1Y=this.tanTorque1X*this.invI1e10+this.tanTorque1Y*this.invI1e11+this.tanTorque1Z*this.invI1e12;this.tanTorqueUnit1Z=this.tanTorque1X*this.invI1e20+this.tanTorque1Y*this.invI1e21+this.tanTorque1Z*this.invI1e22;this.tanTorqueUnit2X=this.tanTorque2X*this.invI2e00+this.tanTorque2Y*this.invI2e01+this.tanTorque2Z*this.invI2e02;this.tanTorqueUnit2Y=this.tanTorque2X*this.invI2e10+
this.tanTorque2Y*this.invI2e11+this.tanTorque2Z*this.invI2e12;this.tanTorqueUnit2Z=this.tanTorque2X*this.invI2e20+this.tanTorque2Y*this.invI2e21+this.tanTorque2Z*this.invI2e22;this.binTorqueUnit1X=this.binTorque1X*this.invI1e00+this.binTorque1Y*this.invI1e01+this.binTorque1Z*this.invI1e02;this.binTorqueUnit1Y=this.binTorque1X*this.invI1e10+this.binTorque1Y*this.invI1e11+this.binTorque1Z*this.invI1e12;this.binTorqueUnit1Z=this.binTorque1X*this.invI1e20+this.binTorque1Y*this.invI1e21+this.binTorque1Z*
this.invI1e22;this.binTorqueUnit2X=this.binTorque2X*this.invI2e00+this.binTorque2Y*this.invI2e01+this.binTorque2Z*this.invI2e02;this.binTorqueUnit2Y=this.binTorque2X*this.invI2e10+this.binTorque2Y*this.invI2e11+this.binTorque2Z*this.invI2e12;this.binTorqueUnit2Z=this.binTorque2X*this.invI2e20+this.binTorque2Y*this.invI2e21+this.binTorque2Z*this.invI2e22;var e,f,g,k,h,d=this.norTorque1X*this.invI1e00+this.norTorque1Y*this.invI1e01+this.norTorque1Z*this.invI1e02;e=this.norTorque1X*this.invI1e10+this.norTorque1Y*
this.invI1e11+this.norTorque1Z*this.invI1e12;f=this.norTorque1X*this.invI1e20+this.norTorque1Y*this.invI1e21+this.norTorque1Z*this.invI1e22;g=e*this.relPos1Z-f*this.relPos1Y;k=f*this.relPos1X-d*this.relPos1Z;h=d*this.relPos1Y-e*this.relPos1X;d=this.norTorque2X*this.invI2e00+this.norTorque2Y*this.invI2e01+this.norTorque2Z*this.invI2e02;e=this.norTorque2X*this.invI2e10+this.norTorque2Y*this.invI2e11+this.norTorque2Z*this.invI2e12;f=this.norTorque2X*this.invI2e20+this.norTorque2Y*this.invI2e21+this.norTorque2Z*
this.invI2e22;g+=e*this.relPos2Z-f*this.relPos2Y;k+=f*this.relPos2X-d*this.relPos2Z;h+=d*this.relPos2Y-e*this.relPos2X;this.normalDenominator=1/(this.invM1+this.invM2+this.norX*g+this.norY*k+this.norZ*h);d=this.tanTorque1X*this.invI1e00+this.tanTorque1Y*this.invI1e01+this.tanTorque1Z*this.invI1e02;e=this.tanTorque1X*this.invI1e10+this.tanTorque1Y*this.invI1e11+this.tanTorque1Z*this.invI1e12;f=this.tanTorque1X*this.invI1e20+this.tanTorque1Y*this.invI1e21+this.tanTorque1Z*this.invI1e22;g=e*this.relPos1Z-
f*this.relPos1Y;k=f*this.relPos1X-d*this.relPos1Z;h=d*this.relPos1Y-e*this.relPos1X;d=this.tanTorque2X*this.invI2e00+this.tanTorque2Y*this.invI2e01+this.tanTorque2Z*this.invI2e02;e=this.tanTorque2X*this.invI2e10+this.tanTorque2Y*this.invI2e11+this.tanTorque2Z*this.invI2e12;f=this.tanTorque2X*this.invI2e20+this.tanTorque2Y*this.invI2e21+this.tanTorque2Z*this.invI2e22;g+=e*this.relPos2Z-f*this.relPos2Y;k+=f*this.relPos2X-d*this.relPos2Z;h+=d*this.relPos2Y-e*this.relPos2X;this.tangentDenominator=1/(this.invM1+
this.invM2+this.tanX*g+this.tanY*k+this.tanZ*h);d=this.binTorque1X*this.invI1e00+this.binTorque1Y*this.invI1e01+this.binTorque1Z*this.invI1e02;e=this.binTorque1X*this.invI1e10+this.binTorque1Y*this.invI1e11+this.binTorque1Z*this.invI1e12;f=this.binTorque1X*this.invI1e20+this.binTorque1Y*this.invI1e21+this.binTorque1Z*this.invI1e22;g=e*this.relPos1Z-f*this.relPos1Y;k=f*this.relPos1X-d*this.relPos1Z;h=d*this.relPos1Y-e*this.relPos1X;d=this.binTorque2X*this.invI2e00+this.binTorque2Y*this.invI2e01+this.binTorque2Z*
this.invI2e02;e=this.binTorque2X*this.invI2e10+this.binTorque2Y*this.invI2e11+this.binTorque2Z*this.invI2e12;f=this.binTorque2X*this.invI2e20+this.binTorque2Y*this.invI2e21+this.binTorque2Z*this.invI2e22;g+=e*this.relPos2Z-f*this.relPos2Y;k+=f*this.relPos2X-d*this.relPos2Z;h+=d*this.relPos2Y-e*this.relPos2X;this.binormalDenominator=1/(this.invM1+this.invM2+this.binX*g+this.binY*k+this.binZ*h);this.warmStarted&&(this.tangentImpulse*=0.95,this.binormalImpulse*=0.95,d=this.norX*this.normalImpulse+this.tanX*
this.tangentImpulse+this.binX*this.binormalImpulse,e=this.norY*this.normalImpulse+this.tanY*this.tangentImpulse+this.binY*this.binormalImpulse,f=this.norZ*this.normalImpulse+this.tanZ*this.tangentImpulse+this.binZ*this.binormalImpulse,this.lVel1.x+=d*this.invM1,this.lVel1.y+=e*this.invM1,this.lVel1.z+=f*this.invM1,this.aVel1.x+=this.norTorqueUnit1X*this.normalImpulse+this.tanTorqueUnit1X*this.tangentImpulse+this.binTorqueUnit1X*this.binormalImpulse,this.aVel1.y+=this.norTorqueUnit1Y*this.normalImpulse+
this.tanTorqueUnit1Y*this.tangentImpulse+this.binTorqueUnit1Y*this.binormalImpulse,this.aVel1.z+=this.norTorqueUnit1Z*this.normalImpulse+this.tanTorqueUnit1Z*this.tangentImpulse+this.binTorqueUnit1Z*this.binormalImpulse,this.lVel2.x-=d*this.invM2,this.lVel2.y-=e*this.invM2,this.lVel2.z-=f*this.invM2,this.aVel2.x-=this.norTorqueUnit2X*this.normalImpulse+this.tanTorqueUnit2X*this.tangentImpulse+this.binTorqueUnit2X*this.binormalImpulse,this.aVel2.y-=this.norTorqueUnit2Y*this.normalImpulse+this.tanTorqueUnit2Y*
this.tangentImpulse+this.binTorqueUnit2Y*this.binormalImpulse,this.aVel2.z-=this.norTorqueUnit2Z*this.normalImpulse+this.tanTorqueUnit2Z*this.tangentImpulse+this.binTorqueUnit2Z*this.binormalImpulse,b=0);-1<b&&(b=0);this.targetNormalVelocity=this.restitution*-b;b=-this.overlap-0.005;0<b&&(b=0.05*b*c,this.targetNormalVelocity<b&&(this.targetNormalVelocity=b))};
OIMO.Contact.prototype.solve=function(){var a,c,b,d,e;c=(this.lVel2.x-this.lVel1.x)*this.norX+(this.lVel2.y-this.lVel1.y)*this.norY+(this.lVel2.z-this.lVel1.z)*this.norZ+this.aVel2.x*this.norTorque2X+this.aVel2.y*this.norTorque2Y+this.aVel2.z*this.norTorque2Z-this.aVel1.x*this.norTorque1X-this.aVel1.y*this.norTorque1Y-this.aVel1.z*this.norTorque1Z;a=this.normalImpulse;c=(c-this.targetNormalVelocity)*this.normalDenominator*1.4;this.normalImpulse+=c;0<this.normalImpulse&&(this.normalImpulse=0);c=this.normalImpulse-
a;a=this.norX*c;b=this.norY*c;e=this.norZ*c;this.lVel1.x+=a*this.invM1;this.lVel1.y+=b*this.invM1;this.lVel1.z+=e*this.invM1;this.aVel1.x+=this.norTorqueUnit1X*c;this.aVel1.y+=this.norTorqueUnit1Y*c;this.aVel1.z+=this.norTorqueUnit1Z*c;this.lVel2.x-=a*this.invM2;this.lVel2.y-=b*this.invM2;this.lVel2.z-=e*this.invM2;this.aVel2.x-=this.norTorqueUnit2X*c;this.aVel2.y-=this.norTorqueUnit2Y*c;this.aVel2.z-=this.norTorqueUnit2Z*c;e=-this.normalImpulse*this.friction;this.relVelX=this.lVel2.x-this.lVel1.x;
this.relVelY=this.lVel2.y-this.lVel1.y;this.relVelZ=this.lVel2.z-this.lVel1.z;c=this.relVelX*this.tanX+this.relVelY*this.tanY+this.relVelZ*this.tanZ+this.aVel2.x*this.tanTorque2X+this.aVel2.y*this.tanTorque2Y+this.aVel2.z*this.tanTorque2Z-this.aVel1.x*this.tanTorque1X-this.aVel1.y*this.tanTorque1Y-this.aVel1.z*this.tanTorque1Z;a=this.tangentImpulse;c*=this.tangentDenominator;this.tangentImpulse+=c;c=this.relVelX*this.binX+this.relVelY*this.binY+this.relVelZ*this.binZ+this.aVel2.x*this.binTorque2X+
this.aVel2.y*this.binTorque2Y+this.aVel2.z*this.binTorque2Z-this.aVel1.x*this.binTorque1X-this.aVel1.y*this.binTorque1Y-this.aVel1.z*this.binTorque1Z;b=this.binormalImpulse;d=c*this.binormalDenominator;this.binormalImpulse+=d;c=this.tangentImpulse*this.tangentImpulse+this.binormalImpulse*this.binormalImpulse;c>e*e&&(c=e/Math.sqrt(c),this.tangentImpulse*=c,this.binormalImpulse*=c);c=this.tangentImpulse-a;d=this.binormalImpulse-b;a=this.tanX*c+this.binX*d;b=this.tanY*c+this.binY*d;e=this.tanZ*c+this.binZ*
d;this.lVel1.x+=a*this.invM1;this.lVel1.y+=b*this.invM1;this.lVel1.z+=e*this.invM1;this.aVel1.x+=this.tanTorqueUnit1X*c+this.binTorqueUnit1X*d;this.aVel1.y+=this.tanTorqueUnit1Y*c+this.binTorqueUnit1Y*d;this.aVel1.z+=this.tanTorqueUnit1Z*c+this.binTorqueUnit1Z*d;this.lVel2.x-=a*this.invM2;this.lVel2.y-=b*this.invM2;this.lVel2.z-=e*this.invM2;this.aVel2.x-=this.tanTorqueUnit2X*c+this.binTorqueUnit2X*d;this.aVel2.y-=this.tanTorqueUnit2Y*c+this.binTorqueUnit2Y*d;this.aVel2.z-=this.tanTorqueUnit2Z*c+
this.binTorqueUnit2Z*d};
OIMO.Contact.prototype.postSolve=function(){this.relativePosition1.x=this.relPos1X;this.relativePosition1.y=this.relPos1Y;this.relativePosition1.z=this.relPos1Z;this.relativePosition2.x=this.relPos2X;this.relativePosition2.y=this.relPos2Y;this.relativePosition2.z=this.relPos2Z;this.normal.x=this.norX;this.normal.y=this.norY;this.normal.z=this.norZ;this.tangent.x=this.tanX;this.tangent.y=this.tanY;this.tangent.z=this.tanZ;this.binormal.x=this.binX;this.binormal.y=this.binY;this.binormal.z=this.binZ};OIMO.ContactConnection=function(a){this.connectedBody=this.connectedShape=this.next=this.prev=null;this.parent=a};OIMO.Shape=function(){this.type=0;this.restitution=this.friction=this.mass=NaN;this.contactList=this.parent=null;this.numContacts=0;this.id=OIMO.nextID++;this.position=new OIMO.Vec3;this.relativePosition=new OIMO.Vec3;this.localRelativePosition=new OIMO.Vec3;this.rotation=new OIMO.Mat33;this.relativeRotation=new OIMO.Mat33;this.localInertia=new OIMO.Mat33;this.proxy=new OIMO.Proxy;this.proxy.parent=this};
OIMO.Shape.prototype={constructor:OIMO.Shape,updateProxy:function(){throw Error("Inheritance error.");}};OIMO.ShapeConfig=function(){this.position=new OIMO.Vec3;this.rotation=new OIMO.Mat33;this.restitution=this.friction=0.5;this.density=1};OIMO.BoxShape=function(a,c,b,d){OIMO.Shape.call(this);this.width=c;this.halfWidth=0.5*c;this.height=b;this.halfHeight=0.5*b;this.depth=d;this.halfDepth=0.5*d;this.position.copy(a.position);this.rotation.copy(a.rotation);this.friction=a.friction;this.restitution=a.restitution;this.mass=c*b*d*a.density;a=this.mass/12;this.localInertia.init(a*(b*b+d*d),0,0,0,a*(c*c+d*d),0,0,0,a*(c*c+b*b));this.normalDirectionWidth=new OIMO.Vec3;this.normalDirectionHeight=new OIMO.Vec3;this.normalDirectionDepth=new OIMO.Vec3;
this.halfDirectionWidth=new OIMO.Vec3;this.halfDirectionHeight=new OIMO.Vec3;this.halfDirectionDepth=new OIMO.Vec3;this.vertex1=new OIMO.Vec3;this.vertex2=new OIMO.Vec3;this.vertex3=new OIMO.Vec3;this.vertex4=new OIMO.Vec3;this.vertex5=new OIMO.Vec3;this.vertex6=new OIMO.Vec3;this.vertex7=new OIMO.Vec3;this.vertex8=new OIMO.Vec3;this.type=OIMO.SHAPE_BOX};OIMO.BoxShape.prototype=Object.create(OIMO.Shape.prototype);
OIMO.BoxShape.prototype.updateProxy=function(){var a=this.rotation.elements;this.normalDirectionWidth.x=a[0];this.normalDirectionWidth.y=a[3];this.normalDirectionWidth.z=a[6];this.normalDirectionHeight.x=a[1];this.normalDirectionHeight.y=a[4];this.normalDirectionHeight.z=a[7];this.normalDirectionDepth.x=a[2];this.normalDirectionDepth.y=a[5];this.normalDirectionDepth.z=a[8];this.halfDirectionWidth.x=a[0]*this.halfWidth;this.halfDirectionWidth.y=a[3]*this.halfWidth;this.halfDirectionWidth.z=a[6]*this.halfWidth;
this.halfDirectionHeight.x=a[1]*this.halfHeight;this.halfDirectionHeight.y=a[4]*this.halfHeight;this.halfDirectionHeight.z=a[7]*this.halfHeight;this.halfDirectionDepth.x=a[2]*this.halfDepth;this.halfDirectionDepth.y=a[5]*this.halfDepth;this.halfDirectionDepth.z=a[8]*this.halfDepth;var a=this.halfDirectionWidth.x,c=this.halfDirectionWidth.y,b=this.halfDirectionWidth.z,d=this.halfDirectionHeight.x,e=this.halfDirectionHeight.y,f=this.halfDirectionHeight.z,g=this.halfDirectionDepth.x,k=this.halfDirectionDepth.y,
h=this.halfDirectionDepth.z,m=this.position.x,l=this.position.y,p=this.position.z;this.vertex1.x=m+a+d+g;this.vertex1.y=l+c+e+k;this.vertex1.z=p+b+f+h;this.vertex2.x=m+a+d-g;this.vertex2.y=l+c+e-k;this.vertex2.z=p+b+f-h;this.vertex3.x=m+a-d+g;this.vertex3.y=l+c-e+k;this.vertex3.z=p+b-f+h;this.vertex4.x=m+a-d-g;this.vertex4.y=l+c-e-k;this.vertex4.z=p+b-f-h;this.vertex5.x=m-a+d+g;this.vertex5.y=l-c+e+k;this.vertex5.z=p-b+f+h;this.vertex6.x=m-a+d-g;this.vertex6.y=l-c+e-k;this.vertex6.z=p-b+f-h;this.vertex7.x=
m-a-d+g;this.vertex7.y=l-c-e+k;this.vertex7.z=p-b-f+h;this.vertex8.x=m-a-d-g;this.vertex8.y=l-c-e-k;this.vertex8.z=p-b-f-h;a=0>this.halfDirectionWidth.x?-this.halfDirectionWidth.x:this.halfDirectionWidth.x;c=0>this.halfDirectionWidth.y?-this.halfDirectionWidth.y:this.halfDirectionWidth.y;b=0>this.halfDirectionWidth.z?-this.halfDirectionWidth.z:this.halfDirectionWidth.z;a=0>this.halfDirectionHeight.x?a-this.halfDirectionHeight.x:a+this.halfDirectionHeight.x;c=0>this.halfDirectionHeight.y?c-this.halfDirectionHeight.y:
c+this.halfDirectionHeight.y;b=0>this.halfDirectionHeight.z?b-this.halfDirectionHeight.z:b+this.halfDirectionHeight.z;a=0>this.halfDirectionDepth.x?a-this.halfDirectionDepth.x:a+this.halfDirectionDepth.x;c=0>this.halfDirectionDepth.y?c-this.halfDirectionDepth.y:c+this.halfDirectionDepth.y;b=0>this.halfDirectionDepth.z?b-this.halfDirectionDepth.z:b+this.halfDirectionDepth.z;this.proxy.init(this.position.x-a,this.position.x+a,this.position.y-c,this.position.y+c,this.position.z-b,this.position.z+b)};OIMO.CylinderShape=function(a,c,b){OIMO.Shape.call(this);this.radius=c;this.height=b;this.halfHeight=0.5*b;this.position.copy(a.position);this.rotation.copy(a.rotation);this.friction=a.friction;this.restitution=a.restitution;this.mass=Math.PI*c*c*b*a.density;a=(0.25*c*c+1/12*b*b)*this.mass;this.localInertia.init(a,0,0,0,0.5*c*c,0,0,0,a);this.normalDirection=new OIMO.Vec3;this.halfDirection=new OIMO.Vec3;this.type=OIMO.SHAPE_CYLINDER};OIMO.CylinderShape.prototype=Object.create(OIMO.Shape.prototype);
OIMO.CylinderShape.prototype.updateProxy=function(){var a=this.rotation.elements,c,b,d;b=a[1];d=a[4];var a=a[7],e=b*b,f=d*d,g=a*a;this.normalDirection.x=b;this.normalDirection.y=d;this.normalDirection.z=a;this.halfDirection.x=b*this.halfHeight;this.halfDirection.y=d*this.halfHeight;this.halfDirection.z=a*this.halfHeight;b=1-b*b;c=Math.sqrt(b*b+e*f+e*g);0<c&&(c=this.radius/c);b*=c;d=1-d*d;c=Math.sqrt(f*e+d*d+f*g);0<c&&(c=this.radius/c);d*=c;a=1-a*a;c=Math.sqrt(g*e+g*f+a*a);0<c&&(c=this.radius/c);a*=
c;e=0>this.halfDirection.x?-this.halfDirection.x:this.halfDirection.x;f=0>this.halfDirection.y?-this.halfDirection.y:this.halfDirection.y;g=0>this.halfDirection.z?-this.halfDirection.z:this.halfDirection.z;e=0>b?e-b:e+b;f=0>d?f-d:f+d;g=0>a?g-a:g+a;this.proxy.init(this.position.x-e,this.position.x+e,this.position.y-f,this.position.y+f,this.position.z-g,this.position.z+g)};OIMO.SphereShape=function(a,c){OIMO.Shape.call(this);this.radius=c;this.position.copy(a.position);this.rotation.copy(a.rotation);this.friction=a.friction;this.restitution=a.restitution;this.mass=4/3*Math.PI*c*c*c*a.density;var b=0.4*c*c*this.mass;this.localInertia.init(b,0,0,0,b,0,0,0,b);this.type=OIMO.SHAPE_SPHERE};OIMO.SphereShape.prototype=Object.create(OIMO.Shape.prototype);
OIMO.SphereShape.prototype.updateProxy=function(){this.proxy.init(this.position.x-this.radius,this.position.x+this.radius,this.position.y-this.radius,this.position.y+this.radius,this.position.z-this.radius,this.position.z+this.radius)};OIMO.ContactID=function(){this.data2=this.data1=0;this.flip=!1};OIMO.ContactID.prototype={constructor:OIMO.ContactID,equals:function(a){return this.flip==a.flip?this.data1==a.data1&&this.data2==a.data2:this.data2==a.data1&&this.data1==a.data2}};OIMO.ContactInfo=function(){this.overlap=NaN;this.shape2=this.shape1=null;this.position=new OIMO.Vec3;this.normal=new OIMO.Vec3;this.id=new OIMO.ContactID};OIMO.CollisionDetector=function(){this.flip=!1};OIMO.CollisionDetector.prototype={constructor:OIMO.CollisionDetector,detectCollision:function(a,c,b){throw Error("detectCollision Function is not inherited");}};OIMO.CollisionResult=function(a){this.numContactInfos=0;this.maxContactInfos=a;this.contactInfos=[]};
OIMO.CollisionResult.prototype={constructor:OIMO.CollisionResult,addContactInfo:function(a,c,b,d,e,f,g,k,h,m,l,p){if(this.numContactInfos!=this.maxContactInfos){this.contactInfos[this.numContactInfos]||(this.contactInfos[this.numContactInfos]=new OIMO.ContactInfo);var x=this.contactInfos[this.numContactInfos++];x.position.x=a;x.position.y=c;x.position.z=b;x.normal.x=d;x.normal.y=e;x.normal.z=f;x.overlap=g;x.shape1=k;x.shape2=h;x.id.data1=m;x.id.data2=l;x.id.flip=p}}};OIMO.BoxBoxCollisionDetector=function(){OIMO.CollisionDetector.call(this);this.clipVertices1=[];this.clipVertices2=[];this.clipVertices1.length=24;this.clipVertices2.length=24;this.used=[];this.INF=1/0};OIMO.BoxBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.BoxBoxCollisionDetector.prototype.detectCollision=function(a,c,b){var d,e;a.id<c.id?(d=a,e=c):(d=c,e=a);var f=d.position,g=e.position,k=f.x,h=f.y,m=f.z,l=g.x,p=g.y,x=g.z,q=l-k,t=p-h,v=x-m,r=d.halfWidth,s=d.halfHeight,G=d.halfDepth,z=e.halfWidth,H=e.halfHeight,K=e.halfDepth,J=d.halfDirectionWidth.x,I=d.halfDirectionWidth.y,A=d.halfDirectionWidth.z,Q=d.halfDirectionHeight.x,B=d.halfDirectionHeight.y,L=d.halfDirectionHeight.z,T=d.halfDirectionDepth.x,U=d.halfDirectionDepth.y,V=d.halfDirectionDepth.z,
ba=e.halfDirectionWidth.x,da=e.halfDirectionWidth.y,ua=e.halfDirectionWidth.z,X=e.halfDirectionHeight.x,O=e.halfDirectionHeight.y,Y=e.halfDirectionHeight.z,Ja=e.halfDirectionDepth.x,Ka=e.halfDirectionDepth.y,La=e.halfDirectionDepth.z,pa=d.normalDirectionWidth.x,qa=d.normalDirectionWidth.y,ra=d.normalDirectionWidth.z,C=d.normalDirectionHeight.x,D=d.normalDirectionHeight.y,E=d.normalDirectionHeight.z,sa=d.normalDirectionDepth.x,ea=d.normalDirectionDepth.y,ta=d.normalDirectionDepth.z,ma=e.normalDirectionWidth.x,
Ba=e.normalDirectionWidth.y,Ca=e.normalDirectionWidth.z,Da=e.normalDirectionHeight.x,S=e.normalDirectionHeight.y,P=e.normalDirectionHeight.z,M=e.normalDirectionDepth.x,R=e.normalDirectionDepth.y,W=e.normalDirectionDepth.z,Na=qa*Ca-ra*Ba,na=ra*ma-pa*Ca,oa=pa*Ba-qa*ma,Fa=qa*P-ra*S,yb=ra*Da-pa*P,Wb=pa*S-qa*Da,Xb=qa*W-ra*R,Yb=ra*M-pa*W,Zb=pa*R-qa*M,$b=D*Ca-E*Ba,ac=E*ma-C*Ca,bc=C*Ba-D*ma,Ra=D*P-E*S,Sa=E*Da-C*P,Ta=C*S-D*Da,Ga=D*W-E*R,Za=E*M-C*W,db=C*R-D*M,ga=ea*Ca-ta*Ba,ha=ta*ma-sa*Ca,ia=sa*Ba-ea*ma,eb=
ea*P-ta*S,hb=ta*Da-sa*P,ib=sa*S-ea*Da,jb=ea*W-ta*R,zb=ta*M-sa*W,Ab=sa*R-ea*M,kc,lc,mc,nc,Pa,Qa,Oa,fa,kb,lb,mb,va,Aa,qb,wa,Eb,Fb,Gb,Bb,Cb,Db,fb,gb,Kb,Lb,Mb,Nb,Ob,Pb,cc,oc=!1,pc=!1,qc=!1,rc=!1,sc=!1,N=!1,Jc=!1,Kc=!1,Lc=!1,y,Ua,Va,u,w,Wa;y=pa*q+qa*t+ra*v;(kc=0<y)||(y=-y);Ua=r;u=pa*ma+qa*Ba+ra*Ca;w=pa*Da+qa*S+ra*P;Wa=pa*M+qa*R+ra*W;0>u&&(u=-u);0>w&&(w=-w);0>Wa&&(Wa=-Wa);Va=u*z+w*H+Wa*K;Eb=y-Ua-Va;if(!(0<Eb||(y=C*q+D*t+E*v,(lc=0<y)||(y=-y),Ua=s,u=C*ma+D*Ba+E*Ca,w=C*Da+D*S+E*P,Wa=C*M+D*R+E*W,0>u&&(u=-u),
0>w&&(w=-w),0>Wa&&(Wa=-Wa),Va=u*z+w*H+Wa*K,Fb=y-Ua-Va,0<Fb||(y=sa*q+ea*t+ta*v,(mc=0<y)||(y=-y),Ua=G,u=sa*ma+ea*Ba+ta*Ca,w=sa*Da+ea*S+ta*P,Wa=sa*M+ea*R+ta*W,0>u&&(u=-u),0>w&&(w=-w),0>Wa&&(Wa=-Wa),Va=u*z+w*H+Wa*K,Gb=y-Ua-Va,0<Gb||(y=ma*q+Ba*t+Ca*v,(nc=0<y)||(y=-y),u=ma*pa+Ba*qa+Ca*ra,w=ma*C+Ba*D+Ca*E,Wa=ma*sa+Ba*ea+Ca*ta,0>u&&(u=-u),0>w&&(w=-w),0>Wa&&(Wa=-Wa),Ua=u*r+w*s+Wa*G,Va=z,Bb=1*(y-Ua-Va),0<Bb||(y=Da*q+S*t+P*v,(Pa=0<y)||(y=-y),u=Da*pa+S*qa+P*ra,w=Da*C+S*D+P*E,Wa=Da*sa+S*ea+P*ta,0>u&&(u=-u),0>
w&&(w=-w),0>Wa&&(Wa=-Wa),Ua=u*r+w*s+Wa*G,Va=H,Cb=1*(y-Ua-Va),0<Cb||(y=M*q+R*t+W*v,(Qa=0<y)||(y=-y),u=M*pa+R*qa+W*ra,w=M*C+R*D+W*E,Wa=M*sa+R*ea+W*ta,0>u&&(u=-u),0>w&&(w=-w),0>Wa&&(Wa=-Wa),Ua=u*r+w*s+Wa*G,Va=K,Db=1*(y-Ua-Va),0<Db))))))){y=Na*Na+na*na+oa*oa;if(1E-5<y){if(y=1/Math.sqrt(y),Na*=y,na*=y,oa*=y,y=Na*q+na*t+oa*v,(Oa=0<y)||(y=-y),u=Na*C+na*D+oa*E,w=Na*sa+na*ea+oa*ta,0>u&&(u=-u),0>w&&(w=-w),Ua=u*s+w*G,u=Na*Da+na*S+oa*P,w=Na*M+na*R+oa*W,0>u&&(u=-u),0>w&&(w=-w),Va=u*H+w*K,fb=y-Ua-Va,0<fb)return}else Oa=
!1,fb=0,oc=!0;y=Fa*Fa+yb*yb+Wb*Wb;if(1E-5<y){if(y=1/Math.sqrt(y),Fa*=y,yb*=y,Wb*=y,y=Fa*q+yb*t+Wb*v,(fa=0<y)||(y=-y),u=Fa*C+yb*D+Wb*E,w=Fa*sa+yb*ea+Wb*ta,0>u&&(u=-u),0>w&&(w=-w),Ua=u*s+w*G,u=Fa*ma+yb*Ba+Wb*Ca,w=Fa*M+yb*R+Wb*W,0>u&&(u=-u),0>w&&(w=-w),Va=u*z+w*K,gb=y-Ua-Va,0<gb)return}else fa=!1,gb=0,pc=!0;y=Xb*Xb+Yb*Yb+Zb*Zb;if(1E-5<y){if(y=1/Math.sqrt(y),Xb*=y,Yb*=y,Zb*=y,y=Xb*q+Yb*t+Zb*v,(kb=0<y)||(y=-y),u=Xb*C+Yb*D+Zb*E,w=Xb*sa+Yb*ea+Zb*ta,0>u&&(u=-u),0>w&&(w=-w),Ua=u*s+w*G,u=Xb*ma+Yb*Ba+Zb*Ca,
w=Xb*Da+Yb*S+Zb*P,0>u&&(u=-u),0>w&&(w=-w),Va=u*z+w*H,Kb=y-Ua-Va,0<Kb)return}else kb=!1,Kb=0,qc=!0;y=$b*$b+ac*ac+bc*bc;if(1E-5<y){if(y=1/Math.sqrt(y),$b*=y,ac*=y,bc*=y,y=$b*q+ac*t+bc*v,(lb=0<y)||(y=-y),u=$b*pa+ac*qa+bc*ra,w=$b*sa+ac*ea+bc*ta,0>u&&(u=-u),0>w&&(w=-w),Ua=u*r+w*G,u=$b*Da+ac*S+bc*P,w=$b*M+ac*R+bc*W,0>u&&(u=-u),0>w&&(w=-w),Va=u*H+w*K,Lb=y-Ua-Va,0<Lb)return}else lb=!1,Lb=0,rc=!0;y=Ra*Ra+Sa*Sa+Ta*Ta;if(1E-5<y){if(y=1/Math.sqrt(y),Ra*=y,Sa*=y,Ta*=y,y=Ra*q+Sa*t+Ta*v,(mb=0<y)||(y=-y),u=Ra*pa+
Sa*qa+Ta*ra,w=Ra*sa+Sa*ea+Ta*ta,0>u&&(u=-u),0>w&&(w=-w),Ua=u*r+w*G,u=Ra*ma+Sa*Ba+Ta*Ca,w=Ra*M+Sa*R+Ta*W,0>u&&(u=-u),0>w&&(w=-w),Va=u*z+w*K,Mb=y-Ua-Va,0<Mb)return}else mb=!1,Mb=0,sc=!0;y=Ga*Ga+Za*Za+db*db;if(1E-5<y){if(y=1/Math.sqrt(y),Ga*=y,Za*=y,db*=y,y=Ga*q+Za*t+db*v,(va=0<y)||(y=-y),u=Ga*pa+Za*qa+db*ra,w=Ga*sa+Za*ea+db*ta,0>u&&(u=-u),0>w&&(w=-w),Ua=u*r+w*G,u=Ga*ma+Za*Ba+db*Ca,w=Ga*Da+Za*S+db*P,0>u&&(u=-u),0>w&&(w=-w),Va=u*z+w*H,Nb=y-Ua-Va,0<Nb)return}else va=!1,Nb=0,N=!0;y=ga*ga+ha*ha+ia*ia;if(1E-5<
y){if(y=1/Math.sqrt(y),ga*=y,ha*=y,ia*=y,y=ga*q+ha*t+ia*v,(Aa=0<y)||(y=-y),u=ga*pa+ha*qa+ia*ra,w=ga*C+ha*D+ia*E,0>u&&(u=-u),0>w&&(w=-w),Ua=u*r+w*s,u=ga*Da+ha*S+ia*P,w=ga*M+ha*R+ia*W,0>u&&(u=-u),0>w&&(w=-w),Va=u*H+w*K,Ob=y-Ua-Va,0<Ob)return}else Aa=!1,Ob=0,Jc=!0;y=eb*eb+hb*hb+ib*ib;if(1E-5<y){if(y=1/Math.sqrt(y),eb*=y,hb*=y,ib*=y,y=eb*q+hb*t+ib*v,(qb=0<y)||(y=-y),u=eb*pa+hb*qa+ib*ra,w=eb*C+hb*D+ib*E,0>u&&(u=-u),0>w&&(w=-w),Ua=u*r+w*s,u=eb*ma+hb*Ba+ib*Ca,w=eb*M+hb*R+ib*W,0>u&&(u=-u),0>w&&(w=-w),Va=
u*z+w*K,Pb=y-Ua-Va,0<Pb)return}else qb=!1,Pb=0,Kc=!0;y=jb*jb+zb*zb+Ab*Ab;if(1E-5<y){if(y=1/Math.sqrt(y),jb*=y,zb*=y,Ab*=y,y=jb*q+zb*t+Ab*v,(wa=0<y)||(y=-y),u=jb*pa+zb*qa+Ab*ra,w=jb*C+zb*D+Ab*E,0>u&&(u=-u),0>w&&(w=-w),Ua=u*r+w*s,u=jb*ma+zb*Ba+Ab*Ca,w=jb*Da+zb*S+Ab*P,0>u&&(u=-u),0>w&&(w=-w),Va=u*z+w*H,cc=y-Ua-Va,0<cc)return}else wa=!1,cc=0,Lc=!0;var Hb=Eb,cb=Eb,Jb=0,xb=kc;Fb>cb&&(cb=Hb=Fb,Jb=1,xb=lc);Gb>cb&&(cb=Hb=Gb,Jb=2,xb=mc);Bb-0.005>cb&&(Hb=Bb,cb=Bb-0.005,Jb=3,xb=nc);Cb-0.005>cb&&(Hb=Cb,cb=Cb-
0.005,Jb=4,xb=Pa);Db-0.005>cb&&(Hb=Db,cb=Db-0.005,Jb=5,xb=Qa);fb-0.01>cb&&!oc&&(Hb=fb,cb=fb-0.01,Jb=6,xb=Oa);gb-0.01>cb&&!pc&&(Hb=gb,cb=gb-0.01,Jb=7,xb=fa);Kb-0.01>cb&&!qc&&(Hb=Kb,cb=Kb-0.01,Jb=8,xb=kb);Lb-0.01>cb&&!rc&&(Hb=Lb,cb=Lb-0.01,Jb=9,xb=lb);Mb-0.01>cb&&!sc&&(Hb=Mb,cb=Mb-0.01,Jb=10,xb=mb);Nb-0.01>cb&&!N&&(Hb=Nb,cb=Nb-0.01,Jb=11,xb=va);Ob-0.01>cb&&!Jc&&(Hb=Ob,cb=Ob-0.01,Jb=12,xb=Aa);Pb-0.01>cb&&!Kc&&(Hb=Pb,cb=Pb-0.01,Jb=13,xb=qb);cc-0.01>cb&&!Lc&&(Hb=cc,Jb=14,xb=wa);var Z=0,$=0,aa=0,rb=0,sb=
0,tb=0,ub=0,vb=0,wb=0,nb=0,ob=0,pb=0,wc=0,xc=0,yc=0,zc=0,Ac=0,Bc=0,Fc=!1;switch(Jb){case 0:xb?(nb=k+J,ob=h+I,pb=m+A,Z=pa,$=qa,aa=ra):(nb=k-J,ob=h-I,pb=m-A,Z=-pa,$=-qa,aa=-ra);wc=Q;xc=B;yc=L;rb=-C;sb=-D;tb=-E;zc=T;Ac=U;Bc=V;ub=-sa;vb=-ea;wb=-ta;break;case 1:xb?(nb=k+Q,ob=h+B,pb=m+L,Z=C,$=D,aa=E):(nb=k-Q,ob=h-B,pb=m-L,Z=-C,$=-D,aa=-E);wc=J;xc=I;yc=A;rb=-pa;sb=-qa;tb=-ra;zc=T;Ac=U;Bc=V;ub=-sa;vb=-ea;wb=-ta;break;case 2:xb?(nb=k+T,ob=h+U,pb=m+V,Z=sa,$=ea,aa=ta):(nb=k-T,ob=h-U,pb=m-V,Z=-sa,$=-ea,aa=-ta);
wc=J;xc=I;yc=A;rb=-pa;sb=-qa;tb=-ra;zc=Q;Ac=B;Bc=L;ub=-C;vb=-D;wb=-E;break;case 3:Fc=!0;xb?(nb=l-ba,ob=p-da,pb=x-ua,Z=-ma,$=-Ba,aa=-Ca):(nb=l+ba,ob=p+da,pb=x+ua,Z=ma,$=Ba,aa=Ca);wc=X;xc=O;yc=Y;rb=-Da;sb=-S;tb=-P;zc=Ja;Ac=Ka;Bc=La;ub=-M;vb=-R;wb=-W;break;case 4:Fc=!0;xb?(nb=l-X,ob=p-O,pb=x-Y,Z=-Da,$=-S,aa=-P):(nb=l+X,ob=p+O,pb=x+Y,Z=Da,$=S,aa=P);wc=ba;xc=da;yc=ua;rb=-ma;sb=-Ba;tb=-Ca;zc=Ja;Ac=Ka;Bc=La;ub=-M;vb=-R;wb=-W;break;case 5:Fc=!0;xb?(nb=l-Ja,ob=p-Ka,pb=x-La,Z=-M,$=-R,aa=-W):(nb=l+Ja,ob=p+Ka,
pb=x+La,Z=M,$=R,aa=W);wc=ba;xc=da;yc=ua;rb=-ma;sb=-Ba;tb=-Ca;zc=X;Ac=O;Bc=Y;ub=-Da;vb=-S;wb=-P;break;case 6:Z=Na;$=na;aa=oa;rb=pa;sb=qa;tb=ra;ub=ma;vb=Ba;wb=Ca;break;case 7:Z=Fa;$=yb;aa=Wb;rb=pa;sb=qa;tb=ra;ub=Da;vb=S;wb=P;break;case 8:Z=Xb;$=Yb;aa=Zb;rb=pa;sb=qa;tb=ra;ub=M;vb=R;wb=W;break;case 9:Z=$b;$=ac;aa=bc;rb=C;sb=D;tb=E;ub=ma;vb=Ba;wb=Ca;break;case 10:Z=Ra;$=Sa;aa=Ta;rb=C;sb=D;tb=E;ub=Da;vb=S;wb=P;break;case 11:Z=Ga;$=Za;aa=db;rb=C;sb=D;tb=E;ub=M;vb=R;wb=W;break;case 12:Z=ga;$=ha;aa=ia;rb=
sa;sb=ea;tb=ta;ub=ma;vb=Ba;wb=Ca;break;case 13:Z=eb;$=hb;aa=ib;rb=sa;sb=ea;tb=ta;ub=Da;vb=S;wb=P;break;case 14:Z=jb,$=zb,aa=Ab,rb=sa,sb=ea,tb=ta,ub=M,vb=R,wb=W}var n;if(5<Jb){xb||(Z=-Z,$=-$,aa=-aa);var Ea,Xa,xa,ya,za,tc,uc,vc,Cc,Dc,Ec;n=d.vertex1;tc=n.x;uc=n.y;vc=n.z;Xa=Z*tc+$*uc+aa*vc;n=d.vertex2;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea>Xa&&(Xa=Ea,tc=xa,uc=ya,vc=za);n=d.vertex3;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea>Xa&&(Xa=Ea,tc=xa,uc=ya,vc=za);n=d.vertex4;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+
aa*za;Ea>Xa&&(Xa=Ea,tc=xa,uc=ya,vc=za);n=d.vertex5;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea>Xa&&(Xa=Ea,tc=xa,uc=ya,vc=za);n=d.vertex6;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea>Xa&&(Xa=Ea,tc=xa,uc=ya,vc=za);n=d.vertex7;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea>Xa&&(Xa=Ea,tc=xa,uc=ya,vc=za);n=d.vertex8;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea>Xa&&(Xa=Ea,tc=xa,uc=ya,vc=za);n=e.vertex1;Cc=n.x;Dc=n.y;Ec=n.z;Xa=Z*Cc+$*Dc+aa*Ec;n=e.vertex2;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea<Xa&&(Xa=Ea,Cc=xa,
Dc=ya,Ec=za);n=e.vertex3;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea<Xa&&(Xa=Ea,Cc=xa,Dc=ya,Ec=za);n=e.vertex4;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea<Xa&&(Xa=Ea,Cc=xa,Dc=ya,Ec=za);n=e.vertex5;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea<Xa&&(Xa=Ea,Cc=xa,Dc=ya,Ec=za);n=e.vertex6;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea<Xa&&(Xa=Ea,Cc=xa,Dc=ya,Ec=za);n=e.vertex7;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea<Xa&&(Xa=Ea,Cc=xa,Dc=ya,Ec=za);n=e.vertex8;xa=n.x;ya=n.y;za=n.z;Ea=Z*xa+$*ya+aa*za;Ea<Xa&&(Xa=
Ea,Cc=xa,Dc=ya,Ec=za);xa=Cc-tc;ya=Dc-uc;za=Ec-vc;u=rb*ub+sb*vb+tb*wb;var Ia=(xa*(rb-ub*u)+ya*(sb-vb*u)+za*(tb-wb*u))/(1-u*u);b.addContactInfo(tc+rb*Ia+Z*Hb*0.5,uc+sb*Ia+$*Hb*0.5,vc+tb*Ia+aa*Hb*0.5,Z,$,aa,Hb,d,e,0,0,!1)}else{var Qb,Rb,Sb,Tb,Ub,Vb,dc,ec,fc,gc,hc,ic,Ya=1,ca=0,jc=0;if(Fc)switch(ca=pa*Z+qa*$+ra*aa,ca<Ya&&(Ya=ca,jc=0),-ca<Ya&&(Ya=-ca,jc=1),ca=C*Z+D*$+E*aa,ca<Ya&&(Ya=ca,jc=2),-ca<Ya&&(Ya=-ca,jc=3),ca=sa*Z+ea*$+ta*aa,ca<Ya&&(Ya=ca,jc=4),-ca<Ya&&(Ya=-ca,jc=5),jc){case 0:n=d.vertex1;Qb=n.x;
Rb=n.y;Sb=n.z;n=d.vertex3;Tb=n.x;Ub=n.y;Vb=n.z;n=d.vertex4;dc=n.x;ec=n.y;fc=n.z;n=d.vertex2;gc=n.x;hc=n.y;ic=n.z;break;case 1:n=d.vertex6;Qb=n.x;Rb=n.y;Sb=n.z;n=d.vertex8;Tb=n.x;Ub=n.y;Vb=n.z;n=d.vertex7;dc=n.x;ec=n.y;fc=n.z;n=d.vertex5;gc=n.x;hc=n.y;ic=n.z;break;case 2:n=d.vertex5;Qb=n.x;Rb=n.y;Sb=n.z;n=d.vertex1;Tb=n.x;Ub=n.y;Vb=n.z;n=d.vertex2;dc=n.x;ec=n.y;fc=n.z;n=d.vertex6;gc=n.x;hc=n.y;ic=n.z;break;case 3:n=d.vertex8;Qb=n.x;Rb=n.y;Sb=n.z;n=d.vertex4;Tb=n.x;Ub=n.y;Vb=n.z;n=d.vertex3;dc=n.x;
ec=n.y;fc=n.z;n=d.vertex7;gc=n.x;hc=n.y;ic=n.z;break;case 4:n=d.vertex5;Qb=n.x;Rb=n.y;Sb=n.z;n=d.vertex7;Tb=n.x;Ub=n.y;Vb=n.z;n=d.vertex3;dc=n.x;ec=n.y;fc=n.z;n=d.vertex1;gc=n.x;hc=n.y;ic=n.z;break;case 5:n=d.vertex2,Qb=n.x,Rb=n.y,Sb=n.z,n=d.vertex4,Tb=n.x,Ub=n.y,Vb=n.z,n=d.vertex8,dc=n.x,ec=n.y,fc=n.z,n=d.vertex6,gc=n.x,hc=n.y,ic=n.z}else switch(ca=ma*Z+Ba*$+Ca*aa,ca<Ya&&(Ya=ca,jc=0),-ca<Ya&&(Ya=-ca,jc=1),ca=Da*Z+S*$+P*aa,ca<Ya&&(Ya=ca,jc=2),-ca<Ya&&(Ya=-ca,jc=3),ca=M*Z+R*$+W*aa,ca<Ya&&(Ya=ca,jc=
4),-ca<Ya&&(Ya=-ca,jc=5),jc){case 0:n=e.vertex1;Qb=n.x;Rb=n.y;Sb=n.z;n=e.vertex3;Tb=n.x;Ub=n.y;Vb=n.z;n=e.vertex4;dc=n.x;ec=n.y;fc=n.z;n=e.vertex2;gc=n.x;hc=n.y;ic=n.z;break;case 1:n=e.vertex6;Qb=n.x;Rb=n.y;Sb=n.z;n=e.vertex8;Tb=n.x;Ub=n.y;Vb=n.z;n=e.vertex7;dc=n.x;ec=n.y;fc=n.z;n=e.vertex5;gc=n.x;hc=n.y;ic=n.z;break;case 2:n=e.vertex5;Qb=n.x;Rb=n.y;Sb=n.z;n=e.vertex1;Tb=n.x;Ub=n.y;Vb=n.z;n=e.vertex2;dc=n.x;ec=n.y;fc=n.z;n=e.vertex6;gc=n.x;hc=n.y;ic=n.z;break;case 3:n=e.vertex8;Qb=n.x;Rb=n.y;Sb=n.z;
n=e.vertex4;Tb=n.x;Ub=n.y;Vb=n.z;n=e.vertex3;dc=n.x;ec=n.y;fc=n.z;n=e.vertex7;gc=n.x;hc=n.y;ic=n.z;break;case 4:n=e.vertex5;Qb=n.x;Rb=n.y;Sb=n.z;n=e.vertex7;Tb=n.x;Ub=n.y;Vb=n.z;n=e.vertex3;dc=n.x;ec=n.y;fc=n.z;n=e.vertex1;gc=n.x;hc=n.y;ic=n.z;break;case 5:n=e.vertex2,Qb=n.x,Rb=n.y,Sb=n.z,n=e.vertex4,Tb=n.x,Ub=n.y,Vb=n.z,n=e.vertex8,dc=n.x,ec=n.y,fc=n.z,n=e.vertex6,gc=n.x,hc=n.y,ic=n.z}var Ib,Ha,F,ja,ka,la,$a,ab,bb;this.clipVertices1[0]=Qb;this.clipVertices1[1]=Rb;this.clipVertices1[2]=Sb;this.clipVertices1[3]=
Tb;this.clipVertices1[4]=Ub;this.clipVertices1[5]=Vb;this.clipVertices1[6]=dc;this.clipVertices1[7]=ec;this.clipVertices1[8]=fc;this.clipVertices1[9]=gc;this.clipVertices1[10]=hc;this.clipVertices1[11]=ic;Ha=0;ja=this.clipVertices1[9];ka=this.clipVertices1[10];la=this.clipVertices1[11];u=(ja-nb-wc)*rb+(ka-ob-xc)*sb+(la-pb-yc)*tb;for(var Ma=0;4>Ma;Ma++)F=3*Ma,$a=this.clipVertices1[F],ab=this.clipVertices1[F+1],bb=this.clipVertices1[F+2],w=($a-nb-wc)*rb+(ab-ob-xc)*sb+(bb-pb-yc)*tb,0<u?0<w?(F=3*Ha,Ha++,
this.clipVertices2[F]=$a,this.clipVertices2[F+1]=ab,this.clipVertices2[F+2]=bb):(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices2[F]=ja+($a-ja)*Ia,this.clipVertices2[F+1]=ka+(ab-ka)*Ia,this.clipVertices2[F+2]=la+(bb-la)*Ia):0<w&&(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices2[F]=ja+($a-ja)*Ia,this.clipVertices2[F+1]=ka+(ab-ka)*Ia,this.clipVertices2[F+2]=la+(bb-la)*Ia,F=3*Ha,Ha++,this.clipVertices2[F]=$a,this.clipVertices2[F+1]=ab,this.clipVertices2[F+2]=bb),ja=$a,ka=ab,la=bb,u=w;Ib=Ha;if(0!=Ib){Ha=0;F=3*(Ib-
1);ja=this.clipVertices2[F];ka=this.clipVertices2[F+1];la=this.clipVertices2[F+2];u=(ja-nb-zc)*ub+(ka-ob-Ac)*vb+(la-pb-Bc)*wb;for(Ma=0;Ma<Ib;Ma++)F=3*Ma,$a=this.clipVertices2[F],ab=this.clipVertices2[F+1],bb=this.clipVertices2[F+2],w=($a-nb-zc)*ub+(ab-ob-Ac)*vb+(bb-pb-Bc)*wb,0<u?0<w?(F=3*Ha,Ha++,this.clipVertices1[F]=$a,this.clipVertices1[F+1]=ab,this.clipVertices1[F+2]=bb):(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices1[F]=ja+($a-ja)*Ia,this.clipVertices1[F+1]=ka+(ab-ka)*Ia,this.clipVertices1[F+2]=la+
(bb-la)*Ia):0<w&&(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices1[F]=ja+($a-ja)*Ia,this.clipVertices1[F+1]=ka+(ab-ka)*Ia,this.clipVertices1[F+2]=la+(bb-la)*Ia,F=3*Ha,Ha++,this.clipVertices1[F]=$a,this.clipVertices1[F+1]=ab,this.clipVertices1[F+2]=bb),ja=$a,ka=ab,la=bb,u=w;Ib=Ha;if(0!=Ib){Ha=0;F=3*(Ib-1);ja=this.clipVertices1[F];ka=this.clipVertices1[F+1];la=this.clipVertices1[F+2];u=(ja-nb+wc)*-rb+(ka-ob+xc)*-sb+(la-pb+yc)*-tb;for(Ma=0;Ma<Ib;Ma++)F=3*Ma,$a=this.clipVertices1[F],ab=this.clipVertices1[F+
1],bb=this.clipVertices1[F+2],w=($a-nb+wc)*-rb+(ab-ob+xc)*-sb+(bb-pb+yc)*-tb,0<u?0<w?(F=3*Ha,Ha++,this.clipVertices2[F]=$a,this.clipVertices2[F+1]=ab,this.clipVertices2[F+2]=bb):(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices2[F]=ja+($a-ja)*Ia,this.clipVertices2[F+1]=ka+(ab-ka)*Ia,this.clipVertices2[F+2]=la+(bb-la)*Ia):0<w&&(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices2[F]=ja+($a-ja)*Ia,this.clipVertices2[F+1]=ka+(ab-ka)*Ia,this.clipVertices2[F+2]=la+(bb-la)*Ia,F=3*Ha,Ha++,this.clipVertices2[F]=$a,this.clipVertices2[F+
1]=ab,this.clipVertices2[F+2]=bb),ja=$a,ka=ab,la=bb,u=w;Ib=Ha;if(0!=Ib){Ha=0;F=3*(Ib-1);ja=this.clipVertices2[F];ka=this.clipVertices2[F+1];la=this.clipVertices2[F+2];u=(ja-nb+zc)*-ub+(ka-ob+Ac)*-vb+(la-pb+Bc)*-wb;for(Ma=0;Ma<Ib;Ma++)F=3*Ma,$a=this.clipVertices2[F],ab=this.clipVertices2[F+1],bb=this.clipVertices2[F+2],w=($a-nb+zc)*-ub+(ab-ob+Ac)*-vb+(bb-pb+Bc)*-wb,0<u?0<w?(F=3*Ha,Ha++,this.clipVertices1[F]=$a,this.clipVertices1[F+1]=ab,this.clipVertices1[F+2]=bb):(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices1[F]=
ja+($a-ja)*Ia,this.clipVertices1[F+1]=ka+(ab-ka)*Ia,this.clipVertices1[F+2]=la+(bb-la)*Ia):0<w&&(F=3*Ha,Ha++,Ia=u/(u-w),this.clipVertices1[F]=ja+($a-ja)*Ia,this.clipVertices1[F+1]=ka+(ab-ka)*Ia,this.clipVertices1[F+2]=la+(bb-la)*Ia,F=3*Ha,Ha++,this.clipVertices1[F]=$a,this.clipVertices1[F+1]=ab,this.clipVertices1[F+2]=bb),ja=$a,ka=ab,la=bb,u=w;Ib=Ha;if(Fc){var Oc=d;d=e;e=Oc}if(0!=Ib)if(4<Ib){ja=0.25*(Qb+Tb+dc+gc);ka=0.25*(Rb+Ub+ec+hc);la=0.25*(Sb+Vb+fc+ic);for(var rb=Qb-ja,sb=Rb-ka,tb=Sb-la,ub=Tb-
ja,vb=Ub-ka,wb=Vb-la,Hc=0,Mc=0,Ic=0,Nc=0,Gc=-this.INF,Ya=this.INF,Ma=0;Ma<Ib;Ma++)this.used[Ma]=!1,F=3*Ma,ja=this.clipVertices1[F],ka=this.clipVertices1[F+1],la=this.clipVertices1[F+2],ca=ja*rb+ka*sb+la*tb,ca<Ya&&(Ya=ca,Hc=Ma),ca>Gc&&(Gc=ca,Ic=Ma);this.used[Hc]=!0;this.used[Ic]=!0;Gc=-this.INF;Ya=this.INF;for(Ma=0;Ma<Ib;Ma++)this.used[Ma]||(F=3*Ma,ja=this.clipVertices1[F],ka=this.clipVertices1[F+1],la=this.clipVertices1[F+2],ca=ja*ub+ka*vb+la*wb,ca<Ya&&(Ya=ca,Mc=Ma),ca>Gc&&(Gc=ca,Nc=Ma));F=3*Hc;ja=
this.clipVertices1[F];ka=this.clipVertices1[F+1];la=this.clipVertices1[F+2];ca=(ja-nb)*Z+(ka-ob)*$+(la-pb)*aa;0>ca&&b.addContactInfo(ja,ka,la,Z,$,aa,ca,d,e,0,0,!1);F=3*Mc;ja=this.clipVertices1[F];ka=this.clipVertices1[F+1];la=this.clipVertices1[F+2];ca=(ja-nb)*Z+(ka-ob)*$+(la-pb)*aa;0>ca&&b.addContactInfo(ja,ka,la,Z,$,aa,ca,d,e,1,0,!1);F=3*Ic;ja=this.clipVertices1[F];ka=this.clipVertices1[F+1];la=this.clipVertices1[F+2];ca=(ja-nb)*Z+(ka-ob)*$+(la-pb)*aa;0>ca&&b.addContactInfo(ja,ka,la,Z,$,aa,ca,d,
e,2,0,!1);F=3*Nc;ja=this.clipVertices1[F];ka=this.clipVertices1[F+1];la=this.clipVertices1[F+2];ca=(ja-nb)*Z+(ka-ob)*$+(la-pb)*aa;0>ca&&b.addContactInfo(ja,ka,la,Z,$,aa,ca,d,e,3,0,!1)}else for(Ma=0;Ma<Ib;Ma++)F=3*Ma,ja=this.clipVertices1[F],ka=this.clipVertices1[F+1],la=this.clipVertices1[F+2],ca=(ja-nb)*Z+(ka-ob)*$+(la-pb)*aa,0>ca&&b.addContactInfo(ja,ka,la,Z,$,aa,ca,d,e,Ma,0,!1)}}}}}};OIMO.BoxCylinderCollisionDetector=function(a){OIMO.CollisionDetector.call(this);this.flip=a};OIMO.BoxCylinderCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.BoxCylinderCollisionDetector.prototype.getSep=function(a,c,b,d,e){var f,g,k,h,m,l,p=new OIMO.Vec3,x,q,t,v,r,s,G=a.position.x,z=a.position.y,H=a.position.z,K=c.position.x,J=c.position.y,I=c.position.z,A=K-G,Q=J-z,B=I-H;0==A*A+Q*Q+B*B&&(Q=0.001);var L=-A;l=-Q;h=-B;this.supportPointB(a,-L,-l,-h,p);var T=p.x,U=p.y,V=p.z;this.supportPointC(c,L,l,h,p);var ba=p.x,da=p.y,ua=p.z,X=ba-T,O=da-U,Y=ua-V;if(0>=X*L+O*l+Y*h)return!1;L=O*B-Y*Q;l=Y*A-X*B;h=X*Q-O*A;if(0==L*L+l*l+h*h)return b.init(X-A,O-Q,Y-B),
b.normalize(b),d.init(0.5*(T+ba),0.5*(U+da),0.5*(V+ua)),!0;this.supportPointB(a,-L,-l,-h,p);var Ja=p.x,Ka=p.y,La=p.z;this.supportPointC(c,L,l,h,p);var pa=p.x,qa=p.y,ra=p.z,C=pa-Ja,D=qa-Ka,E=ra-La;if(0>=C*L+D*l+E*h)return!1;f=X-A;g=O-Q;k=Y-B;h=C-A;m=D-Q;l=E-B;L=g*l-k*m;l=k*h-f*l;h=f*m-g*h;0<L*A+l*Q+h*B&&(f=X,g=O,k=Y,X=C,O=D,Y=E,C=f,D=g,E=k,f=T,g=U,k=V,T=Ja,U=Ka,V=La,Ja=f,Ka=g,La=k,f=ba,g=da,k=ua,ba=pa,da=qa,ua=ra,pa=f,qa=g,ra=k,L=-L,l=-l,h=-h);for(var sa=0;;){if(100<++sa)return!1;this.supportPointB(a,
-L,-l,-h,p);var ea=p.x,ta=p.y,ma=p.z;this.supportPointC(c,L,l,h,p);var Ba=p.x,Ca=p.y,Da=p.z,S=Ba-ea,P=Ca-ta,M=Da-ma;if(0>=S*L+P*l+M*h)return!1;if(0>(O*M-Y*P)*A+(Y*S-X*M)*Q+(X*P-O*S)*B)C=S,D=P,E=M,Ja=ea,Ka=ta,La=ma,pa=Ba,qa=Ca,ra=Da,f=X-A,g=O-Q,k=Y-B,h=S-A,m=P-Q,l=M-B,L=g*l-k*m,l=k*h-f*l,h=f*m-g*h;else if(0>(P*E-M*D)*A+(M*C-S*E)*Q+(S*D-P*C)*B)X=S,O=P,Y=M,T=ea,U=ta,V=ma,ba=Ba,da=Ca,ua=Da,f=S-A,g=P-Q,k=M-B,h=C-A,m=D-Q,l=E-B,L=g*l-k*m,l=k*h-f*l,h=f*m-g*h;else for(var R=!1;;){f=C-X;g=D-O;k=E-Y;h=S-X;m=
P-O;l=M-Y;L=g*l-k*m;l=k*h-f*l;h=f*m-g*h;f=1/Math.sqrt(L*L+l*l+h*h);L*=f;l*=f;h*=f;0<=L*X+l*O+h*Y&&!R&&(s=(O*E-Y*D)*S+(Y*C-X*E)*P+(X*D-O*C)*M,R=(P*E-M*D)*A+(M*C-S*E)*Q+(S*D-P*C)*B,f=(Q*Y-B*O)*S+(B*X-A*Y)*P+(A*O-Q*X)*M,g=(D*Y-E*O)*A+(E*X-C*Y)*Q+(C*O-D*X)*B,x=s+R+f+g,0>=x&&(s=0,R=(D*M-E*P)*L+(E*S-C*M)*l+(C*P-D*S)*h,f=(P*E-M*D)*L+(M*C-S*E)*l+(S*D-P*C)*h,g=(O*E-Y*D)*L+(Y*C-X*E)*l+(X*D-O*C)*h,x=R+f+g),k=1/x,x=(G*s+T*R+Ja*f+ea*g)*k,q=(z*s+U*R+Ka*f+ta*g)*k,t=(H*s+V*R+La*f+ma*g)*k,v=(K*s+ba*R+pa*f+Ba*g)*k,
r=(J*s+da*R+qa*f+Ca*g)*k,s=(I*s+ua*R+ra*f+Da*g)*k,R=!0);this.supportPointB(a,-L,-l,-h,p);f=p.x;g=p.y;k=p.z;this.supportPointC(c,L,l,h,p);m=p.x;var W=p.y,Na=p.z,na=m-f,oa=W-g,Fa=Na-k,yb=-(na*L+oa*l+Fa*h);if(0.01>=(na-S)*L+(oa-P)*l+(Fa-M)*h||0<=yb)return R?(b.init(-L,-l,-h),d.init(0.5*(x+v),0.5*(q+r),0.5*(t+s)),e.x=yb,!0):!1;0>(oa*Y-Fa*O)*A+(Fa*X-na*Y)*Q+(na*O-oa*X)*B?0>(oa*E-Fa*D)*A+(Fa*C-na*E)*Q+(na*D-oa*C)*B?(X=na,O=oa,Y=Fa,T=f,U=g,V=k,ba=m,da=W,ua=Na):(S=na,P=oa,M=Fa,ea=f,ta=g,ma=k,Ba=m,Ca=W,Da=
Na):0>(oa*M-Fa*P)*A+(Fa*S-na*M)*Q+(na*P-oa*S)*B?(C=na,D=oa,E=Fa,Ja=f,Ka=g,La=k,pa=m,qa=W,ra=Na):(X=na,O=oa,Y=Fa,T=f,U=g,V=k,ba=m,da=W,ua=Na)}}};
OIMO.BoxCylinderCollisionDetector.prototype.supportPointB=function(a,c,b,d,e){var f=a.rotation.elements,g=f[0]*c+f[3]*b+f[6]*d,k=f[1]*c+f[4]*b+f[7]*d;c=f[2]*c+f[5]*b+f[8]*d;d=a.halfWidth;var h=a.halfHeight;b=a.halfDepth;d=0>g?-d:d;h=0>k?-h:h;c=0>c?-b:b;g=f[0]*d+f[1]*h+f[2]*c+a.position.x;k=f[3]*d+f[4]*h+f[5]*c+a.position.y;c=f[6]*d+f[7]*h+f[8]*c+a.position.z;e.init(g,k,c)};
OIMO.BoxCylinderCollisionDetector.prototype.supportPointC=function(a,c,b,d,e){var f=a.rotation.elements,g=f[0]*c+f[3]*b+f[6]*d,k=f[1]*c+f[4]*b+f[7]*d;c=f[2]*c+f[5]*b+f[8]*d;b=g;g=c;c=b*b+g*g;var h=a.radius;d=a.halfHeight;0==c?(0>k?(b=h,d=-d):b=h,c=0):(c=a.radius/Math.sqrt(c),0>k?(b*=c,d=-d):b*=c,c*=g);g=f[0]*b+f[1]*d+f[2]*c+a.position.x;k=f[3]*b+f[4]*d+f[5]*c+a.position.y;c=f[6]*b+f[7]*d+f[8]*c+a.position.z;e.init(g,k,c)};
OIMO.BoxCylinderCollisionDetector.prototype.detectCollision=function(a,c,b){var d,e;this.flip?(d=c,e=a):(d=a,e=c);var f=new OIMO.Vec3,g=new OIMO.Vec3,k=new OIMO.Vec3;if(this.getSep(d,e,f,g,k)){var h=d.position.x,m=d.position.y,l=d.position.z,p=e.position.x,x=e.position.y,q=e.position.z,t=d.halfWidth,v=d.halfHeight,r=d.halfDepth,s=e.halfHeight,G=e.radius,z=d.normalDirectionWidth.x,H=d.normalDirectionWidth.y,K=d.normalDirectionWidth.z,J=d.normalDirectionHeight.x,I=d.normalDirectionHeight.y,A=d.normalDirectionHeight.z,
Q=d.normalDirectionDepth.x,B=d.normalDirectionDepth.y,L=d.normalDirectionDepth.z,T=d.halfDirectionWidth.x,U=d.halfDirectionWidth.y,V=d.halfDirectionWidth.z,ba=d.halfDirectionHeight.x,da=d.halfDirectionHeight.y,ua=d.halfDirectionHeight.z,X=d.halfDirectionDepth.x,O=d.halfDirectionDepth.y,Y=d.halfDirectionDepth.z,Ja=e.normalDirection.x,Ka=e.normalDirection.y,La=e.normalDirection.z,pa=e.halfDirection.x,qa=e.halfDirection.y,ra=e.halfDirection.z,C=f.x,D=f.y,E=f.z,sa=C*z+D*H+E*K,ea=C*J+D*I+E*A,ta=C*Q+D*
B+E*L,ma=C*Ja+D*Ka+E*La,Ba=0<sa,Ca=0<ea,Da=0<ta,S=0<ma;Ba||(sa=-sa);Ca||(ea=-ea);Da||(ta=-ta);S||(ma=-ma);var P=0;0.999<ma?P=0.999<sa?sa>ma?1:4:0.999<ea?ea>ma?2:4:0.999<ta?ta>ma?3:4:4:0.999<sa?P=1:0.999<ea?P=2:0.999<ta&&(P=3);var M,R,W,Na,na,oa,Fa,yb,Wb,Xb,Yb,Zb,$b,ac,bc,Ra,Sa,Ta,Ga,Za,db,ga,ha,ia,eb,hb,ib,jb,zb,Ab,kc,lc,mc,nc,Pa,Qa,Oa,fa,kb,lb,mb,va,Aa,qb,wa,Eb,Fb,Gb,Bb,Cb,Db,fb,gb;if(0==P)b.addContactInfo(g.x,g.y,g.z,C,D,E,k.x,d,e,0,0,!1);else if(4==P){S?(Na=p-pa,na=x-qa,oa=q-ra,C=-Ja,D=-Ka,E=-La):
(Na=p+pa,na=x+qa,oa=q+ra,C=Ja,D=Ka,E=La);var Kb,Lb,Mb,Nb,Ob,Pb,cc,oc,pc,qc,rc,sc,N;Za=1;P=0;Aa=z*C+H*D+K*E;Aa<Za&&(Za=Aa,P=0);-Aa<Za&&(Za=-Aa,P=1);Aa=J*C+I*D+A*E;Aa<Za&&(Za=Aa,P=2);-Aa<Za&&(Za=-Aa,P=3);Aa=Q*C+B*D+L*E;Aa<Za&&(Za=Aa,P=4);-Aa<Za&&(Za=-Aa,P=5);switch(P){case 0:N=d.vertex1;Kb=N.x;Lb=N.y;Mb=N.z;N=d.vertex3;Nb=N.x;Ob=N.y;Pb=N.z;N=d.vertex4;cc=N.x;oc=N.y;pc=N.z;N=d.vertex2;qc=N.x;rc=N.y;sc=N.z;break;case 1:N=d.vertex6;Kb=N.x;Lb=N.y;Mb=N.z;N=d.vertex8;Nb=N.x;Ob=N.y;Pb=N.z;N=d.vertex7;cc=N.x;
oc=N.y;pc=N.z;N=d.vertex5;qc=N.x;rc=N.y;sc=N.z;break;case 2:N=d.vertex5;Kb=N.x;Lb=N.y;Mb=N.z;N=d.vertex1;Nb=N.x;Ob=N.y;Pb=N.z;N=d.vertex2;cc=N.x;oc=N.y;pc=N.z;N=d.vertex6;qc=N.x;rc=N.y;sc=N.z;break;case 3:N=d.vertex8;Kb=N.x;Lb=N.y;Mb=N.z;N=d.vertex4;Nb=N.x;Ob=N.y;Pb=N.z;N=d.vertex3;cc=N.x;oc=N.y;pc=N.z;N=d.vertex7;qc=N.x;rc=N.y;sc=N.z;break;case 4:N=d.vertex5;Kb=N.x;Lb=N.y;Mb=N.z;N=d.vertex7;Nb=N.x;Ob=N.y;Pb=N.z;N=d.vertex3;cc=N.x;oc=N.y;pc=N.z;N=d.vertex1;qc=N.x;rc=N.y;sc=N.z;break;case 5:N=d.vertex2,
Kb=N.x,Lb=N.y,Mb=N.z,N=d.vertex4,Nb=N.x,Ob=N.y,Pb=N.z,N=d.vertex8,cc=N.x,oc=N.y,pc=N.z,N=d.vertex6,qc=N.x,rc=N.y,sc=N.z}Ga=C*(Kb-Na)+D*(Lb-na)+E*(Mb-oa);0>=Ga&&b.addContactInfo(Kb,Lb,Mb,-C,-D,-E,Ga,d,e,5,0,!1);Ga=C*(Nb-Na)+D*(Ob-na)+E*(Pb-oa);0>=Ga&&b.addContactInfo(Nb,Ob,Pb,-C,-D,-E,Ga,d,e,6,0,!1);Ga=C*(cc-Na)+D*(oc-na)+E*(pc-oa);0>=Ga&&b.addContactInfo(cc,oc,pc,-C,-D,-E,Ga,d,e,7,0,!1);Ga=C*(qc-Na)+D*(rc-na)+E*(sc-oa);0>=Ga&&b.addContactInfo(qc,rc,sc,-C,-D,-E,Ga,d,e,8,0,!1)}else{switch(P){case 1:Ba?
(M=h+T,R=m+U,W=l+V,C=z,D=H,E=K):(M=h-T,R=m-U,W=l-V,C=-z,D=-H,E=-K);Eb=J;Fb=I;Gb=A;fb=v;Bb=Q;Cb=B;Db=L;gb=r;break;case 2:Ca?(M=h+ba,R=m+da,W=l+ua,C=J,D=I,E=A):(M=h-ba,R=m-da,W=l-ua,C=-J,D=-I,E=-A);Eb=z;Fb=H;Gb=K;fb=t;Bb=Q;Cb=B;Db=L;gb=r;break;case 3:Da?(M=h+X,R=m+O,W=l+Y,C=Q,D=B,E=L):(M=h-X,R=m-O,W=l-Y,C=-Q,D=-B,E=-L),Eb=z,Fb=H,Gb=K,fb=t,Bb=J,Cb=I,Db=A,gb=v}Za=C*Ja+D*Ka+E*La;db=0>Za?s:-s;Na=p+db*Ja;na=x+db*Ka;oa=q+db*La;0.999999<=ma?(ga=-D,ha=E,ia=C):(ga=C,ha=D,ia=E);db=ga*Ja+ha*Ka+ia*La;hb=db*Ja-
ga;ib=db*Ka-ha;jb=db*La-ia;db=Math.sqrt(hb*hb+ib*ib+jb*jb);if(0!=db)if(db=G/db,hb*=db,ib*=db,jb*=db,ga=Na+hb,ha=na+ib,ia=oa+jb,-0.96>Za||0.96<Za)Fa=Ja*Ja*1.5-0.5,yb=Ja*Ka*1.5-0.866025403*La,Wb=Ja*La*1.5+0.866025403*Ka,Xb=Ka*Ja*1.5+0.866025403*La,Yb=Ka*Ka*1.5-0.5,Zb=Ka*La*1.5-0.866025403*Ja,$b=La*Ja*1.5-0.866025403*Ka,ac=La*Ka*1.5+0.866025403*Ja,bc=La*La*1.5-0.5,Ra=ga,Sa=ha,Ta=ia,Ga=C*(Ra-M)+D*(Sa-R)+E*(Ta-W),ga=Ra-Ga*C-M,ha=Sa-Ga*D-R,ia=Ta-Ga*E-W,fa=Eb*ga+Fb*ha+Gb*ia,va=Bb*ga+Cb*ha+Db*ia,fa<-fb?fa=
-fb:fa>fb&&(fa=fb),va<-gb?va=-gb:va>gb&&(va=gb),ga=fa*Eb+va*Bb,ha=fa*Fb+va*Cb,ia=fa*Gb+va*Db,Ra=M+ga,Sa=R+ha,Ta=W+ia,b.addContactInfo(Ra,Sa,Ta,C,D,E,Ga,d,e,1,0,!1),Ra=hb*Fa+ib*yb+jb*Wb,Sa=hb*Xb+ib*Yb+jb*Zb,Ta=hb*$b+ib*ac+jb*bc,Ra=(hb=Ra)+Na,Sa=(ib=Sa)+na,Ta=(jb=Ta)+oa,Ga=C*(Ra-M)+D*(Sa-R)+E*(Ta-W),0>=Ga&&(ga=Ra-Ga*C-M,ha=Sa-Ga*D-R,ia=Ta-Ga*E-W,fa=Eb*ga+Fb*ha+Gb*ia,va=Bb*ga+Cb*ha+Db*ia,fa<-fb?fa=-fb:fa>fb&&(fa=fb),va<-gb?va=-gb:va>gb&&(va=gb),ga=fa*Eb+va*Bb,ha=fa*Fb+va*Cb,ia=fa*Gb+va*Db,Ra=M+ga,Sa=
R+ha,Ta=W+ia,b.addContactInfo(Ra,Sa,Ta,C,D,E,Ga,d,e,2,0,!1)),Ra=hb*Fa+ib*yb+jb*Wb,Sa=hb*Xb+ib*Yb+jb*Zb,Ta=hb*$b+ib*ac+jb*bc,Ra=(hb=Ra)+Na,Sa=(ib=Sa)+na,Ta=(jb=Ta)+oa,Ga=C*(Ra-M)+D*(Sa-R)+E*(Ta-W),0>=Ga&&(ga=Ra-Ga*C-M,ha=Sa-Ga*D-R,ia=Ta-Ga*E-W,fa=Eb*ga+Fb*ha+Gb*ia,va=Bb*ga+Cb*ha+Db*ia,fa<-fb?fa=-fb:fa>fb&&(fa=fb),va<-gb?va=-gb:va>gb&&(va=gb),ga=fa*Eb+va*Bb,ha=fa*Fb+va*Cb,ia=fa*Gb+va*Db,Ra=M+ga,Sa=R+ha,Ta=W+ia,b.addContactInfo(Ra,Sa,Ta,C,D,E,Ga,d,e,3,0,!1));else{Pa=ga;Qa=ha;Oa=ia;fa=C*(Pa-M)+D*(Qa-
R)+E*(Oa-W);Pa-=fa*C;Qa-=fa*D;Oa-=fa*E;0<Za?(kb=ga+2*pa,lb=ha+2*qa,mb=ia+2*ra):(kb=ga-2*pa,lb=ha-2*qa,mb=ia-2*ra);va=C*(kb-M)+D*(lb-R)+E*(mb-W);kb-=va*C;lb-=va*D;mb-=va*E;zb=Pa-M;Ab=Qa-R;kc=Oa-W;lc=kb-M;mc=lb-R;nc=mb-W;ga=kb-Pa;ha=lb-Qa;ia=mb-Oa;eb=va-fa;sa=zb*Eb+Ab*Fb+kc*Gb;ea=lc*Eb+mc*Fb+nc*Gb;Aa=sa-fb;qb=ea-fb;if(0<Aa){if(0<qb)return;wa=Aa/(Aa-qb);Pa+=ga*wa;Qa+=ha*wa;Oa+=ia*wa;fa+=eb*wa;zb=Pa-M;Ab=Qa-R;kc=Oa-W;sa=zb*Eb+Ab*Fb+kc*Gb;ga=kb-Pa;ha=lb-Qa;ia=mb-Oa;eb=va-fa}else 0<qb&&(wa=Aa/(Aa-qb),kb=
Pa+ga*wa,lb=Qa+ha*wa,mb=Oa+ia*wa,va=fa+eb*wa,lc=kb-M,mc=lb-R,nc=mb-W,ea=lc*Eb+mc*Fb+nc*Gb,ga=kb-Pa,ha=lb-Qa,ia=mb-Oa,eb=va-fa);Aa=sa+fb;qb=ea+fb;if(0>Aa){if(0>qb)return;wa=Aa/(Aa-qb);Pa+=ga*wa;Qa+=ha*wa;Oa+=ia*wa;fa+=eb*wa;zb=Pa-M;Ab=Qa-R;kc=Oa-W;ga=kb-Pa;ha=lb-Qa;ia=mb-Oa;eb=va-fa}else 0>qb&&(wa=Aa/(Aa-qb),kb=Pa+ga*wa,lb=Qa+ha*wa,mb=Oa+ia*wa,va=fa+eb*wa,lc=kb-M,mc=lb-R,nc=mb-W,ga=kb-Pa,ha=lb-Qa,ia=mb-Oa,eb=va-fa);sa=zb*Bb+Ab*Cb+kc*Db;ea=lc*Bb+mc*Cb+nc*Db;Aa=sa-gb;qb=ea-gb;if(0<Aa){if(0<qb)return;
wa=Aa/(Aa-qb);Pa+=ga*wa;Qa+=ha*wa;Oa+=ia*wa;fa+=eb*wa;zb=Pa-M;Ab=Qa-R;kc=Oa-W;sa=zb*Bb+Ab*Cb+kc*Db;ga=kb-Pa;ha=lb-Qa;ia=mb-Oa;eb=va-fa}else 0<qb&&(wa=Aa/(Aa-qb),kb=Pa+ga*wa,lb=Qa+ha*wa,mb=Oa+ia*wa,va=fa+eb*wa,lc=kb-M,mc=lb-R,nc=mb-W,ea=lc*Bb+mc*Cb+nc*Db,ga=kb-Pa,ha=lb-Qa,ia=mb-Oa,eb=va-fa);Aa=sa+gb;qb=ea+gb;if(0>Aa){if(0>qb)return;wa=Aa/(Aa-qb);Pa+=ga*wa;Qa+=ha*wa;Oa+=ia*wa;fa+=eb*wa}else 0>qb&&(wa=Aa/(Aa-qb),kb=Pa+ga*wa,lb=Qa+ha*wa,mb=Oa+ia*wa,va=fa+eb*wa);0>fa&&b.addContactInfo(Pa,Qa,Oa,C,D,E,fa,
d,e,1,0,!1);0>va&&b.addContactInfo(kb,lb,mb,C,D,E,va,d,e,4,0,!1)}}}};OIMO.CylinderCylinderCollisionDetector=function(){OIMO.CollisionDetector.call(this)};OIMO.CylinderCylinderCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.CylinderCylinderCollisionDetector.prototype.getSep=function(a,c,b,d,e){var f,g,k,h,m,l,p=new OIMO.Vec3,x,q,t,v,r,s,G=a.position.x,z=a.position.y,H=a.position.z,K=c.position.x,J=c.position.y,I=c.position.z,A=K-G,Q=J-z,B=I-H;0==A*A+Q*Q+B*B&&(Q=0.001);var L=-A;l=-Q;h=-B;this.supportPoint(a,-L,-l,-h,p);var T=p.x,U=p.y,V=p.z;this.supportPoint(c,L,l,h,p);var ba=p.x,da=p.y,ua=p.z,X=ba-T,O=da-U,Y=ua-V;if(0>=X*L+O*l+Y*h)return!1;L=O*B-Y*Q;l=Y*A-X*B;h=X*Q-O*A;if(0==L*L+l*l+h*h)return b.init(X-A,O-Q,Y-
B),b.normalize(b),d.init(0.5*(T+ba),0.5*(U+da),0.5*(V+ua)),!0;this.supportPoint(a,-L,-l,-h,p);var Ja=p.x,Ka=p.y,La=p.z;this.supportPoint(c,L,l,h,p);var pa=p.x,qa=p.y,ra=p.z,C=pa-Ja,D=qa-Ka,E=ra-La;if(0>=C*L+D*l+E*h)return!1;f=X-A;g=O-Q;k=Y-B;h=C-A;m=D-Q;l=E-B;L=g*l-k*m;l=k*h-f*l;h=f*m-g*h;0<L*A+l*Q+h*B&&(f=X,g=O,k=Y,X=C,O=D,Y=E,C=f,D=g,E=k,f=T,g=U,k=V,T=Ja,U=Ka,V=La,Ja=f,Ka=g,La=k,f=ba,g=da,k=ua,ba=pa,da=qa,ua=ra,pa=f,qa=g,ra=k,L=-L,l=-l,h=-h);for(var sa=0;;){if(100<++sa)return!1;this.supportPoint(a,
-L,-l,-h,p);var ea=p.x,ta=p.y,ma=p.z;this.supportPoint(c,L,l,h,p);var Ba=p.x,Ca=p.y,Da=p.z,S=Ba-ea,P=Ca-ta,M=Da-ma;if(0>=S*L+P*l+M*h)return!1;if(0>(O*M-Y*P)*A+(Y*S-X*M)*Q+(X*P-O*S)*B)C=S,D=P,E=M,Ja=ea,Ka=ta,La=ma,pa=Ba,qa=Ca,ra=Da,f=X-A,g=O-Q,k=Y-B,h=S-A,m=P-Q,l=M-B,L=g*l-k*m,l=k*h-f*l,h=f*m-g*h;else if(0>(P*E-M*D)*A+(M*C-S*E)*Q+(S*D-P*C)*B)X=S,O=P,Y=M,T=ea,U=ta,V=ma,ba=Ba,da=Ca,ua=Da,f=S-A,g=P-Q,k=M-B,h=C-A,m=D-Q,l=E-B,L=g*l-k*m,l=k*h-f*l,h=f*m-g*h;else for(var R=!1;;){f=C-X;g=D-O;k=E-Y;h=S-X;m=
P-O;l=M-Y;L=g*l-k*m;l=k*h-f*l;h=f*m-g*h;f=1/Math.sqrt(L*L+l*l+h*h);L*=f;l*=f;h*=f;0<=L*X+l*O+h*Y&&!R&&(s=(O*E-Y*D)*S+(Y*C-X*E)*P+(X*D-O*C)*M,R=(P*E-M*D)*A+(M*C-S*E)*Q+(S*D-P*C)*B,f=(Q*Y-B*O)*S+(B*X-A*Y)*P+(A*O-Q*X)*M,g=(D*Y-E*O)*A+(E*X-C*Y)*Q+(C*O-D*X)*B,x=s+R+f+g,0>=x&&(s=0,R=(D*M-E*P)*L+(E*S-C*M)*l+(C*P-D*S)*h,f=(P*E-M*D)*L+(M*C-S*E)*l+(S*D-P*C)*h,g=(O*E-Y*D)*L+(Y*C-X*E)*l+(X*D-O*C)*h,x=R+f+g),k=1/x,x=(G*s+T*R+Ja*f+ea*g)*k,q=(z*s+U*R+Ka*f+ta*g)*k,t=(H*s+V*R+La*f+ma*g)*k,v=(K*s+ba*R+pa*f+Ba*g)*k,
r=(J*s+da*R+qa*f+Ca*g)*k,s=(I*s+ua*R+ra*f+Da*g)*k,R=!0);this.supportPoint(a,-L,-l,-h,p);f=p.x;g=p.y;k=p.z;this.supportPoint(c,L,l,h,p);m=p.x;var W=p.y,Na=p.z,na=m-f,oa=W-g,Fa=Na-k,yb=-(na*L+oa*l+Fa*h);if(0.01>=(na-S)*L+(oa-P)*l+(Fa-M)*h||0<=yb)return R?(b.init(-L,-l,-h),d.init(0.5*(x+v),0.5*(q+r),0.5*(t+s)),e.x=yb,!0):!1;0>(oa*Y-Fa*O)*A+(Fa*X-na*Y)*Q+(na*O-oa*X)*B?0>(oa*E-Fa*D)*A+(Fa*C-na*E)*Q+(na*D-oa*C)*B?(X=na,O=oa,Y=Fa,T=f,U=g,V=k,ba=m,da=W,ua=Na):(S=na,P=oa,M=Fa,ea=f,ta=g,ma=k,Ba=m,Ca=W,Da=Na):
0>(oa*M-Fa*P)*A+(Fa*S-na*M)*Q+(na*P-oa*S)*B?(C=na,D=oa,E=Fa,Ja=f,Ka=g,La=k,pa=m,qa=W,ra=Na):(X=na,O=oa,Y=Fa,T=f,U=g,V=k,ba=m,da=W,ua=Na)}}};
OIMO.CylinderCylinderCollisionDetector.prototype.supportPoint=function(a,c,b,d,e){var f=a.rotation.elements,g=f[0]*c+f[3]*b+f[6]*d,k=f[1]*c+f[4]*b+f[7]*d;c=f[2]*c+f[5]*b+f[8]*d;b=g;g=c;c=b*b+g*g;var h=a.radius;d=a.halfHeight;0==c?(0>k?(b=h,d=-d):b=h,c=0):(c=a.radius/Math.sqrt(c),0>k?(b*=c,d=-d):b*=c,c*=g);g=f[0]*b+f[1]*d+f[2]*c+a.position.x;k=f[3]*b+f[4]*d+f[5]*c+a.position.y;c=f[6]*b+f[7]*d+f[8]*c+a.position.z;e.init(g,k,c)};
OIMO.CylinderCylinderCollisionDetector.prototype.detectCollision=function(a,c,b){var d;a.id<c.id?(d=a,a=c):d=c;var e=d.position;c=a.position;var f=e.x,g=e.y,k=e.z,h=c.x,m=c.y,l=c.z,p=d.halfHeight,x=a.halfHeight,q=d.normalDirection,t=a.normalDirection,v=d.halfDirection,r=a.halfDirection;c=d.radius;var e=a.radius,s=q.x,G=q.y,q=q.z,z=t.x,H=t.y,K=t.z,J=v.x,I=v.y,A=v.z,Q=r.x,B=r.y,L=r.z,T=f-h,U=g-m,V=k-l,ba,da,ua,t=new OIMO.Vec3,V=new OIMO.Vec3,r=new OIMO.Vec3;if(this.getSep(d,a,t,V,r)){T=t.x*s+t.y*G+
t.z*q;U=t.x*z+t.y*H+t.z*K;ba=0<T;da=0<U;ba||(T=-T);da||(U=-U);ua=0;if(0.999<T||0.999<U)ua=T>U?1:2;var X=r.x,O,r=t.x,v=t.y,t=t.z;switch(ua){case 0:b.addContactInfo(V.x,V.y,V.z,r,v,t,X,d,a,0,0,!1);break;case 1:ba?(f+=J,g+=I,k+=A,r=s,v=G,t=q):(f-=J,g-=I,k-=A,r=-s,v=-G,t=-q);ua=r*z+v*H+t*K;I=0>ua?x:-x;h+=I*z;m+=I*H;l+=I*K;0.999999<=U?(A=-v,J=t,B=r):(A=r,J=v,B=t);I=A*z+J*H+B*K;T=I*z-A;U=I*H-J;V=I*K-B;I=Math.sqrt(T*T+U*U+V*V);if(0==I)break;I=e/I;T*=I;U*=I;V*=I;A=h+T;J=m+U;B=l+V;if(-0.96>ua||0.96<ua)p=z*
z*1.5-0.5,x=z*H*1.5-0.866025403*K,L=z*K*1.5+0.866025403*H,Q=H*z*1.5+0.866025403*K,ba=H*H*1.5-0.5,da=H*K*1.5-0.866025403*z,ua=K*z*1.5-0.866025403*H,G=K*H*1.5+0.866025403*z,q=K*K*1.5-0.5,K=A,s=J,H=B,O=r*(K-f)+v*(s-g)+t*(H-k),A=K-O*r-f,J=s-O*v-g,B=H-O*t-k,I=A*A+J*J+B*B,I>c*c&&(I=c/Math.sqrt(I),A*=I,J*=I,B*=I),b.addContactInfo(f+A,g+J,k+B,r,v,t,O,d,a,1,0,!1),s=T*Q+U*ba+V*da,H=T*ua+U*G+V*q,K=(T=T*p+U*x+V*L)+h,s=(U=s)+m,H=(V=H)+l,O=r*(K-f)+v*(s-g)+t*(H-k),0>=O&&(A=K-O*r-f,J=s-O*v-g,B=H-O*t-k,I=A*A+J*J+
B*B,I>c*c&&(I=c/Math.sqrt(I),A*=I,J*=I,B*=I),b.addContactInfo(f+A,g+J,k+B,r,v,t,O,d,a,2,0,!1)),K=T*p+U*x+V*L+h,s=T*Q+U*ba+V*da+m,H=T*ua+U*G+V*q+l,O=r*(K-f)+v*(s-g)+t*(H-k),0>=O&&(A=K-O*r-f,J=s-O*v-g,B=H-O*t-k,I=A*A+J*J+B*B,I>c*c&&(I=c/Math.sqrt(I),A*=I,J*=I,B*=I),b.addContactInfo(f+A,g+J,k+B,r,v,t,O,d,a,3,0,!1));else{L=A;Q=J;ba=B;da=r*(L-f)+v*(Q-g)+t*(ba-k);L-=da*r;Q-=da*v;ba-=da*t;0<ua?(s=A+z*x*2,G=J+H*x*2,q=B+K*x*2):(s=A-z*x*2,G=J-H*x*2,q=B-K*x*2);K=r*(s-f)+v*(G-g)+t*(q-k);s-=K*r;G-=K*v;q-=K*t;
T=f-L;U=g-Q;V=k-ba;A=s-L;J=G-Q;B=q-ba;H=T*A+U*J+V*B;z=A*A+J*J+B*B;e=H*H-z*(T*T+U*U+V*V-c*c);if(0>e)break;e=Math.sqrt(e);c=(H+e)/z;e=(H-e)/z;e<c&&(I=c,c=e,e=I);1<e&&(e=1);0>c&&(c=0);A=L+(s-L)*c;J=Q+(G-Q)*c;B=ba+(q-ba)*c;s=L+(s-L)*e;G=Q+(G-Q)*e;q=ba+(q-ba)*e;I=da+(K-da)*c;K=da+(K-da)*e;0>I&&b.addContactInfo(A,J,B,r,v,t,O,d,a,1,0,!1);0>K&&b.addContactInfo(s,G,q,r,v,t,O,d,a,4,0,!1)}break;case 2:da?(h-=Q,m-=B,l-=L,r=-z,v=-H,t=-K):(h+=Q,m+=B,l+=L,r=z,v=H,t=K);ua=r*s+v*G+t*q;I=0>ua?p:-p;f+=I*s;g+=I*G;k+=
I*q;0.999999<=T?(A=-v,J=t,B=r):(A=r,J=v,B=t);I=A*s+J*G+B*q;T=I*s-A;U=I*G-J;V=I*q-B;I=Math.sqrt(T*T+U*U+V*V);if(0==I)break;I=c/I;T*=I;U*=I;V*=I;A=f+T;J=g+U;B=k+V;if(-0.96>ua||0.96<ua)p=s*s*1.5-0.5,x=s*G*1.5-0.866025403*q,L=s*q*1.5+0.866025403*G,Q=G*s*1.5+0.866025403*q,ba=G*G*1.5-0.5,da=G*q*1.5-0.866025403*s,ua=q*s*1.5-0.866025403*G,G=q*G*1.5+0.866025403*s,q=q*q*1.5-0.5,K=A,s=J,H=B,O=r*(K-h)+v*(s-m)+t*(H-l),A=K-O*r-h,J=s-O*v-m,B=H-O*t-l,I=A*A+J*J+B*B,I>e*e&&(I=e/Math.sqrt(I),A*=I,J*=I,B*=I),b.addContactInfo(h+
A,m+J,l+B,-r,-v,-t,O,d,a,1,0,!1),s=T*Q+U*ba+V*da,H=T*ua+U*G+V*q,K=(T=T*p+U*x+V*L)+f,s=(U=s)+g,H=(V=H)+k,O=r*(K-h)+v*(s-m)+t*(H-l),0>=O&&(A=K-O*r-h,J=s-O*v-m,B=H-O*t-l,I=A*A+J*J+B*B,I>e*e&&(I=e/Math.sqrt(I),A*=I,J*=I,B*=I),b.addContactInfo(h+A,m+J,l+B,-r,-v,-t,O,d,a,2,0,!1)),K=T*p+U*x+V*L+f,s=T*Q+U*ba+V*da+g,H=T*ua+U*G+V*q+k,O=r*(K-h)+v*(s-m)+t*(H-l),0>=O&&(A=K-O*r-h,J=s-O*v-m,B=H-O*t-l,I=A*A+J*J+B*B,I>e*e&&(I=e/Math.sqrt(I),A*=I,J*=I,B*=I),b.addContactInfo(h+A,m+J,l+B,-r,-v,-t,O,d,a,3,0,!1));else{L=
A;Q=J;ba=B;da=r*(L-h)+v*(Q-m)+t*(ba-l);L-=da*r;Q-=da*v;ba-=da*t;0<ua?(s=A+s*p*2,G=J+G*p*2,q=B+q*p*2):(s=A-s*p*2,G=J-G*p*2,q=B-q*p*2);K=r*(s-h)+v*(G-m)+t*(q-l);s-=K*r;G-=K*v;q-=K*t;T=h-L;U=m-Q;V=l-ba;A=s-L;J=G-Q;B=q-ba;H=T*A+U*J+V*B;z=A*A+J*J+B*B;e=H*H-z*(T*T+U*U+V*V-e*e);if(0>e)break;e=Math.sqrt(e);c=(H+e)/z;e=(H-e)/z;e<c&&(I=c,c=e,e=I);1<e&&(e=1);0>c&&(c=0);A=L+(s-L)*c;J=Q+(G-Q)*c;B=ba+(q-ba)*c;s=L+(s-L)*e;G=Q+(G-Q)*e;q=ba+(q-ba)*e;I=da+(K-da)*c;K=da+(K-da)*e;da=I;0>da&&b.addContactInfo(A,J,B,-r,
-v,-t,da,d,a,1,0,!1);0>K&&b.addContactInfo(s,G,q,-r,-v,-t,K,d,a,4,0,!1)}}}};OIMO.SphereBoxCollisionDetector=function(a){OIMO.CollisionDetector.call(this);this.flip=a};OIMO.SphereBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.SphereBoxCollisionDetector.prototype.detectCollision=function(a,c,b){var d;this.flip?d=c:(d=a,a=c);var e=d.position;c=e.x;var f=e.y,g=e.z,k=a.position,h=k.x,m=k.y,l=k.z,k=d.radius,p=a.normalDirectionWidth,x=a.normalDirectionHeight,q=a.normalDirectionDepth,t=a.halfWidth,v=a.halfHeight,r=a.halfDepth,s=c-h,G=f-m,z=g-l,H=p.x*s+p.y*G+p.z*z,K=x.x*s+x.y*G+x.z*z,J=q.x*s+q.y*G+q.z*z,s=0;H>t?H=t:H<-t?H=-t:s=1;K>v?K=v:K<-v?K=-v:s|=2;J>r?J=r:J<-r?J=-r:s|=4;7==s?(s=0>H?t+H:t-H,G=0>K?v+K:v-K,z=0>J?r+J:r-J,
s<G?s<z?(e=s-t,0>H?(s=p.x,G=p.y,z=p.z):(s=-p.x,G=-p.y,z=-p.z)):(e=z-r,0>J?(s=q.x,G=q.y,z=q.z):(s=-q.x,G=-q.y,z=-q.z)):G<z?(e=G-v,0>K?(s=x.x,G=x.y,z=x.z):(s=-x.x,G=-x.y,z=-x.z)):(e=z-r,0>J?(s=q.x,G=q.y,z=q.z):(s=-q.x,G=-q.y,z=-q.z)),b.addContactInfo(c+k*s,f+k*G,g+k*z,s,G,z,e,d,a,0,0,!1)):(s=h+H*p.x+K*x.x+J*q.x,m=m+H*p.y+K*x.y+J*q.y,p=l+H*p.z+K*x.z+J*q.z,s-=e.x,G=m-e.y,z=p-e.z,e=s*s+G*G+z*z,0<e&&e<k*k&&(e=Math.sqrt(e),p=1/e,s*=p,G*=p,z*=p,b.addContactInfo(c+k*s,f+k*G,g+k*z,s,G,z,e,d,a,0,0,!1)))};OIMO.SphereCylinderCollisionDetector=function(a){OIMO.CollisionDetector.call(this);this.flip=a};OIMO.SphereCylinderCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.SphereCylinderCollisionDetector.prototype.detectCollision=function(a,c,b){var d;this.flip?d=c:(d=a,a=c);var e=d.position;c=e.x;var f=e.y,e=e.z,g=a.position,k=g.x,h=g.y,m=g.z,l=a.normalDirection.x,p=a.normalDirection.y,x=a.normalDirection.z,g=d.radius,q=a.radius,t=g+q,v=a.halfHeight,r=(c-k)*l+(f-h)*p+(e-m)*x;if(!(r<-v-g||r>v+g)){var s=c-(k+r*l),G=f-(h+r*p),z=e-(m+r*x),H=s*s+G*G+z*z;H>t*t||(H>q*q&&(H=q/Math.sqrt(H),s*=H,G*=H,z*=H),r<-v?r=-v:r>v&&(r=v),k=k+r*l+s-c,h=h+r*p+G-f,m=m+r*x+z-e,H=k*k+
h*h+m*m,0<H&&H<g*g&&(H=Math.sqrt(H),x=1/H,k*=x,h*=x,m*=x,b.addContactInfo(c+k*g,f+h*g,e+m*g,k,h,m,H-g,d,a,0,0,!1)))}};OIMO.SphereSphereCollisionDetector=function(){OIMO.CollisionDetector.call(this)};OIMO.SphereSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);OIMO.SphereSphereCollisionDetector.prototype.detectCollision=function(a,c,b){var d=a.position,e=c.position,f=e.x-d.x,g=e.y-d.y,e=e.z-d.z,k=f*f+g*g+e*e,h=a.radius,m=h+c.radius;if(0<k&&k<m*m){var k=Math.sqrt(k),l=1/k,f=f*l,g=g*l,e=e*l;b.addContactInfo(d.x+f*h,d.y+g*h,d.z+e*h,f,g,e,k-m,a,c,0,0,!1)}};OIMO.Pair=function(){this.shape2=this.shape1=null};OIMO.Proxy=function(a,c,b,d,e,f){this.minX=a||0;this.maxX=c||0;this.minY=b||0;this.maxY=d||0;this.minZ=e||0;this.maxZ=f||0;this.parent=null};OIMO.Proxy.prototype={constructor:OIMO.Proxy,init:function(a,c,b,d,e,f){this.minX=a||0;this.maxX=c||0;this.minY=b||0;this.maxY=d||0;this.minZ=e||0;this.maxZ=f||0},intersect:function(a){return this.maxX>a.minX&&this.minX<a.maxX&&this.maxY>a.minY&&this.minY<a.maxY&&this.maxZ>a.minZ&&this.minZ<a.maxZ}};OIMO.BroadPhase=function(){this.numPairs=this.numPairChecks=this.types=0;this.bufferSize=256;this.pairs=[];this.pairs.length=this.bufferSize;for(var a=0;a<this.bufferSize;a++)this.pairs[a]=new OIMO.Pair};
OIMO.BroadPhase.prototype={constructor:OIMO.BroadPhase,createProxy:function(a){throw Error("Inheritance error.");},addProxy:function(a){throw Error("Inheritance error.");},removeProxy:function(a){throw Error("Inheritance error.");},isAvailablePair:function(a,c){var b=a.parent,d=c.parent;if(b==d||(b.type==OIMO.BODY_STATIC||b.sleeping)&&(d.type==OIMO.BODY_STATIC||d.sleeping))return!1;var e;for(e=b.numJoints<d.numJoints?b.jointList:d.jointList;null!=e;){var f=e.parent;if(!f.allowCollision&&(f.body1==
b&&f.body2==d||f.body1==d&&f.body2==b))return!1;e=e.next}return!0},detectPairs:function(){for(;0<this.numPairs;){var a=this.pairs[--this.numPairs];a.shape1=null;a.shape2=null}this.collectPairs()},collectPairs:function(){throw Error("Inheritance error.");},addPair:function(a,c){if(this.numPairs==this.bufferSize){for(var b=this.bufferSize<<1,d=[],e=0;e<this.bufferSize;e++)d[e]=this.pairs[e];for(e=this.bufferSize;e<b;e++)d[e]=new OIMO.Pair;this.pairs=d;this.bufferSize=b}b=this.pairs[this.numPairs++];
b.shape1=a;b.shape2=c}};OIMO.BruteForceBroadPhase=function(){OIMO.BroadPhase.call(this);this.types=1;this.numProxies=0;this.proxyPool=[];this.proxyPool.length=OIMO.WORLD_MAX_SHAPES};OIMO.BruteForceBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype);OIMO.BruteForceBroadPhase.prototype.addProxy=function(a){this.proxyPool[this.numProxies]=a;this.numProxies++};
OIMO.BruteForceBroadPhase.prototype.removeProxy=function(a){for(var c=-1,b=0;b<this.numProxies;b++)if(this.proxyPool[b]==a){c=b;break}if(-1!=c){for(a=c;a<this.numProxies-1;a++)this.proxyPool[a]=this.proxyPool[a+1];this.proxyPool[this.numProxies]=null;this.numProxies--}};
OIMO.BruteForceBroadPhase.prototype.collectPairs=function(){this.numPairChecks=this.numProxies*(this.numProxies-1)>>1;for(var a=0;a<this.numProxies;a++)for(var c=this.proxyPool[a],b=c.parent,d=a+1;d<this.numProxies;d++){var e=this.proxyPool[d],f=e.parent;c.maxX<e.minX||c.minX>e.maxX||c.maxY<e.minY||c.minY>e.maxY||c.maxZ<e.minZ||c.minZ>e.maxZ||!this.isAvailablePair(b,f)||this.addPair(b,f)}};OIMO.SweepAndPruneBroadPhase=function(){OIMO.BroadPhase.call(this);this.types=2;this.sortAxis=this.numProxies=0;this.proxyPoolAxis=[];this.proxyPoolAxis.length=3;this.proxyPoolAxis[0]=[];this.proxyPoolAxis[1]=[];this.proxyPoolAxis[2]=[];this.proxyPoolAxis[0].length=OIMO.WORLD_MAX_SHAPES;this.proxyPoolAxis[1].length=OIMO.WORLD_MAX_SHAPES;this.proxyPoolAxis[2].length=OIMO.WORLD_MAX_SHAPES};OIMO.SweepAndPruneBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype);
OIMO.SweepAndPruneBroadPhase.prototype.addProxy=function(a){this.proxyPoolAxis[0][this.numProxies]=a;this.proxyPoolAxis[1][this.numProxies]=a;this.proxyPoolAxis[2][this.numProxies]=a;this.numProxies++};OIMO.SweepAndPruneBroadPhase.prototype.removeProxy=function(a){this.removeProxyAxis(a,this.proxyPoolAxis[0]);this.removeProxyAxis(a,this.proxyPoolAxis[1]);this.removeProxyAxis(a,this.proxyPoolAxis[2]);this.numProxies--};
OIMO.SweepAndPruneBroadPhase.prototype.collectPairs=function(){this.numPairChecks=0;var a=this.proxyPoolAxis[this.sortAxis];0==this.sortAxis?(this.insertionSortX(a),this.sweepX(a)):1==this.sortAxis?(this.insertionSortY(a),this.sweepY(a)):(this.insertionSortZ(a),this.sweepZ(a))};
OIMO.SweepAndPruneBroadPhase.prototype.sweepX=function(a){for(var c,b=0,d=0,e=0,f=0,g=0,k=0,h=1/this.numProxies,m=0,l=this.numProxies;m<l;m++){var p=a[m];c=p.minX+p.maxX;b+=c;d+=c*c;c=p.minY+p.maxY;e+=c;f+=c*c;c=p.minZ+p.maxZ;g+=c;k+=c*c;c=p.parent;for(var x=m+1;x<l;x++){var q=a[x];this.numPairChecks++;if(p.maxX<q.minX)break;var t=q.parent;p.maxY<q.minY||p.minY>q.maxY||p.maxZ<q.minZ||p.minZ>q.maxZ||!this.isAvailablePair(c,t)||this.addPair(c,t)}}b=d-b*b*h;e=f-e*e*h;g=k-g*g*h;this.sortAxis=b>e?b>g?
0:2:e>g?1:2};
OIMO.SweepAndPruneBroadPhase.prototype.sweepY=function(a){for(var c,b=0,d=0,e=0,f=0,g=0,k=0,h=1/this.numProxies,m=0,l=this.numProxies;m<l;m++){var p=a[m];c=p.minX+p.maxX;b+=c;d+=c*c;c=p.minY+p.maxY;e+=c;f+=c*c;c=p.minZ+p.maxZ;g+=c;k+=c*c;c=p.parent;for(var x=m+1;x<l;x++){var q=a[x];this.numPairChecks++;if(p.maxY<q.minY)break;var t=q.parent;p.maxX<q.minX||p.minX>q.maxX||p.maxZ<q.minZ||p.minZ>q.maxZ||!this.isAvailablePair(c,t)||this.addPair(c,t)}}b=d-b*b*h;e=f-e*e*h;g=k-g*g*h;this.sortAxis=b>e?b>g?
0:2:e>g?1:2};
OIMO.SweepAndPruneBroadPhase.prototype.sweepZ=function(a){for(var c,b=0,d=0,e=0,f=0,g=0,k=0,h=1/this.numProxies,m=0,l=this.numProxies;m<l;m++){var p=a[m];c=p.minX+p.maxX;b+=c;d+=c*c;c=p.minY+p.maxY;e+=c;f+=c*c;c=p.minZ+p.maxZ;g+=c;k+=c*c;c=p.parent;for(var x=m+1;x<l;x++){var q=a[x];this.numPairChecks++;if(p.maxZ<q.minZ)break;var t=q.parent;p.maxX<q.minX||p.minX>q.maxX||p.maxY<q.minY||p.minY>q.maxY||!this.isAvailablePair(c,t)||this.addPair(c,t)}}b=d-b*b*h;e=f-e*e*h;g=k-g*g*h;this.sortAxis=b>e?b>g?
0:2:e>g?1:2};OIMO.SweepAndPruneBroadPhase.prototype.removeProxyAxis=function(a,c){for(var b=-1,d=0,e=this.numProxies;d<e;d++)if(c[d]==a){b=d;break}if(-1!=b){for(;b<e-1;b++)c[b]=c[b+1];c[this.numProxies]=null}};OIMO.SweepAndPruneBroadPhase.prototype.insertionSortX=function(a){if(1!=this.numProxies)for(var c=1,b=this.numProxies;c<b;c++){var d=a[c];if(a[c-1].minX>d.minX){var e=c;do a[e]=a[e-1],e--;while(0<e&&a[e-1].minX>d.minX);a[e]=d}}};
OIMO.SweepAndPruneBroadPhase.prototype.insertionSortY=function(a){if(1!=this.numProxies)for(var c=1,b=this.numProxies;c<b;c++){var d=a[c];if(a[c-1].minY>d.minY){var e=c;do a[e]=a[e-1],e--;while(0<e&&a[e-1].minY>d.minY);a[e]=d}}};OIMO.SweepAndPruneBroadPhase.prototype.insertionSortZ=function(a){if(1!=this.numProxies)for(var c=1,b=this.numProxies;c<b;c++){var d=a[c];if(a[c-1].minZ>d.minZ){var e=c;do a[e]=a[e-1],e--;while(0<e&&a[e-1].minZ>d.minZ);a[e]=d}}};
